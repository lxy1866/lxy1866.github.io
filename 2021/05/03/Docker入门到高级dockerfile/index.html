<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Docker入门到高级dockerfile"><meta name="keywords" content="docker,dockerfile"><meta name="author" content="Kaluna"><meta name="copyright" content="Kaluna"><title>Docker入门到高级dockerfile | 嘿，不停转的轮子</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="嘿，不停转的轮子" type="application/atom+xml">
</head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker容器基础入门实战"><span class="toc-number">1.</span> <span class="toc-text">Docker容器基础入门实战</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Linux-Centos7环境下安装Docker"><span class="toc-number">1.1.</span> <span class="toc-text">Linux Centos7环境下安装Docker</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker镜像的搜索下载以及查看删除实战"><span class="toc-number">1.2.</span> <span class="toc-text">Docker镜像的搜索下载以及查看删除实战</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker核心基础之配置阿里云镜像加速"><span class="toc-number">1.3.</span> <span class="toc-text">Docker核心基础之配置阿里云镜像加速</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker核心基础之容器的构建等基本操作"><span class="toc-number">1.4.</span> <span class="toc-text">Docker核心基础之容器的构建等基本操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker核心基础之容器的文件复制与挂载"><span class="toc-number">1.5.</span> <span class="toc-text">Docker核心基础之容器的文件复制与挂载</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker核心必备之自定义镜像实战"><span class="toc-number">2.</span> <span class="toc-text">Docker核心必备之自定义镜像实战</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#docker目前镜像的制作的两种方法"><span class="toc-number">2.1.</span> <span class="toc-text">docker目前镜像的制作的两种方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Commit构建自定义镜像"><span class="toc-number">2.2.</span> <span class="toc-text">Commit构建自定义镜像</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#核心必备知识之Dockerfile构建镜像实战"><span class="toc-number">2.3.</span> <span class="toc-text">核心必备知识之Dockerfile构建镜像实战</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker核心知识之镜像分层结构剖析"><span class="toc-number">2.4.</span> <span class="toc-text">Docker核心知识之镜像分层结构剖析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#不得不掌握的Dockerfile基础指令"><span class="toc-number">2.5.</span> <span class="toc-text">不得不掌握的Dockerfile基础指令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实战系列之Dockerfile构建JAVA网站镜像"><span class="toc-number">2.6.</span> <span class="toc-text">实战系列之Dockerfile构建JAVA网站镜像</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实战系列之Dockerfile构建nginx镜像"><span class="toc-number">2.7.</span> <span class="toc-text">实战系列之Dockerfile构建nginx镜像</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实战系列之Dockerfile构建redis镜像"><span class="toc-number">2.8.</span> <span class="toc-text">实战系列之Dockerfile构建redis镜像</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实战系列之docker快速部署mysql数据库并初始化"><span class="toc-number">2.9.</span> <span class="toc-text">实战系列之docker快速部署mysql数据库并初始化</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker核心知识之网络模式与特权指令"><span class="toc-number">3.</span> <span class="toc-text">Docker核心知识之网络模式与特权指令</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker-容器的网络模式"><span class="toc-number">3.1.</span> <span class="toc-text">Docker 容器的网络模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker-容器的bridge模式实战"><span class="toc-number">3.2.</span> <span class="toc-text">Docker 容器的bridge模式实战</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker-容器的host模式实战"><span class="toc-number">3.3.</span> <span class="toc-text">Docker 容器的host模式实战</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker-容器的none模式介绍"><span class="toc-number">3.4.</span> <span class="toc-text">Docker 容器的none模式介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker-容器间基于Link实现单向通信"><span class="toc-number">3.5.</span> <span class="toc-text">Docker 容器间基于Link实现单向通信</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker容器间利用brige网桥实现双向通信"><span class="toc-number">3.6.</span> <span class="toc-text">Docker容器间利用brige网桥实现双向通信</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker容器的特权模式介绍"><span class="toc-number">3.7.</span> <span class="toc-text">Docker容器的特权模式介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker核心知识之Volume数据共享"><span class="toc-number">3.8.</span> <span class="toc-text">Docker核心知识之Volume数据共享</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#实战系列之利用Compose操作容器"><span class="toc-number">4.</span> <span class="toc-text">实战系列之利用Compose操作容器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#实用工具Docker-Compose的介绍与安装"><span class="toc-number">4.1.</span> <span class="toc-text">实用工具Docker-Compose的介绍与安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实用工具Docker-Compose的快速上手"><span class="toc-number">4.2.</span> <span class="toc-text">实用工具Docker-Compose的快速上手</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实用工具Docker-Compose核实用技能"><span class="toc-number">4.3.</span> <span class="toc-text">实用工具Docker-Compose核实用技能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实战项目篇之利用Docker-Compose快速搭建个人博客"><span class="toc-number">4.4.</span> <span class="toc-text">实战项目篇之利用Docker-Compose快速搭建个人博客</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实战项目篇之Docker-Compose-详细分析"><span class="toc-number">4.5.</span> <span class="toc-text">实战项目篇之Docker-Compose 详细分析</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker企业核心知识之镜像仓库实战"><span class="toc-number">5.</span> <span class="toc-text">Docker企业核心知识之镜像仓库实战</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#公司中Docker镜像仓库使用"><span class="toc-number">5.1.</span> <span class="toc-text">公司中Docker镜像仓库使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#阿里云镜像仓库的搭建与使用"><span class="toc-number">5.2.</span> <span class="toc-text">阿里云镜像仓库的搭建与使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#企业核心篇幅之harbor仓库搭建"><span class="toc-number">5.3.</span> <span class="toc-text">企业核心篇幅之harbor仓库搭建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#企业核心篇幅之harbor仓库配置与使用"><span class="toc-number">5.4.</span> <span class="toc-text">企业核心篇幅之harbor仓库配置与使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实战系列之本地镜像容器的载入与载出"><span class="toc-number">5.5.</span> <span class="toc-text">实战系列之本地镜像容器的载入与载出</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">Kaluna</div><div class="author-info__description text-center"></div><div class="follow-button"><a href="https://github.com/lxy1866" target="_blank" rel="noopener">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">20</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">28</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">11</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://gitee.com/YuerryHUAHUA/figure/raw/master/img/20210521080208.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">嘿，不停转的轮子</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/about">About</a><a class="site-page" href="/tags/">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> Search</span></a></span></div><div id="post-info"><div id="post-title">Docker入门到高级dockerfile</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-05-03</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Docker/">Docker</a><span class="post-meta__separator">|</span><i class="fa fa-comment-o post-meta__icon" aria-hidden="true"></i><a href="/2021/05/03/Docker%E5%85%A5%E9%97%A8%E5%88%B0%E9%AB%98%E7%BA%A7dockerfile/#disqus_thread"><span class="disqus-comment-count" data-disqus-identifier="2021/05/03/Docker入门到高级dockerfile/"></span></a></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="Docker容器基础入门实战"><a href="#Docker容器基础入门实战" class="headerlink" title="Docker容器基础入门实战"></a>Docker容器基础入门实战</h1><h2 id="Linux-Centos7环境下安装Docker"><a href="#Linux-Centos7环境下安装Docker" class="headerlink" title="Linux Centos7环境下安装Docker"></a>Linux Centos7环境下安装Docker</h2><p>参考文章：<a href="https://help.aliyun.com/document_detail/51853.html" target="_blank" rel="noopener">https://help.aliyun.com/document_detail/51853.html</a> </p>
<p>查看docker版本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker version</span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@CentOS7 yum.repos.d]<span class="comment"># docker version</span></span><br><span class="line">Client:</span><br><span class="line"> Version:         1.13.1</span><br><span class="line"> API version:     1.26</span><br><span class="line"> Package version: docker-1.13.1-204.git0be3e21.el7.x86_64</span><br><span class="line"> Go version:      go1.10.3</span><br><span class="line"> Git commit:      0be3e21/1.13.1</span><br><span class="line"> Built:           Fri Mar 19 13:57:09 2021</span><br><span class="line"> OS/Arch:         linux/amd64</span><br><span class="line"></span><br><span class="line">Server:</span><br><span class="line"> Version:         1.13.1</span><br><span class="line"> API version:     1.26 (minimum version 1.12)</span><br><span class="line"> Package version: docker-1.13.1-204.git0be3e21.el7.x86_64</span><br><span class="line"> Go version:      go1.10.3</span><br><span class="line"> Git commit:      0be3e21/1.13.1</span><br><span class="line"> Built:           Fri Mar 19 13:57:09 2021</span><br><span class="line"> OS/Arch:         linux/amd64</span><br><span class="line"> Experimental:    <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<p>查看docker的详细信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker info</span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">[root@CentOS7 yum.repos.d]<span class="comment"># docker info</span></span><br><span class="line">Containers: 5</span><br><span class="line"> Running: 0</span><br><span class="line"> Paused: 0</span><br><span class="line"> Stopped: 5</span><br><span class="line">Images: 5</span><br><span class="line">Server Version: 1.13.1</span><br><span class="line">Storage Driver: overlay2</span><br><span class="line"> Backing Filesystem: extfs</span><br><span class="line"> Supports d_type: <span class="literal">true</span></span><br><span class="line"> Native Overlay Diff: <span class="literal">true</span></span><br><span class="line">Logging Driver: journald</span><br><span class="line">Cgroup Driver: systemd</span><br><span class="line">Plugins:</span><br><span class="line"> Volume: <span class="built_in">local</span></span><br><span class="line"> Network: bridge host macvlan null overlay</span><br><span class="line">Swarm: inactive</span><br><span class="line">Runtimes: runc docker-runc</span><br><span class="line">Default Runtime: docker-runc</span><br><span class="line">Init Binary: /usr/libexec/docker/docker-init-current</span><br><span class="line">containerd version:  (expected: aa8187dbd3b7ad67d8e5e3a15115d3eef43a7ed1)</span><br><span class="line">runc version: 66aedde759f33c190954815fb765eedc1d782dd9 (expected: 9df8b306d01f59d3a8029be411de015b7304dd8f)</span><br><span class="line">init version: fec3683b971d9c3ef73f284f176672c44b448662 (expected: 949e6facb77383876aeff8a6944dde66b3089574)</span><br><span class="line">Security Options:</span><br><span class="line"> seccomp</span><br><span class="line">  WARNING: You<span class="string">'re not using the default seccomp profile</span></span><br><span class="line"><span class="string">  Profile: /etc/docker/seccomp.json</span></span><br><span class="line"><span class="string">Kernel Version: 3.10.0-1160.15.2.el7.x86_64</span></span><br><span class="line"><span class="string">Operating System: CentOS Linux 7 (Core)</span></span><br><span class="line"><span class="string">OSType: linux</span></span><br><span class="line"><span class="string">Architecture: x86_64</span></span><br><span class="line"><span class="string">Number of Docker Hooks: 3</span></span><br><span class="line"><span class="string">CPUs: 2</span></span><br><span class="line"><span class="string">Total Memory: 3.561 GiB</span></span><br><span class="line"><span class="string">Name: CentOS7.9shili</span></span><br><span class="line"><span class="string">ID: IEMJ:VMKA:YMU4:WOBC:O5PP:M2DQ:4QWA:6QZF:HAHA:D6QY:4V2O:YGLY</span></span><br><span class="line"><span class="string">Docker Root Dir: /var/lib/docker</span></span><br><span class="line"><span class="string">Debug Mode (client): false</span></span><br><span class="line"><span class="string">Debug Mode (server): false</span></span><br><span class="line"><span class="string">Registry: https://index.docker.io/v1/</span></span><br><span class="line"><span class="string">Experimental: false</span></span><br><span class="line"><span class="string">Insecure Registries:</span></span><br><span class="line"><span class="string"> 127.0.0.0/8</span></span><br><span class="line"><span class="string">Registry Mirrors:</span></span><br><span class="line"><span class="string"> https://pb5bklzr.mirror.aliyuncs.com</span></span><br><span class="line"><span class="string">Live Restore Enabled: false</span></span><br><span class="line"><span class="string">Registries: docker.io (secure)</span></span><br></pre></td></tr></table></figure>

<h2 id="Docker镜像的搜索下载以及查看删除实战"><a href="#Docker镜像的搜索下载以及查看删除实战" class="headerlink" title="Docker镜像的搜索下载以及查看删除实战"></a>Docker镜像的搜索下载以及查看删除实战</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 什么是镜像？</span></span><br><span class="line"><span class="comment"># 查看本地镜像：</span></span><br><span class="line">docker images</span><br><span class="line"><span class="comment"># 搜索镜像：</span></span><br><span class="line">docker search centos</span><br><span class="line"><span class="comment"># 搜索镜像并过滤是官方的：</span></span><br><span class="line">docker search --filter <span class="string">"is-official=true"</span> centos</span><br><span class="line"><span class="comment"># 搜索镜像并过滤大于多少颗星星的：</span></span><br><span class="line">docker search --filter stars=10 centos</span><br><span class="line"><span class="comment"># 下载centos7镜像：</span></span><br><span class="line">docker pull centos:7</span><br><span class="line"><span class="comment"># 修改本地镜像名字（小写）：</span></span><br><span class="line">docker tag centos:7 mycentos:1</span><br><span class="line"><span class="comment"># 本地镜像的删除：</span></span><br><span class="line">docker rmi centos:7</span><br></pre></td></tr></table></figure>

<h2 id="Docker核心基础之配置阿里云镜像加速"><a href="#Docker核心基础之配置阿里云镜像加速" class="headerlink" title="Docker核心基础之配置阿里云镜像加速"></a>Docker核心基础之配置阿里云镜像加速</h2><p>阿里云镜像加速器配置地址：<a href="https://cr.console.aliyun.com/cn-shenzhen/instances/mirrors" target="_blank" rel="noopener">https://cr.console.aliyun.com/cn-shenzhen/instances/mirrors</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置步骤：</span></span><br><span class="line">vi /etc/docker/daemon.json</span><br><span class="line"><span class="comment"># 重启：</span></span><br><span class="line">systemctl daemon-reload &amp;&amp; systemctl restart docker</span><br><span class="line"><span class="comment"># 添加</span></span><br><span class="line">&#123;</span><br><span class="line"> <span class="string">"registry-mirrors"</span>: [<span class="string">"https://pb5bklzr.mirror.aliyuncs.com"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Docker核心基础之容器的构建等基本操作"><a href="#Docker核心基础之容器的构建等基本操作" class="headerlink" title="Docker核心基础之容器的构建等基本操作"></a>Docker核心基础之容器的构建等基本操作</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 运行一个容器</span></span><br><span class="line">docker run -it 镜像的名字或者id</span><br><span class="line">-i ：表示以交互模式运行容器（让容器的标准输入保持打开）</span><br><span class="line">-d：表示后台运行容器，并返回容器ID</span><br><span class="line">-t：为容器重新分配一个伪输入终端</span><br><span class="line"><span class="built_in">exit</span> 退出伪输入终端</span><br><span class="line"></span><br><span class="line">查看本地所有的容器：docker ps -a</span><br><span class="line">查看本地正在运行的容器：docker ps</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果不加上7，默认就是 centos:latest</span></span><br><span class="line">docker run -itd --name=mycentos centos:7</span><br><span class="line"><span class="comment"># 输出一串很长的容器id</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 停止容器：</span></span><br><span class="line">docker stop CONTAINER_ID / CONTAINER_NAME</span><br><span class="line"><span class="comment"># 如果为容器指定了name</span></span><br><span class="line">docker stop NAMES</span><br><span class="line">docker stop/start/restart mycentos</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除容器：</span></span><br><span class="line">docker rm CONTAINER_ID / CONTAINER_NAME</span><br><span class="line"><span class="comment"># 强制删除容器：</span></span><br><span class="line">docker rm -f CONTAINER_ID / CONTAINER_NAME</span><br><span class="line"><span class="comment"># 查看容器详细信息：</span></span><br><span class="line">docker inspect CONTAINER_ID / CONTAINER_NAME</span><br><span class="line"><span class="comment"># 进入容器 /bin/bash 表示以什么容器进去的</span></span><br><span class="line">docker <span class="built_in">exec</span> -it mycentos /bin/bash</span><br><span class="line"><span class="comment"># 启动多个容器，每个容器的id都是不一样的</span></span><br><span class="line"><span class="comment"># 一次性停止所有容器：</span></span><br><span class="line">docker stop $(docker ps -a -q)</span><br><span class="line"><span class="comment"># 批量启动所有容器</span></span><br><span class="line">docker start $(docker ps -a -q)</span><br></pre></td></tr></table></figure>

<h2 id="Docker核心基础之容器的文件复制与挂载"><a href="#Docker核心基础之容器的文件复制与挂载" class="headerlink" title="Docker核心基础之容器的文件复制与挂载"></a>Docker核心基础之容器的文件复制与挂载</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从宿主机复制到容器：docker cp 宿主机本地路径 容器名字/ID：容器路径</span></span><br><span class="line"><span class="built_in">cd</span> /root</span><br><span class="line">cat &gt;123.txt</span><br><span class="line">docker cp /root/123.txt mycentos:/home/</span><br><span class="line"><span class="comment"># 进入容器</span></span><br><span class="line">docker <span class="built_in">exec</span> -it mycentos /bin/bash</span><br><span class="line"><span class="built_in">cd</span> home/</span><br><span class="line">ls </span><br><span class="line"></span><br><span class="line"><span class="comment"># 继续往宿主机追加，在容器伪终端不能同步看到添加的内容</span></span><br><span class="line">cat &gt;&gt;123.txt</span><br><span class="line">jjjjj</span><br><span class="line"><span class="comment"># 在容器里新建文件</span></span><br><span class="line"><span class="comment"># 从容器复制到宿主机：docker cp 容器名字/ID：容器路径 宿主机本地路径</span></span><br><span class="line">docker cp mycentos:/home/456.txt /root</span><br><span class="line"></span><br><span class="line"><span class="comment"># 宿主机文件夹挂载到容器里：docker run -itd -v 宿主机路径:容器路径 镜像ID</span></span><br><span class="line">mkdir xdclass</span><br><span class="line"><span class="comment"># 只能重新构建一个新的容器，再挂载上去</span></span><br><span class="line">docker run -itd -v /root/xdclass/:/home centos:7</span><br><span class="line"><span class="comment"># 进入容器</span></span><br><span class="line">docker <span class="built_in">exec</span> -it  CONTAINER_ID / CONTAINER_NAME /bin/bash</span><br><span class="line"><span class="built_in">cd</span> /home </span><br><span class="line">ls</span><br><span class="line"><span class="comment"># 到宿主机下创建一个文件</span></span><br><span class="line"><span class="built_in">cd</span> xdclass </span><br><span class="line">touch 123.txt </span><br><span class="line"><span class="comment"># 到容器中可以看到有个文件123.txt</span></span><br><span class="line"><span class="comment"># 很明显数据是同步的</span></span><br></pre></td></tr></table></figure>

<h1 id="Docker核心必备之自定义镜像实战"><a href="#Docker核心必备之自定义镜像实战" class="headerlink" title="Docker核心必备之自定义镜像实战"></a>Docker核心必备之自定义镜像实战</h1><h2 id="docker目前镜像的制作的两种方法"><a href="#docker目前镜像的制作的两种方法" class="headerlink" title="docker目前镜像的制作的两种方法"></a>docker目前镜像的制作的两种方法</h2><ol>
<li>基于Docker Commit制作镜像</li>
<li>基于dockerfile制作镜像，Dockerfile方式为主流的制作镜像方式</li>
</ol>
<h2 id="Commit构建自定义镜像"><a href="#Commit构建自定义镜像" class="headerlink" title="Commit构建自定义镜像"></a>Commit构建自定义镜像</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动并进入容器：</span></span><br><span class="line">docker run -it centos:7 /bin/bash</span><br><span class="line"><span class="comment"># 在/home 路径下创建xdclass文件夹：</span></span><br><span class="line">mkdir /home/xdclass</span><br><span class="line"><span class="comment"># 安装ifconfig命令：</span></span><br><span class="line">yum -y install net-tools</span><br><span class="line"><span class="comment"># 重启容器，查看容器的xdclass文件夹还在不在，ifconfig命令能不能用</span></span><br><span class="line">docker restart 67862569d4f</span><br><span class="line"><span class="comment"># 删除容器，再重新启动一个容器进入查看有没有xdclass文件夹：很显然这个文件和命令都不在了</span></span><br><span class="line">docker rm 67862569d4f7 &amp;&amp; docker run -it centos:7 /bin/bash</span><br><span class="line"><span class="comment"># 在删除第一个容器前先构建镜像：</span></span><br><span class="line">docker run -it centos:7 /bin/bash</span><br><span class="line">docker commit 4eb9d14ebb18 mycentos:v1</span><br><span class="line">docker commit -a <span class="string">"XD"</span> -m <span class="string">"mkdir /home/xdclass"</span> 4eb9d14ebb18 mycentos:v1</span><br><span class="line">-a：标注作者</span><br><span class="line">-m：说明注释，比如在这个容器里做了什么操作</span><br><span class="line"><span class="comment"># 查看镜像，发现多了一个mycentos </span></span><br><span class="line">docker images </span><br><span class="line"><span class="comment"># 查看详细信息：</span></span><br><span class="line">docker inspect mycentos</span><br><span class="line"><span class="comment"># 启动容器：</span></span><br><span class="line">docker run -itd mycentos:v1 /bin/bash</span><br><span class="line"><span class="comment"># 进入容器查看：里面的文件存在和ifconfig命令能够使用</span></span><br><span class="line">docker <span class="built_in">exec</span> -it 2a4d38eca64f /bin/bash</span><br></pre></td></tr></table></figure>

<h2 id="核心必备知识之Dockerfile构建镜像实战"><a href="#核心必备知识之Dockerfile构建镜像实战" class="headerlink" title="核心必备知识之Dockerfile构建镜像实战"></a>核心必备知识之Dockerfile构建镜像实战</h2><ul>
<li><p>Dockerfile</p>
<p>注意：dockfile和123.txt的路径要一样</p>
</li>
</ul>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># this is a dockerfile</span></span><br><span class="line"><span class="keyword">FROM</span> centos:</span><br><span class="line"><span class="keyword">MAINTAINER</span> XD <span class="number">123456</span>@qq.com</span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">echo</span> <span class="string">"正在构建镜像！！！"</span></span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /home/xdclass</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> 123.txt /home/xdclass</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum install -y net-tools</span></span><br></pre></td></tr></table></figure>

<ul>
<li>构建镜像</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看：</span></span><br><span class="line">docker images</span><br><span class="line"><span class="comment"># 构建, . 这个点是指当前路径的意思</span></span><br><span class="line">docker build -t mycentos:v2 .</span><br><span class="line"><span class="comment"># 查看：</span></span><br><span class="line">docker images</span><br><span class="line"><span class="comment"># 进入验证：验证成功</span></span><br><span class="line">docker run -it mycentos:v2 /bin/bash</span><br><span class="line"><span class="comment"># 运行后直接进入工作路径/home/xdclass</span></span><br></pre></td></tr></table></figure>

<h2 id="Docker核心知识之镜像分层结构剖析"><a href="#Docker核心知识之镜像分层结构剖析" class="headerlink" title="Docker核心知识之镜像分层结构剖析"></a>Docker核心知识之镜像分层结构剖析</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">history</span> mycentos:v2</span><br></pre></td></tr></table></figure>

<p>从输出中可以看出每一个步骤都会生成一个镜像层，叠加在基础镜像层上面</p>
<p>镜像层是静态的，只可以读不可以修改，而容器层是动态的，可以进行修改</p>
<p><img src="https://gitee.com/YuerryHUAHUA/figure/raw/master/img/20210503122718.png" alt="image-20210503122716371"></p>
<p>总结：共享资源；对容器的任何改动都是发生容器层；容器层是可写可读，而镜像层只读</p>
<h2 id="不得不掌握的Dockerfile基础指令"><a href="#不得不掌握的Dockerfile基础指令" class="headerlink" title="不得不掌握的Dockerfile基础指令"></a>不得不掌握的Dockerfile基础指令</h2><ul>
<li>命令格式</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell命令格式：RUN yum install -y net-tools</span><br><span class="line">exec命令格式：RUN [ &quot;yum&quot;,&quot;install&quot; ,&quot;-y&quot; ,&quot;net-tools&quot;]</span><br></pre></td></tr></table></figure>

<ul>
<li>一些常用的Dockerfile指令</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">FROM：基于哪个镜像</span><br><span class="line">MAINTAINER：注明作者</span><br><span class="line">COPY：复制文件进入镜像（只能用相对路径，不能用绝对路径）</span><br><span class="line">ADD：复制文件进入镜像（假如文件是.tar.gz文件会解压）</span><br><span class="line">WORKDIR：指定工作目录，假如路径不存在会创建路径</span><br><span class="line">ENV：设置环境变量</span><br><span class="line">EXPOSE：暴露容器端口</span><br><span class="line">RUN：在构建镜像的时候执行，作用于镜像层面</span><br><span class="line">ENTRYPOINT：在容器启动的时候执行，作用于容器层，dockerfile里有多条时只允许执行最后一条</span><br><span class="line">CMD：在容器启动的时候执行，作用于容器层，dockerfile里有多条时只允许执行最后一条，与ENTRYPOINT的区别就是：容器启动后执行默认的命令或者参数，允许被修改</span><br></pre></td></tr></table></figure>

<ul>
<li>dockerfile</li>
</ul>
<p><img src="https://gitee.com/YuerryHUAHUA/figure/raw/master/img/20210503125100.png" alt="image-20210503125049245"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t mycentos:v3 .</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/YuerryHUAHUA/figure/raw/master/img/20210503125404.png" alt="image-20210503125214739"></p>
<ul>
<li>修改dockerfile，ENTRYPOINT可以接收CMD的参数（前提是exec命令格式）</li>
</ul>
<p><img src="https://gitee.com/YuerryHUAHUA/figure/raw/master/img/20210503131305.png" alt="image-20210503131302967"></p>
<ul>
<li>构建容器并执行</li>
</ul>
<p><img src="https://gitee.com/YuerryHUAHUA/figure/raw/master/img/20210503131925.png" alt="image-20210503131438829"></p>
<ul>
<li>在运行后加入 aux参数，可以覆盖CMD</li>
</ul>
<p><img src="https://gitee.com/YuerryHUAHUA/figure/raw/master/img/20210503131933.png" alt="image-20210503131543407"></p>
<h2 id="实战系列之Dockerfile构建JAVA网站镜像"><a href="#实战系列之Dockerfile构建JAVA网站镜像" class="headerlink" title="实战系列之Dockerfile构建JAVA网站镜像"></a>实战系列之Dockerfile构建JAVA网站镜像</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 本地宿主机配置jdk</span></span><br><span class="line">vi /etc/profile</span><br><span class="line"><span class="comment"># copy到 /etc/profile</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/<span class="built_in">local</span>/jdk</span><br><span class="line"><span class="built_in">export</span> JRE_HOME=<span class="variable">$JAVA_HOME</span>/jre</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=<span class="variable">$JAVA_HOME</span>/lib:<span class="variable">$JRE_HOME</span>/lib:<span class="variable">$CLASSPATH</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$JRE_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载环境变量</span></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure>

<p>Dockerfile构建java环境，注意dockerfile要放在安装包的同个目录下</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centos:<span class="number">7</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> jdk-8u211-linux-x64.tar.gz /usr/<span class="built_in">local</span></span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> mv /usr/<span class="built_in">local</span>/jdk-1.8.0_211 /usr/<span class="built_in">local</span>/jdk</span></span><br><span class="line"><span class="keyword">ENV</span> JAVA_HOME=/usr/local/jdk</span><br><span class="line"><span class="keyword">ENV</span> JRE_HOME=$JAVA_HOME/jre</span><br><span class="line"><span class="keyword">ENV</span> CLASSPATH=$JAVA_HOME/lib:$JRE_HOME/lib:$CLASSPATH</span><br><span class="line"><span class="keyword">ENV</span> PATH=$JAVA_HOME/bin:$JRE_HOME/bin:$PATH</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> apache-tomcat-8.5.35.tar.gz /usr/<span class="built_in">local</span></span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> mv /usr/<span class="built_in">local</span>/apache-tomcat-8.5.35  /usr/<span class="built_in">local</span>/</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8080</span></span><br><span class="line"><span class="comment"># 如果使用我们常用的startup.sh作为容器启动脚本，容器会自动关闭，此时Tomcat在后台运行，没有在前台运行的线程，所以只能在前台启动tomcat</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">"/usr/local/tomcat/bin/catalina.sh"</span>,<span class="string">"run"</span>]</span></span><br></pre></td></tr></table></figure>

<p>构建，启动容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker build -t mycentos:jdk .</span><br><span class="line">docker run -itd -p 80:8080  mycentos:jdk /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># 宿主机挂载到容器</span></span><br><span class="line">docker run -itd -p 8080:8080 -v /root/<span class="built_in">test</span>/ROOT:/usr/<span class="built_in">local</span>/tomcat/webapps/ROOT mycentos:jdk /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建index.html</span></span><br><span class="line"><span class="built_in">cd</span> /root/<span class="built_in">test</span>/ROOT</span><br><span class="line">vi index.html</span><br></pre></td></tr></table></figure>

<p>网页进行访问验证</p>
<h2 id="实战系列之Dockerfile构建nginx镜像"><a href="#实战系列之Dockerfile构建nginx镜像" class="headerlink" title="实战系列之Dockerfile构建nginx镜像"></a>实战系列之Dockerfile构建nginx镜像</h2><p><strong>Dockerfile构建nginx</strong></p>
<ul>
<li>安装nginx的shell脚本：/usr/local/nginx_install.sh(进入安装包里面)</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">yum install -y gcc gcc-c++ make pcre pcre-devel zlib zlib-devel</span><br><span class="line">cd /usr/local/nginx-1.16.0</span><br><span class="line">./configure --prefix=/usr/local/nginx &amp;&amp; make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<ul>
<li>dockfile</li>
</ul>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centos:</span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> nginx-1.16.0.tar.gz /usr/<span class="built_in">local</span></span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> nginx_install.sh /usr/<span class="built_in">local</span></span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> sh /usr/<span class="built_in">local</span>/nginx_install.sh</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span></span><br></pre></td></tr></table></figure>

<ul>
<li>制作Nginx镜像</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t mycentos:nginx .</span><br></pre></td></tr></table></figure>

<ul>
<li>使用前台方式永久运行：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -itd -p 80:80 mycentos:nginx &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx -g &quot;daemon off;&quot;</span><br></pre></td></tr></table></figure>

<p>Nginx镜像启动注意：在容器里nginx是以daemon方式启动，退出容器时，nginx程序也会随着停止</p>
<h2 id="实战系列之Dockerfile构建redis镜像"><a href="#实战系列之Dockerfile构建redis镜像" class="headerlink" title="实战系列之Dockerfile构建redis镜像"></a>实战系列之Dockerfile构建redis镜像</h2><ul>
<li><p>不用dockerfile安装redis的过程</p>
<p>编写redis编译安装shell脚本redis_install.sh</p>
<p>sh redis_install.sh</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">yum install -y gcc gcc-c++ make openssl openssl-devel</span><br><span class="line">cd /home/redis-4.0.9</span><br><span class="line"><span class="meta">#</span><span class="bash"> PREFIX=/usr/<span class="built_in">local</span>/redis 指定安装路径 写在中间也没错</span></span><br><span class="line">make &amp;&amp; make PREFIX=/usr/local/redis install</span><br><span class="line">mkdir -p /usr/local/redis/conf/</span><br><span class="line">cp /home/redis-4.0.9/redis.conf /usr/local/redis/conf/</span><br></pre></td></tr></table></figure>

<p>默认是以前台的方式启动</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/<span class="built_in">local</span>/redis/bin/redis-server /usr/<span class="built_in">local</span>/redis/conf/redis.conf</span><br></pre></td></tr></table></figure>
</li>
<li><p>编写dockerfile</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centos:</span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> redis-4.0.9.tar.gz /home</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> redis_install.sh /home</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> sh /home/redis_install.sh</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> /usr/<span class="built_in">local</span>/redis/bin/redis-server /usr/<span class="built_in">local</span>/redis/conf/redis.conf</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>测试redis:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动容器：</span></span><br><span class="line">docker run -itd -p 6380:6379 mycentos:redis <span class="comment">#6380是宿主机端口， 6379是容器的端口</span></span><br><span class="line"><span class="comment"># 进入容器：</span></span><br><span class="line">docker <span class="built_in">exec</span> -it 9b402baeaba7 /bin/bash</span><br><span class="line"><span class="comment"># 宿主机连接redis：</span></span><br><span class="line">/usr/<span class="built_in">local</span>/redis/bin/redis-cli -p 6380</span><br><span class="line"><span class="comment"># 验证</span></span><br></pre></td></tr></table></figure>

<p>宿主机连接容器的redis服务，如果没有连接成功，说明容器的redis开启了保护模式，修改配置文件redis.conf</p>
<p>设置protected-mode no</p>
<p>同时注释 bind 127.0.0.1</p>
<p>或者在脚本文件redis_install.sh添加最后两行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">yum install -y gcc gcc-c++ make openssl openssl-devel</span><br><span class="line">cd /home/redis-4.0.</span><br><span class="line">make &amp;&amp; make PREFIX=/usr/local/redis install</span><br><span class="line">mkdir -p /usr/local/redis/conf/</span><br><span class="line">cp /home/redis-4.0.9/redis.conf /usr/local/redis/conf/</span><br><span class="line">sed -i '69s/127.0.0.1/0.0.0.0/' /usr/local/redis/conf/redis.conf</span><br><span class="line">sed -i '88s/protected-mode yes/protected-mode no/' /usr/local/redis/conf/redis.conf</span><br></pre></td></tr></table></figure>

<p>docker restart 容器的id</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost home]<span class="comment"># /usr/local/redis/bin/redis-cli -p 6380</span></span><br><span class="line">127.0.0.1:6380&gt; <span class="built_in">set</span> name xdclass</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6380&gt; get name</span><br><span class="line"><span class="string">"xdclass"</span></span><br><span class="line">127.0.0.1:6380&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="实战系列之docker快速部署mysql数据库并初始化"><a href="#实战系列之docker快速部署mysql数据库并初始化" class="headerlink" title="实战系列之docker快速部署mysql数据库并初始化"></a>实战系列之docker快速部署mysql数据库并初始化</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 官方网址：</span></span><br><span class="line"><span class="comment"># https://hub.docker.com/</span></span><br><span class="line"><span class="comment"># 启动命令：</span></span><br><span class="line">docker run --name some-mysql -p 3307:3306 -e MYSQL_ROOT_PASSWORD=abc123456 -d mysql:5.7</span><br><span class="line"><span class="comment"># 进入容器命令：</span></span><br><span class="line">docker <span class="built_in">exec</span> -it 4336ae28fbfa env LANG=C.UTF-8 /bin/bas</span><br></pre></td></tr></table></figure>

<p>初始化sql语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 建库</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> <span class="string">`db_student`</span>;</span><br><span class="line"><span class="keyword">SET</span> character_set_client = utf8;</span><br><span class="line"><span class="keyword">use</span> db_student;</span><br><span class="line"><span class="comment"># 建表</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">exists</span> <span class="string">`user`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> (</span><br><span class="line"><span class="keyword">id</span> <span class="built_in">tinyint</span>(<span class="number">5</span>) zerofill auto_increment <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'学生学号'</span>,</span><br><span class="line"><span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">default</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'学生姓名'</span>,</span><br><span class="line">age <span class="built_in">tinyint</span> <span class="keyword">default</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'学生年龄'</span>,</span><br><span class="line"><span class="keyword">class</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">default</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'学生班级'</span>,</span><br><span class="line">sex <span class="built_in">char</span>(<span class="number">5</span>) <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'学生性别'</span>,</span><br><span class="line"><span class="keyword">unique</span> <span class="keyword">key</span> (<span class="keyword">id</span>)</span><br><span class="line">)<span class="keyword">engine</span>=<span class="keyword">innodb</span> <span class="keyword">charset</span>=utf8;</span><br><span class="line"><span class="comment"># 插入数据</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span> <span class="keyword">values</span>(<span class="string">'1'</span>,<span class="string">'小明'</span>,<span class="string">'15'</span>,<span class="string">'初三'</span>,<span class="string">'男'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span> <span class="keyword">values</span>(<span class="string">'2'</span>,<span class="string">'小红'</span>,<span class="string">'13'</span>,<span class="string">'初二'</span>,<span class="string">'女'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span> <span class="keyword">values</span>(<span class="string">'3'</span>,<span class="string">'小东'</span>,<span class="string">'14'</span>,<span class="string">'初一'</span>,<span class="string">'男'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span> <span class="keyword">values</span>(<span class="string">'4'</span>,<span class="string">'小西'</span>,<span class="string">'12'</span>,<span class="string">'初二'</span>,<span class="string">'男'</span>);</span><br></pre></td></tr></table></figure>

<p>查看数据库会发现中文根本插入不进去，直接拉取的mysql的dockerfile的基础镜像不是centos</p>
<p>那这个容器就没用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除容器</span></span><br><span class="line">dockerfile rm -f 容器的id</span><br><span class="line"><span class="comment"># 重新运行另一个容器</span></span><br><span class="line">docker run --name some-mysql -p 3307:3306 -e MYSQL_ROOT_PASSWORD=abc123456 -d mysql:5.7</span><br><span class="line">docker <span class="built_in">exec</span> -it 4336ae28fbfa env LANG=C.UTF-8 /bin/bash</span><br></pre></td></tr></table></figure>

<p>建立一个脚本init.sql</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 建库</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> <span class="string">`db_student`</span>;</span><br><span class="line"><span class="keyword">SET</span> character_set_client = utf8;</span><br><span class="line"><span class="keyword">use</span> db_student;</span><br><span class="line"><span class="comment"># 建表</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">exists</span> <span class="string">`user`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> (</span><br><span class="line"><span class="keyword">id</span> <span class="built_in">tinyint</span>(<span class="number">5</span>) zerofill auto_increment <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'学生学号'</span>,</span><br><span class="line"><span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">default</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'学生姓名'</span>,</span><br><span class="line">age <span class="built_in">tinyint</span> <span class="keyword">default</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'学生年龄'</span>,</span><br><span class="line"><span class="keyword">class</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">default</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'学生班级'</span>,</span><br><span class="line">sex <span class="built_in">char</span>(<span class="number">5</span>) <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'学生性别'</span>,</span><br><span class="line"><span class="keyword">unique</span> <span class="keyword">key</span> (<span class="keyword">id</span>)</span><br><span class="line">)<span class="keyword">engine</span>=<span class="keyword">innodb</span> <span class="keyword">charset</span>=utf8;</span><br><span class="line"><span class="comment"># 插入数据</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span> <span class="keyword">values</span>(<span class="string">'1'</span>,<span class="string">'小明'</span>,<span class="string">'15'</span>,<span class="string">'初三'</span>,<span class="string">'男'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span> <span class="keyword">values</span>(<span class="string">'2'</span>,<span class="string">'小红'</span>,<span class="string">'13'</span>,<span class="string">'初二'</span>,<span class="string">'女'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span> <span class="keyword">values</span>(<span class="string">'3'</span>,<span class="string">'小东'</span>,<span class="string">'14'</span>,<span class="string">'初一'</span>,<span class="string">'男'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span> <span class="keyword">values</span>(<span class="string">'4'</span>,<span class="string">'小西'</span>,<span class="string">'12'</span>,<span class="string">'初二'</span>,<span class="string">'男'</span>);</span><br></pre></td></tr></table></figure>

<p>cat &gt;init.sql</p>
<ul>
<li>新建dockerfile</li>
</ul>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> mysql:<span class="number">5.7</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /docker-entrypoint-initdb.d <span class="comment"># 这里无所谓</span></span></span><br><span class="line"><span class="keyword">ENV</span> LANG=C.UTF-<span class="number">8</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> init.sql . <span class="comment"># 用copy只会复制，不会执行这个文件，ADD有解压和执行的作用</span></span></span><br></pre></td></tr></table></figure>

<ul>
<li>构建，执行，进入容器，查表</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker build -t my-mysql:5.7 .</span><br><span class="line">docker run --name some-mysql -p 3307:3306 -e MYSQL_ROOT_PASSWORD=abc123456 -d my-mysql:5.7</span><br><span class="line">docker <span class="built_in">exec</span> -it 容器id  /bin/bash</span><br><span class="line">select * from db_student.user;</span><br></pre></td></tr></table></figure>

<h1 id="Docker核心知识之网络模式与特权指令"><a href="#Docker核心知识之网络模式与特权指令" class="headerlink" title="Docker核心知识之网络模式与特权指令"></a>Docker核心知识之网络模式与特权指令</h1><h2 id="Docker-容器的网络模式"><a href="#Docker-容器的网络模式" class="headerlink" title="Docker 容器的网络模式"></a>Docker 容器的网络模式</h2><p>默认的三种网络模式： </p>
<ol>
<li>bridge：桥接模式 </li>
<li>host：主机模式 </li>
<li>none：无网络模式 </li>
</ol>
<p>查看网络模式： </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker network ls</span><br><span class="line"></span><br><span class="line"><span class="comment"># --net 指定启动的网络模式</span></span><br></pre></td></tr></table></figure>

<h2 id="Docker-容器的bridge模式实战"><a href="#Docker-容器的bridge模式实战" class="headerlink" title="Docker 容器的bridge模式实战"></a>Docker 容器的bridge模式实战</h2><p>Docker桥接网络模式 </p>
<p>桥接模式是docker 的默认网络设置，当Docker服务启动时，会在主机上创建一个名为docker0的虚拟网桥，并选择一个和宿主机不同的IP地址和子网分配给docker0网桥 </p>
<p>桥接拓扑图</p>
<p><img src="https://gitee.com/YuerryHUAHUA/figure/raw/master/img/20210503171542.png" alt="image-20210503171539187"></p>
<p>安装工具：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum -y install net-tools <span class="comment"># route -n 查看路由表</span></span><br><span class="line">yum install -y bridge-utils <span class="comment"># brctl show 当前网桥的连接情况</span></span><br></pre></td></tr></table></figure>

<p>查看桥接情况：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># brctl show</span></span><br><span class="line">bridge name 	bridge id 			STP enabled 	interfaces</span><br><span class="line">docker0 		8000.0242055f4af6 	no 				veth60d950c</span><br><span class="line">												 veth827b88f</span><br><span class="line">											      vethaabef5c</span><br><span class="line">												  vethd22be73</span><br><span class="line">											      vethe1396d2</span><br></pre></td></tr></table></figure>

<h2 id="Docker-容器的host模式实战"><a href="#Docker-容器的host模式实战" class="headerlink" title="Docker 容器的host模式实战"></a>Docker 容器的host模式实战</h2><p>host 模式：该模式下容器是不会拥有自己的ip地址，而是使用宿主机的ip地址和端口。</p>
<p><img src="https://gitee.com/YuerryHUAHUA/figure/raw/master/img/20210503172039.png" alt="image-20210503172036787"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动nginx容器命令并防火墙放开80端口：</span></span><br><span class="line">docker run -d --net=host mycentos:nginx /usr/<span class="built_in">local</span>/nginx/sbin/nginx -g <span class="string">"daemon off;"</span></span><br><span class="line">firewall-cmd --zone=public --add-port=80/tcp --permanent</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure>

<h2 id="Docker-容器的none模式介绍"><a href="#Docker-容器的none模式介绍" class="headerlink" title="Docker 容器的none模式介绍"></a>Docker 容器的none模式介绍</h2><p>none模式：关闭模式，无法连外网</p>
<h2 id="Docker-容器间基于Link实现单向通信"><a href="#Docker-容器间基于Link实现单向通信" class="headerlink" title="Docker 容器间基于Link实现单向通信"></a>Docker 容器间基于Link实现单向通信</h2><p><img src="https://gitee.com/YuerryHUAHUA/figure/raw/master/img/20210503175947.png" alt=""></p>
<p><img src="https://gitee.com/YuerryHUAHUA/figure/raw/master/img/20210503180718.png" alt=""></p>
<p><img src="https://gitee.com/YuerryHUAHUA/figure/raw/master/img/20210503181249.png" alt=""></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动mysql数据库容器：</span></span><br><span class="line">docker run --name mydb -e MYSQL_ROOT_PASSWORD=abc123456 -d mysql:5.7</span><br><span class="line"><span class="comment"># 启动tomcat应用容器并link到mysql数据库：</span></span><br><span class="line">docker run -itd --name tomcat1 --link mydb tomcat:tag</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意：mydb 这个容器一定要存在！</span></span><br><span class="line"><span class="comment"># 官方版的mysql 5.7 需要安装工具才有ping命令:</span></span><br><span class="line">apt-get update &amp;&amp; apt-get install iputils-ping</span><br><span class="line"><span class="comment"># 注意：mysql是ping不通其他所有tomcat的</span></span><br></pre></td></tr></table></figure>

<h2 id="Docker容器间利用brige网桥实现双向通信"><a href="#Docker容器间利用brige网桥实现双向通信" class="headerlink" title="Docker容器间利用brige网桥实现双向通信"></a>Docker容器间利用brige网桥实现双向通信</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建一个新的网桥：</span></span><br><span class="line">docker network create -d bridge my_bridge</span><br><span class="line"><span class="comment"># 启动第一个容器：</span></span><br><span class="line">docker run -itd --name tomcat centos:7</span><br><span class="line"><span class="comment"># 启动第二个容器：</span></span><br><span class="line">docker run -itd --name redis centos:7</span><br><span class="line"><span class="comment"># 把第一个容器加入网桥：</span></span><br><span class="line">docker network connect my_bridge tomcat</span><br><span class="line"><span class="comment"># 把第二个容器加入网桥：</span></span><br><span class="line">docker network connect my_bridge redis</span><br><span class="line"><span class="comment"># 最后分别进入俩个容器中进行验证 互ping</span></span><br></pre></td></tr></table></figure>

<h2 id="Docker容器的特权模式介绍"><a href="#Docker容器的特权模式介绍" class="headerlink" title="Docker容器的特权模式介绍"></a>Docker容器的特权模式介绍</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动一个普通的容器</span></span><br><span class="line">docker run -itd --name mycentos centos:7 /bin/bash</span><br><span class="line"><span class="comment"># 安装网络工具：</span></span><br><span class="line">yum -y install net-tools</span><br><span class="line"><span class="comment"># 执行route -n</span></span><br><span class="line"><span class="comment"># 删除网关：</span></span><br><span class="line">route del default gw 172.17.0.1</span><br><span class="line"><span class="comment"># 启动拥有特权模式的容器：</span></span><br><span class="line">docker run -itd --privileged=<span class="literal">true</span> --name mycentos1 centos:7 /bin/bash</span><br><span class="line"><span class="comment"># 进入容器：</span></span><br><span class="line">docker <span class="built_in">exec</span> -it ef /bin/bash</span><br><span class="line"><span class="comment"># 删除网关</span></span><br><span class="line">route del default gw 172.17.0.1</span><br><span class="line"><span class="comment"># 成功 备注：特权模式用的比较少</span></span><br></pre></td></tr></table></figure>

<h2 id="Docker核心知识之Volume数据共享"><a href="#Docker核心知识之Volume数据共享" class="headerlink" title="Docker核心知识之Volume数据共享"></a>Docker核心知识之Volume数据共享</h2><p>Volume的介绍使用</p>
<ul>
<li>dockerfile</li>
</ul>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centos:<span class="number">7</span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="bash"> [<span class="string">"/usr/local"</span>]</span></span><br></pre></td></tr></table></figure>

<p>docker inspect 容器的id【source是指宿主机的共享路径，destination是指容器的共享路径】</p>
<p>注意：在dockerfile里设置volume是无法修改宿主机的挂载路径的</p>
<p><img src="https://gitee.com/YuerryHUAHUA/figure/raw/master/img/20210503185844.png" alt=""></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用volume容器共享创建nginx集群</span></span><br><span class="line"><span class="comment"># 使用--volumes-from 实现容器与容器之间volume共享</span></span><br><span class="line"><span class="comment"># 创建nginx1</span></span><br><span class="line">docker run -itd -p 8080:80 -v /usr/<span class="built_in">local</span>/nginx/html:/usr/<span class="built_in">local</span>/nginx/html --name nginx1 mycentos:nginx /usr/<span class="built_in">local</span>/nginx/sbin/nginx -g <span class="string">"daemon off;"</span></span><br><span class="line"><span class="comment"># 创建nginx2</span></span><br><span class="line">docker run -itd -p 8081:80 --volumes-from nginx1 --name nginx2 mycentos:nginx /usr/<span class="built_in">local</span>/nginx/sbin/nginx -g <span class="string">"daemon off;"</span></span><br><span class="line"><span class="comment"># 创建nginx3</span></span><br><span class="line">docker run -itd -p 8082:80 --volumes-from nginx1 --name nginx3 mycentos:nginx /usr/<span class="built_in">local</span>/nginx/sbin/nginx -g <span class="string">"daemon off;"</span></span><br><span class="line"><span class="comment"># 对/usr/local/nginx/html/index.html进行修改</span></span><br><span class="line"><span class="comment"># 打开浏览器进行访问测试</span></span><br><span class="line"><span class="comment"># 使用docker inspect 容器ID 可以查看详细的挂载信息</span></span><br></pre></td></tr></table></figure>

<h1 id="实战系列之利用Compose操作容器"><a href="#实战系列之利用Compose操作容器" class="headerlink" title="实战系列之利用Compose操作容器"></a>实战系列之利用Compose操作容器</h1><h2 id="实用工具Docker-Compose的介绍与安装"><a href="#实用工具Docker-Compose的介绍与安装" class="headerlink" title="实用工具Docker-Compose的介绍与安装"></a>实用工具Docker-Compose的介绍与安装</h2><p>Compose的介绍<br>docker-compose：是一个用于定义和运行多容器 Docker 的应用程序工具，可以帮助我们可以轻松、高效的管理容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># compose的安装</span></span><br><span class="line"><span class="comment"># 安装pip工具</span></span><br><span class="line">yum install -y epel-release</span><br><span class="line">yum install -y python-pip</span><br><span class="line"><span class="comment"># 安装docker-compose</span></span><br><span class="line">pip install -i https://pypi.tuna.tsinghua.edu.cn/simple docker-compose==1.24.1</span><br><span class="line"><span class="comment"># 查看docker-compose版本</span></span><br><span class="line">docker-compose version</span><br></pre></td></tr></table></figure>

<p>安装pip报错解决：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost yum.repos.d]<span class="comment"># yum install python-pip -y</span></span><br><span class="line">已加载插件：fastestmirror</span><br><span class="line">One of the configured repositories failed (未知),</span><br><span class="line">and yum doesn<span class="string">'t have enough cached data to continue. At this point the only</span></span><br><span class="line"><span class="string">safe thing yum can do is fail. There are a few ways to work "fix" this:</span></span><br><span class="line"><span class="string">1. Contact the upstream for the repository and get them to fix the problem.</span></span><br><span class="line"><span class="string">2. Reconfigure the baseurl/etc. for the repository, to point to a working</span></span><br><span class="line"><span class="string">upstream. This is most often useful if you are using a newer</span></span><br><span class="line"><span class="string">distribution release than is supported by the repository (and the</span></span><br><span class="line"><span class="string">packages for the previous distribution release still work).</span></span><br><span class="line"><span class="string">3. Disable the repository, so yum won'</span>t use it by default. Yum will <span class="keyword">then</span></span><br><span class="line">just ignore the repository until you permanently <span class="built_in">enable</span> it again or use</span><br><span class="line">--enablerepo <span class="keyword">for</span> temporary usage:</span><br><span class="line">yum-config-manager --<span class="built_in">disable</span> &lt;repoid&gt;</span><br><span class="line">4. Configure the failing repository to be skipped, <span class="keyword">if</span> it is unavailable.</span><br><span class="line">Note that yum will try to contact the repo. when it runs most commands,</span><br><span class="line">so will have to try and fail each time (and thus. yum will be be much</span><br><span class="line">slower). If it is a very temporary problem though, this is often a nice</span><br><span class="line">compromise:</span><br><span class="line">yum-config-manager --save --<span class="built_in">setopt</span>=&lt;repoid&gt;.skip_if_unavailable=<span class="literal">true</span></span><br><span class="line">Cannot retrieve metalink <span class="keyword">for</span> repository: epel/x86_64. Please verify its path and</span><br><span class="line">try again</span><br></pre></td></tr></table></figure>

<ul>
<li>解决： vi /etc/yum.repos.d/epel.repo 修改配置文件，注释掉metalink ，取消注释 baseurl</li>
</ul>
<p><img src="https://gitee.com/YuerryHUAHUA/figure/raw/master/img/20210503193309.png" alt="image-20210503193307294"></p>
<h2 id="实用工具Docker-Compose的快速上手"><a href="#实用工具Docker-Compose的快速上手" class="headerlink" title="实用工具Docker-Compose的快速上手"></a>实用工具Docker-Compose的快速上手</h2><ul>
<li>编写一个最最简单的yml（3是指yml格式的版本）</li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'3'</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mycentos:redis</span></span><br></pre></td></tr></table></figure>

<ul>
<li>compose操作容器（一定要进入配置文件目录）</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 后台启动容器：</span></span><br><span class="line">docker-compose up -d</span><br><span class="line"><span class="comment"># 查看容器运行情况：</span></span><br><span class="line">docker-compose ps</span><br><span class="line"><span class="comment"># 停止并删除容器：</span></span><br><span class="line">docker-compose down</span><br><span class="line"><span class="comment"># 停止并删除容器并删除volume：</span></span><br><span class="line">docker-compose down --volumes</span><br><span class="line"><span class="comment"># 停止启动容器：</span></span><br><span class="line">docker-compose stop</span><br><span class="line">docker-compose start</span><br><span class="line"><span class="comment"># docker-compose exec的使用：进入容器</span></span><br><span class="line">docker-compose <span class="built_in">exec</span> redis bash</span><br><span class="line"><span class="comment"># 总结：</span></span><br><span class="line"><span class="comment"># 操作docker-compose一定要在配置文件docker-compose.yml文件路径下操作</span></span><br><span class="line"><span class="comment"># 格式一定要注意，该空格要空格，两格</span></span><br></pre></td></tr></table></figure>

<h2 id="实用工具Docker-Compose核实用技能"><a href="#实用工具Docker-Compose核实用技能" class="headerlink" title="实用工具Docker-Compose核实用技能"></a>实用工具Docker-Compose核实用技能</h2><p>Compose核心实用技能掌握：</p>
<ol>
<li>docker-compose.yml的三大部分：version，services，networks，最关键是services和networks两个部分 </li>
<li>compose设置网络模式  </li>
<li>compose使用端口映射 </li>
<li>compose设置文件共享 </li>
<li>compose管理多个容器 </li>
<li>docker-compose.yml</li>
</ol>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'3'</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">nginx:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mycentos:nginx</span></span><br><span class="line">      <span class="comment"># network_mode: "host"</span></span><br><span class="line">      <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"8080:80"</span></span><br><span class="line">      <span class="attr">network_mode:</span> <span class="string">"host"</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home:/usr/local/nginx/html</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/var/logs/nginx/logs:/usr/local/nginx/logs</span></span><br><span class="line">      <span class="attr">command:</span> <span class="string">/usr/local/nginx/sbin/nginx</span> <span class="string">-g</span> <span class="string">"daemon off;"</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mycentos:redis</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">"6380:6379"</span></span><br></pre></td></tr></table></figure>

<h2 id="实战项目篇之利用Docker-Compose快速搭建个人博客"><a href="#实战项目篇之利用Docker-Compose快速搭建个人博客" class="headerlink" title="实战项目篇之利用Docker-Compose快速搭建个人博客"></a>实战项目篇之利用Docker-Compose快速搭建个人博客</h2><p>Compose快速搭建个人博客wordpress</p>
<p>官网：<a href="https://docs.docker.com/compose/wordpress/" target="_blank" rel="noopener">https://docs.docker.com/compose/wordpress/</a> </p>
<p>docker-compose.yml</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'3.3'</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">db:</span>						<span class="comment"># 容器</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql:5.7</span> 		  <span class="comment">#docker run -itd mysql:5.7</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">db_data:/var/lib/mysql</span> <span class="comment">#采用的是卷标的形式挂载（注意：- db_data是参数，可以变，自定义，必须与下面对应）</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span> 		  <span class="comment">#自动重启，保证服务在线</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">MYSQL_ROOT_PASSWORD:</span> <span class="string">somewordpress</span> <span class="comment">#指定环境变量 docker -itd -e MYSQL_ROOT_PASSWORD=somewordpress</span></span><br><span class="line">      <span class="attr">MYSQL_DATABASE:</span> <span class="string">wordpress</span></span><br><span class="line">      <span class="attr">MYSQL_USER:</span> <span class="string">wordpress</span></span><br><span class="line">      <span class="attr">MYSQL_PASSWORD:</span> <span class="string">wordpress</span></span><br><span class="line">    </span><br><span class="line">  <span class="attr">wordpress:</span>				<span class="comment"># 容器</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">db</span> <span class="comment"># - db 是参数，合起来的意思是只有当上面的mysql数据库安装成功后，这个wordpress才可以被安装，还有一个功能，就是docker --link 将上面的mysql数据库，与这个wordpress应用连起来</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">wordpress:latest</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"8000:80"</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">WORDPRESS_DB_HOST:</span> <span class="string">db:3306</span></span><br><span class="line">      <span class="attr">WORDPRESS_DB_USER:</span> <span class="string">wordpress</span></span><br><span class="line">      <span class="attr">WORDPRESS_DB_PASSWORD:</span> <span class="string">wordpress</span></span><br><span class="line">      <span class="attr">WORDPRESS_DB_NAME:</span> <span class="string">wordpress</span></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">db_data:</span> <span class="string">&#123;&#125;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>启动wordpress</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br><span class="line"><span class="comment"># 打开浏览器访问：IP:8000</span></span><br><span class="line"><span class="comment"># 进行安装配置</span></span><br><span class="line"><span class="comment"># 将删除容器和默认网络，但会保留WordPress数据库：</span></span><br><span class="line">docker-compose down</span><br><span class="line"><span class="comment"># 将删除容器，默认网络和WordPress数据库： </span></span><br><span class="line">docker-compose down --volumes</span><br></pre></td></tr></table></figure>

<h2 id="实战项目篇之Docker-Compose-详细分析"><a href="#实战项目篇之Docker-Compose-详细分析" class="headerlink" title="实战项目篇之Docker-Compose 详细分析"></a>实战项目篇之Docker-Compose 详细分析</h2><p>分析上节课docker-compose.yml </p>
<p>docker-compose.yml</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker-compose中有两种方式可以设置volumes</span></span><br><span class="line"><span class="comment"># 使用具体路径直接挂载到本地，特点就是直观</span></span><br><span class="line"><span class="comment"># 使用卷标的形式，特点就是简洁，但是不知道数据到底在本地的什么位置。需要通过卷标查看</span></span><br><span class="line">docker volume ls</span><br><span class="line">docker volume inspect wordpress_db_data</span><br></pre></td></tr></table></figure>

<h1 id="Docker企业核心知识之镜像仓库实战"><a href="#Docker企业核心知识之镜像仓库实战" class="headerlink" title="Docker企业核心知识之镜像仓库实战"></a>Docker企业核心知识之镜像仓库实战</h1><h2 id="公司中Docker镜像仓库使用"><a href="#公司中Docker镜像仓库使用" class="headerlink" title="公司中Docker镜像仓库使用"></a>公司中Docker镜像仓库使用</h2><p>什么是镜像仓库? 存放着很多镜像的仓库<br>为什么要使用镜像仓库？起到备份作用，方便其他机器下载使用</p>
<p>镜像仓库的种类？我们可以大致分为俩大类：</p>
<ol>
<li>公共镜像仓库<br>官方：<a href="https://hub.docker.com/，基于各个软件开发或者有软件提供商开发的" target="_blank" rel="noopener">https://hub.docker.com/，基于各个软件开发或者有软件提供商开发的</a><br>非官方：其他组织或者公司开发的镜像，供大家免费使用</li>
<li>私有镜像仓库<br>公司自己搭建的，用于存放公司内部的镜像，自己管理，不提供给外部使用，避免了商业项目暴露出<br>去的风险</li>
</ol>
<p><img src="https://gitee.com/YuerryHUAHUA/figure/raw/master/img/20210503205041.png" alt="image-20210503205038487"></p>
<h2 id="阿里云镜像仓库的搭建与使用"><a href="#阿里云镜像仓库的搭建与使用" class="headerlink" title="阿里云镜像仓库的搭建与使用"></a>阿里云镜像仓库的搭建与使用</h2><p>阿里云镜像仓库申请地址： <a href="https://cr.console.aliyun.com/cn-shanghai/instances/repositories" target="_blank" rel="noopener">https://cr.console.aliyun.com/cn-shanghai/instances/repositories</a> </p>
<p>步骤： 登录阿里云Docker Registry</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker login --username=穿靴子的狸花猫 registry.cn-shenzhen.aliyuncs.com</span><br></pre></td></tr></table></figure>

<p>将镜像推送到Registry</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker login --username=穿靴子的狸花猫 registry.cn-shenzhen.aliyuncs.com</span><br><span class="line">$ sudo docker tag [ImageId] registry.cn-shenzhen.aliyuncs.com/xdclassimages/mysql:[镜像版本号]</span><br><span class="line">$ sudo docker push registry.cn-shenzhen.aliyuncs.com/xdclassimages/mysql:[镜像版本号]</span><br></pre></td></tr></table></figure>

<p>从Registry中拉取镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker pull registry.cn-shenzhen.aliyuncs.com/xdclassimages/mysql:[镜像版本号]</span><br></pre></td></tr></table></figure>

<h2 id="企业核心篇幅之harbor仓库搭建"><a href="#企业核心篇幅之harbor仓库搭建" class="headerlink" title="企业核心篇幅之harbor仓库搭建"></a>企业核心篇幅之harbor仓库搭建</h2><p>构建自己的镜像仓库 </p>
<ul>
<li><p>安装之前确保前置条件是否满足，需要安装docker、docker-compose、openssl以及python2.7以上</p>
</li>
<li><p>安装 yum -y install openssl </p>
</li>
<li><p>Harbor离线版安装下载地址 <a href="https://github.com/goharbor/harbor/releases" target="_blank" rel="noopener">Releases · goharbor/harbor · GitHub</a></p>
</li>
<li><p>上传对应安装包</p>
</li>
<li><p>修改配置：harbor.yml</p>
<ul>
<li>修改主机名（注意空格）：hostname: 192.168.0.151</li>
<li>修改密码（注意空格）：harbor_admin_password: Harbor12345</li>
</ul>
</li>
<li><p>执行脚本，会生成一个文件docker-compose.yml：sh prepare</p>
</li>
<li><p>执行安装命令：sh install.sh</p>
</li>
<li><p>访问Harbor，默认用户名admin  密码：Harbor12345</p>
<ul>
<li><p>查看nginx的端口：docker-compose ps </p>
</li>
<li><p>访问 192.168.0.151:80</p>
<p><img src="https://gitee.com/YuerryHUAHUA/figure/raw/master/img/20210503211443.png" alt="image-20210503211441434"></p>
</li>
</ul>
</li>
<li><p>关闭：docker-compose down</p>
</li>
<li><p>启动：docker-compose up -d</p>
</li>
</ul>
<p><img src="https://gitee.com/YuerryHUAHUA/figure/raw/master/img/20210503223357.png" alt="image-20210503211712530"></p>
<h2 id="企业核心篇幅之harbor仓库配置与使用"><a href="#企业核心篇幅之harbor仓库配置与使用" class="headerlink" title="企业核心篇幅之harbor仓库配置与使用"></a>企业核心篇幅之harbor仓库配置与使用</h2><p>配置与使用harbor仓库 </p>
<ul>
<li><p>Docker配置使用自建仓库 </p>
<ul>
<li><p>默认docker只允许访问 https仓库 </p>
</li>
<li><p>如果要访问http仓库需要自己配置 </p>
</li>
<li><p>配置允许访问http仓库：/etc/docker/daemon.json</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attr">"insecure-registries"</span>:[<span class="string">"http://192.168.0.151"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>重启docker服务：systemctl restart docker.service </p>
</li>
<li><p>网页上创建项目名 登录：docker login –username=admin 192.168.0.151 </p>
</li>
<li><p>改名：docker tag mysql:5.7 192.168.0.151/xdclass/mysql:5.7 </p>
</li>
<li><p>推送：docker push 192.168.0.151/xdclass/mysql:5.7 </p>
</li>
<li><p>下载：docker pull 192.168.0.151/xdclass/mysql:5.7 </p>
</li>
<li><p>docker login 后有一个登录凭证（可删除，下次需要密码）： </p>
<ul>
<li>密码存在 /root/.docker/config.json （建议从安全角度出发，每次登录后进行删除）</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="实战系列之本地镜像容器的载入与载出"><a href="#实战系列之本地镜像容器的载入与载出" class="headerlink" title="实战系列之本地镜像容器的载入与载出"></a>实战系列之本地镜像容器的载入与载出</h2><p>镜像的本地载入载出</p>
<ul>
<li>两种办法： <ul>
<li>保存镜像 </li>
<li>保存容器</li>
</ul>
</li>
<li>保存镜像：<ul>
<li>docker save cd3ed0dfff7e -o /home/mysql.tar</li>
<li>docker save mysql:5.7 &gt; /home/mysql.tar</li>
</ul>
</li>
<li>载入镜像：<ul>
<li>docker load -i mysql.tar</li>
<li>docker tag cd3ed0dfff7e mysql:5.7</li>
</ul>
</li>
<li>保存容器：<ul>
<li>docker export 974b919e1fdd -o /home/mysql-export.tar</li>
</ul>
</li>
<li>载入容器：<ul>
<li>docker import mysql-export.tar</li>
</ul>
</li>
</ul>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Kaluna</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://blog.kaluna.top/2021/05/03/Docker%E5%85%A5%E9%97%A8%E5%88%B0%E9%AB%98%E7%BA%A7dockerfile/">https://blog.kaluna.top/2021/05/03/Docker%E5%85%A5%E9%97%A8%E5%88%B0%E9%AB%98%E7%BA%A7dockerfile/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/docker/">docker</a><a class="post-meta__tags" href="/tags/dockerfile/">dockerfile</a></div><div class="post-qr-code"><div class="post-qr-code-item"><img class="post-qr-code__img" src="https://i.loli.net/2021/04/20/FbPtxEHeSDgCXBy.jpg"><div class="post-qr-code__desc">添加我为好友</div></div></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2021/05/03/gitee%E5%9B%BE%E7%89%87%E4%B8%8A%E4%BC%A0%E6%8A%A5%E9%94%99/"><i class="fa fa-chevron-left">  </i><span>gitee图片上传报错</span></a></div><div class="next-post pull-right"><a href="/2021/05/02/%E9%AB%98%E6%80%A7%E8%83%BD%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97RabbitMQ/"><span>高性能消息队列RabbitMQ</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="disqus_thread"></div><script>var unused = null;
var disqus_config = function () {
  this.page.url = 'https://blog.kaluna.top/2021/05/03/Docker%E5%85%A5%E9%97%A8%E5%88%B0%E9%AB%98%E7%BA%A7dockerfile/';
  this.page.identifier = '2021/05/03/Docker入门到高级dockerfile/';
  this.page.title = 'Docker入门到高级dockerfile';
}
var d = document, s = d.createElement('script');
s.src = "https://" + 'shortname-pzy8cndfkq' +".disqus.com/embed.js";
s.setAttribute('data-timestamp', '' + +new Date());
(d.head || d.body).appendChild(s);</script><script id="dsq-count-scr" src="https://shortname-pzy8cndfkq.disqus.com/count.js" async></script></div></div><footer class="footer-bg" style="background-image: url(https://gitee.com/YuerryHUAHUA/figure/raw/master/img/20210521080208.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2021 By Kaluna</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="icp"><a><span></span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.7.0"></script><script src="/js/fancybox.js?version=1.7.0"></script><script src="/js/sidebar.js?version=1.7.0"></script><script src="/js/copy.js?version=1.7.0"></script><script src="/js/fireworks.js?version=1.7.0"></script><script src="/js/transition.js?version=1.7.0"></script><script src="/js/scroll.js?version=1.7.0"></script><script src="/js/head.js?version=1.7.0"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>