<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="小滴课堂一"><meta name="keywords" content="springboot"><meta name="author" content="Kaluna"><meta name="copyright" content="Kaluna"><title>小滴课堂一 | 嘿，不停转的轮子</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="嘿，不停转的轮子" type="application/atom+xml">
</head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#⼩滴课堂移动端项⽬实战技术栈"><span class="toc-number">1.</span> <span class="toc-text">⼩滴课堂移动端项⽬实战技术栈</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Spring5简介"><span class="toc-number">2.</span> <span class="toc-text">Spring5简介</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SpringBoot2-X快速入门"><span class="toc-number">3.</span> <span class="toc-text">SpringBoot2.X快速入门</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#使⽤Spring-Initializr创建SpringBoot2-X项⽬"><span class="toc-number">3.1.</span> <span class="toc-text">使⽤Spring Initializr创建SpringBoot2.X项⽬</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使⽤新版SpringBoot2-X开发第⼀个JSON接⼝"><span class="toc-number">3.2.</span> <span class="toc-text">使⽤新版SpringBoot2.X开发第⼀个JSON接⼝</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#模拟Http接⼝测试⼯具PostMan"><span class="toc-number">4.</span> <span class="toc-text">模拟Http接⼝测试⼯具PostMan</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SpringBoot2-X的常⽤注解"><span class="toc-number">5.</span> <span class="toc-text">SpringBoot2.X的常⽤注解</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SpringBoot2-X开发规范"><span class="toc-number">6.</span> <span class="toc-text">SpringBoot2.X开发规范</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#静态资源访问"><span class="toc-number">6.1.</span> <span class="toc-text">静态资源访问</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Application启动类位置"><span class="toc-number">6.2.</span> <span class="toc-text">Application启动类位置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#必备打包、启动命令"><span class="toc-number">6.3.</span> <span class="toc-text">必备打包、启动命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#打包后的Jar里面的目录结构"><span class="toc-number">6.4.</span> <span class="toc-text">打包后的Jar里面的目录结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#小滴课堂-需求模块"><span class="toc-number">6.5.</span> <span class="toc-text">小滴课堂 需求模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringBoot2-X⾥⾯定制JSON字段"><span class="toc-number">6.6.</span> <span class="toc-text">SpringBoot2.X⾥⾯定制JSON字段</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringBoot2-x常⻅配置⽂件形式"><span class="toc-number">6.7.</span> <span class="toc-text">SpringBoot2.x常⻅配置⽂件形式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringBoot注解配置⽂件映射属性和实体类"><span class="toc-number">6.8.</span> <span class="toc-text">SpringBoot注解配置⽂件映射属性和实体类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Springboot2-X单元测试应⽤"><span class="toc-number">6.9.</span> <span class="toc-text">Springboot2.X单元测试应⽤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#如何使⽤SpringBoot2-x的单元测试"><span class="toc-number">6.9.1.</span> <span class="toc-text">如何使⽤SpringBoot2.x的单元测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#案例实战-Controller层登录⽅法测试"><span class="toc-number">6.9.2.</span> <span class="toc-text">案例实战 Controller层登录⽅法测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#案例实战-视频列表Service层单元测试"><span class="toc-number">6.9.3.</span> <span class="toc-text">案例实战 视频列表Service层单元测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MockMvc案例实战调⽤Controller层API接⼝"><span class="toc-number">6.9.4.</span> <span class="toc-text">MockMvc案例实战调⽤Controller层API接⼝</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Springboot2-X全局异常处理"><span class="toc-number">6.10.</span> <span class="toc-text">Springboot2.X全局异常处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Servlet3-0和SpringBoot2-X过滤器"><span class="toc-number">6.11.</span> <span class="toc-text">Servlet3.0和SpringBoot2.X过滤器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringBoot2-X拦截器配置实战"><span class="toc-number">6.12.</span> <span class="toc-text">SpringBoot2.X拦截器配置实战</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringBoot2-X定时任务schedule"><span class="toc-number">6.13.</span> <span class="toc-text">SpringBoot2.X定时任务schedule</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringBoot2-x异步任务EnableAsync"><span class="toc-number">6.14.</span> <span class="toc-text">SpringBoot2.x异步任务EnableAsync</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">Kaluna</div><div class="author-info__description text-center"></div><div class="follow-button"><a href="https://github.com/lxy1866" target="_blank" rel="noopener">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">19</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">27</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">10</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://gitee.com/YuerryHUAHUA/figure/raw/master/img/20210521080208.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">嘿，不停转的轮子</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/about">About</a><a class="site-page" href="/tags/">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> Search</span></a></span></div><div id="post-info"><div id="post-title">小滴课堂一</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-04-21</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Java%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/">Java项目实战</a><span class="post-meta__separator">|</span><i class="fa fa-comment-o post-meta__icon" aria-hidden="true"></i><a href="/2021/04/21/%E5%B0%8F%E6%BB%B4%E8%AF%BE%E5%A0%82%E4%B8%80/#disqus_thread"><span class="disqus-comment-count" data-disqus-identifier="2021/04/21/小滴课堂一/"></span></a></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="⼩滴课堂移动端项⽬实战技术栈"><a href="#⼩滴课堂移动端项⽬实战技术栈" class="headerlink" title="⼩滴课堂移动端项⽬实战技术栈"></a>⼩滴课堂移动端项⽬实战技术栈</h1><ol>
<li><p>后端开发⼯具和环境：JDK8 + IDEA + Maven3.X </p>
</li>
<li><p>后端技术栈：SpringBoot2.X + Spring5 + Mybatis3.X +MySQL +JWT + Guava缓存 + Jmeter5.X压测 </p>
</li>
<li><p>前端技术栈： VueCli4.3 + Vue2.6 + Vuex + axios + 移动端CUBE-UI框架 + VS Code </p>
</li>
<li><p>部署：阿⾥云CentOS7 + Nginx静态⽂件服务器 + Nginx部署后端双节点 + 域名配置解析</p>
</li>
</ol>
<h1 id="Spring5简介"><a href="#Spring5简介" class="headerlink" title="Spring5简介"></a>Spring5简介</h1><ol>
<li><p>Spring：轻量级的 DI / IOC 和 AOP 容器的开源框架</p>
</li>
<li><p>好处：管理创建和组装对象之间的依赖关系, 加了spring注解的类会⾃动创建⼀个实例，加到IOC容器⾥⾯，然后看哪⾥需要它，就⾃动赋值过去</p>
<ol>
<li><p>使⽤前：⼿⼯创建</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Controller -&gt; Service -&gt; Dao</span><br><span class="line">UserControoler</span><br><span class="line"><span class="keyword">private</span> UserService userService = <span class="keyword">new</span> UserService();</span><br></pre></td></tr></table></figure>
</li>
<li><p>使⽤后：Spring创建，⾃动注⼊</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Controller -&gt; Service -&gt; Dao</span><br><span class="line">UserControoler</span><br><span class="line"><span class="meta">@Autowire</span></span><br><span class="line"><span class="keyword">private</span> UserService userService</span><br></pre></td></tr></table></figure>

</li>
</ol>
</li>
</ol>
<h1 id="SpringBoot2-X快速入门"><a href="#SpringBoot2-X快速入门" class="headerlink" title="SpringBoot2.X快速入门"></a>SpringBoot2.X快速入门</h1><blockquote>
<p>官⽹：<a href="https://spring.io/projects/spring-boot" target="_blank" rel="noopener">https://spring.io/projects/spring-boot</a></p>
<p>GitHub地址：<a href="https://github.com/spring-projects/spring-boot" target="_blank" rel="noopener">https://github.com/spring-projects/spring-boot</a></p>
<p>官⽅⽂档：<a href="https://spring.io/guides/gs/spring-boot/" target="_blank" rel="noopener">https://spring.io/guides/gs/spring-boot/</a></p>
</blockquote>
<h2 id="使⽤Spring-Initializr创建SpringBoot2-X项⽬"><a href="#使⽤Spring-Initializr创建SpringBoot2-X项⽬" class="headerlink" title="使⽤Spring Initializr创建SpringBoot2.X项⽬"></a>使⽤Spring Initializr创建SpringBoot2.X项⽬</h2><ol>
<li><p>常⻅的创建SpringBoot创建⽅式</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                 <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.vintage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                 <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-vintage-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在线创建 ：<a href="https://start.spring.io/" target="_blank" rel="noopener">https://start.spring.io/</a></p>
</li>
</ol>
<h2 id="使⽤新版SpringBoot2-X开发第⼀个JSON接⼝"><a href="#使⽤新版SpringBoot2-X开发第⼀个JSON接⼝" class="headerlink" title="使⽤新版SpringBoot2.X开发第⼀个JSON接⼝"></a>使⽤新版SpringBoot2.X开发第⼀个JSON接⼝</h2><ol>
<li><p>什么是SpringBoot，有什么⽤</p>
<ol>
<li>⼀个web开发框架 </li>
<li>Servlet 、SpringMVC </li>
<li>简化配置 </li>
</ol>
</li>
<li><p>SpringBoot开发项⽬常⻅的交互使⽤形式 </p>
<ol>
<li><p>后端接⼝直接返回⻚⾯，现在⽐较少了 </p>
<p>常⻅的传统IT公司⽐较多，配合模板引擎，由后端⻚⾯渲染返回 </p>
</li>
<li><p>返回JSON数据，主流场景 </p>
<p>互联⽹公司⽤的⽐较多，⽐如微服务接⼝，前后端分离项⽬，⼿机app等，基本都是通 过JSON交互如何使⽤SpringBoot2.X开发JSON接⼝ </p>
<ol>
<li><p>@RestController注解 </p>
</li>
<li><p>return ⼀个POJO对象（不能返回字符串）</p>
</li>
</ol>
</li>
<li><p>浏览器如果没安装json格式插件，则返回不会被美化</p>
</li>
</ol>
</li>
</ol>
<h1 id="模拟Http接⼝测试⼯具PostMan"><a href="#模拟Http接⼝测试⼯具PostMan" class="headerlink" title="模拟Http接⼝测试⼯具PostMan"></a>模拟Http接⼝测试⼯具PostMan</h1><p>作⽤：模拟浏览器请求，拼装参数和格式化json响应结果 </p>
<p>安装地址：<a href="https://www.getpostman.com/" target="_blank" rel="noopener">https://www.getpostman.com/</a></p>
<h1 id="SpringBoot2-X的常⽤注解"><a href="#SpringBoot2-X的常⽤注解" class="headerlink" title="SpringBoot2.X的常⽤注解"></a>SpringBoot2.X的常⽤注解</h1><ol>
<li><p>@Controller 作⽤：⽤于标记这个类是⼀个控制器，返回⻚⾯的时候使⽤；如果要返回JSON，则需要在接⼝上使⽤@ResponseBody才可以 </p>
<blockquote>
<p>@ResponseBody注解的作用是将controller的方法返回的对象通过适当的转换器转换为指定的格式之后，写入到response对象的body区，通常用来返回JSON数据或者是XML 数据。</p>
</blockquote>
</li>
<li><p>@RestController 作⽤：⽤于标记这个类是⼀个控制器，返回JSON数据的时候使⽤，如果使⽤这 个注解，则接⼝返回数据会被序列化为JSON </p>
</li>
<li><p>所以：@RestController = @Controller+@ResponseBody </p>
</li>
<li><p>@RequestMapping 作⽤：路由映射，⽤于类上做1级路径；⽤于某个⽅法上做⼦路径 </p>
</li>
<li><p>@SpringBootApplication 作⽤: ⽤于标记是SringBoot应⽤，⾥⾯包含多个⼦注解,即</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@SpringBootApplication &#x3D;</span><br><span class="line">@Configuration+@EnableAutoConfiguration+@ComponentScan</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@SpringBootApplication</span>示例</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> net.xdclass.online_xdclass;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.annotation.MapperScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.EnableTransactionManagement;</span><br><span class="line"></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan</span>(<span class="string">"net.xdclass.online_xdclass.mapper"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OnlineXdclassApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		SpringApplication.run(OnlineXdclassApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Configuration</span>示例</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Configuration</span>注解主要用于定义配置类，可替换xml配置文件。被注解的类内部包含一个或多个被<span class="doctag">@Bean</span>注解的方法。这些方法将会被      </span></span><br><span class="line"><span class="comment"> * AnnotationConfigApplicationContext或AnnotationConfigWebApplicationContext类进行扫描</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> net.xdclass.online_xdclass.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> net.xdclass.online_xdclass.interceptor.CorsInterceptor;</span><br><span class="line"><span class="keyword">import</span> net.xdclass.online_xdclass.interceptor.LoginInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InterceptorConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">LoginInterceptor <span class="title">loginInterceptor</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> LoginInterceptor();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">CorsInterceptor <span class="title">corsInterceptor</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CorsInterceptor();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 拦截全部路径，这个跨域需要放在最上面</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        registry.addInterceptor(corsInterceptor()).addPathPatterns(<span class="string">"/**"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//拦截全部</span></span><br><span class="line">        registry.addInterceptor(loginInterceptor()).addPathPatterns(<span class="string">"/api/v1/pri/*/*/**"</span>)</span><br><span class="line">                <span class="comment">//不拦截哪些路径   斜杠一定要加</span></span><br><span class="line">                .excludePathPatterns(<span class="string">"/api/v1/pri/user/login"</span>,<span class="string">"/api/v1/pri/user/register"</span>);</span><br><span class="line"></span><br><span class="line">        WebMvcConfigurer.<span class="keyword">super</span>.addInterceptors(registry);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * SpringBootApplication注解源码</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Target</span>(ElementType.TYPE)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@SpringBootConfiguration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(excludeFilters = &#123; <span class="meta">@Filter</span>(type = FilterType.CUSTOM, classes = TypeExcludeFilter<span class="class">.<span class="keyword">class</span>),</span></span><br><span class="line"><span class="class">		@<span class="title">Filter</span>(<span class="title">type</span> </span>= FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter<span class="class">.<span class="keyword">class</span>) &#125;)</span></span><br><span class="line"><span class="class"><span class="title">public</span> @<span class="title">interface</span> <span class="title">SpringBootApplication</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>SpringBoot2.X开发HTTP接⼝GET请求</p>
<ol>
<li><p>GET请求 </p>
<p>场景：⼀般的查询接⼝就是get请求 </p>
<p>注解：@GetMapping = @RequestMapping(method = RequestMethod.GET) </p>
</li>
<li><p>⼀个顶两的注解 </p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@GetMapping &#x3D; @RequestMapping(method &#x3D; RequestMethod.GET) @PostMapping &#x3D; @RequestMapping(method &#x3D; RequestMethod.POST) @PutMapping &#x3D; @RequestMapping(method &#x3D; RequestMethod.PUT) @DeleteMapping &#x3D; @RequestMapping(method &#x3D; RequestMethod.DELETE)</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h1 id="SpringBoot2-X开发规范"><a href="#SpringBoot2-X开发规范" class="headerlink" title="SpringBoot2.X开发规范"></a>SpringBoot2.X开发规范</h1><h2 id="静态资源访问"><a href="#静态资源访问" class="headerlink" title="静态资源访问"></a>静态资源访问</h2><ol>
<li><p>同个文件的加载顺序,静态资源文件 Spring Boot 默认会挨个从</p>
<ol>
<li>META/resources &gt;</li>
<li>resources &gt;</li>
<li>static &gt;</li>
<li>public</li>
</ol>
</li>
<li><p>里面找是否存在相应的资源，如果有则直接返回，不在默认加载的目录，则找不到</p>
<ol>
<li>默认配置</li>
</ol>
<p>spring.resources.static-locations = classpath:/META-INF/resources/,classpath:/resources/,classpath:/static/,classpath:/public/</p>
<ol start="2">
<li><p>基本互联网企业 静态资源文件存储在CDN ，HTML、CSS、图片等</p>
</li>
<li><p>CDN ： 内容分发网络</p>
</li>
<li><p>文件服务器： 阿里云OSS</p>
</li>
</ol>
</li>
</ol>
<h2 id="Application启动类位置"><a href="#Application启动类位置" class="headerlink" title="Application启动类位置"></a>Application启动类位置</h2><p>注意：应用启动的位置，Application启动类位置</p>
<p>三种形式</p>
<ol>
<li><p>当启动类和controller在同一类中时，在该类上添加注解@Controller即可；</p>
</li>
<li><p>当启动类和controller分开时，启动类要放在根目录下，启动类上只需要注解@SpringBootApplication；</p>
</li>
<li><p>当启动类和controller分开时，如果启动类在非根目录下，需要在启动类中增加注解@ComponentScan，并配置需要扫描的包名，如(basePackages = )</p>
<p>@ComponentScan(basePackages ={“net.xdclass.controller”,”net.xdclass.service”})</p>
</li>
</ol>
<p><strong>工作中用哪种比较多？</strong></p>
<p>强烈推荐第二种方式，不然漏配置扫描包，项目庞大，出现问题则难排查</p>
<h2 id="必备打包、启动命令"><a href="#必备打包、启动命令" class="headerlink" title="必备打包、启动命令"></a>必备打包、启动命令</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">构建：mvn install</span><br><span class="line">构建跳过测试类 mvn install -Dmaven.test.skip&#x3D;true </span><br><span class="line"></span><br><span class="line">target目录下有对应的jar包就是打包后项目</span><br><span class="line"></span><br><span class="line">进到对应的target目录启动 java -jar xxxxx.jar  即可</span><br><span class="line">想后台运行，就用守护进程 nohup java -jar xxx.jar &amp;</span><br></pre></td></tr></table></figure>

<h2 id="打包后的Jar里面的目录结构"><a href="#打包后的Jar里面的目录结构" class="headerlink" title="打包后的Jar里面的目录结构"></a>打包后的Jar里面的目录结构</h2><ol>
<li><p>获取对应的jar包，解压</p>
</li>
<li><p>解压后项目结构</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">example.jar</span><br><span class="line"> |</span><br><span class="line"> +-META-INF</span><br><span class="line"> |  +-MANIFEST.MF</span><br><span class="line"> +-org</span><br><span class="line"> |  +-springframework</span><br><span class="line"> |     +-boot</span><br><span class="line"> |        +-loader</span><br><span class="line"> |           +-&lt;spring boot loader classes&gt;</span><br><span class="line"> +-BOOT-INF</span><br><span class="line">    +-classes</span><br><span class="line">    |  +-mycompany</span><br><span class="line">    |     +-project</span><br><span class="line">    |        +-YourClasses.class</span><br><span class="line">    +-lib</span><br><span class="line">       +-dependency1.jar</span><br><span class="line">       +-dependency2.jar</span><br></pre></td></tr></table></figure>

<h2 id="小滴课堂-需求模块"><a href="#小滴课堂-需求模块" class="headerlink" title="小滴课堂 需求模块"></a>小滴课堂 需求模块</h2><ul>
<li>用户注册-登录</li>
<li>视频管理模块CRUD</li>
<li>视频列表查询</li>
<li>全局异常处理</li>
<li>日志统计记录</li>
<li>…</li>
</ul>
<h2 id="SpringBoot2-X⾥⾯定制JSON字段"><a href="#SpringBoot2-X⾥⾯定制JSON字段" class="headerlink" title="SpringBoot2.X⾥⾯定制JSON字段"></a>SpringBoot2.X⾥⾯定制JSON字段</h2><ol>
<li><p>常⽤框架 阿⾥ fastjson,⾕歌gson等 </p>
</li>
<li><p>JavaBean序列化为Json</p>
<ol>
<li>性能：Jackson &gt; FastJson &gt; Gson &gt; Json-lib 同个结构</li>
<li>Jackson、FastJson、Gson类库各有优点，各有⾃⼰的专⻓ </li>
<li>空间换时间，时间换空间 </li>
</ol>
</li>
<li><p>jackson处理相关⾃动</p>
<ol>
<li><p>指定字段不返回：@JsonIgnore </p>
</li>
<li><p>指定⽇期格式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@JsonFormat</span>(pattern=<span class="string">"yyyy-MM-dd hh:mm:ss"</span>,locale=<span class="string">"zh"</span>,timezone=<span class="string">"GMT+8"</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>空字段不返回：@JsonInclude(Include.NON_NULL) </p>
</li>
<li><p>指定别名：@JsonProperty </p>
</li>
</ol>
</li>
<li><p>开发功能：视频创建时间返回⾃定义格式；过滤⽤户敏感信息 </p>
</li>
<li><p>序列化和反序列化操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//序列化操作</span></span><br><span class="line"> ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line"> String jsonStr = objectMapper.writeValueAsString(list);</span><br><span class="line"> System.out.println(jsonStr);</span><br><span class="line"> <span class="comment">//反序列化操作</span></span><br><span class="line"> List&lt;Video&gt; temp = objectMapper.readValue(jsonStr,List<span class="class">.<span class="keyword">class</span>)</span>;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="SpringBoot2-x常⻅配置⽂件形式"><a href="#SpringBoot2-x常⻅配置⽂件形式" class="headerlink" title="SpringBoot2.x常⻅配置⽂件形式"></a>SpringBoot2.x常⻅配置⽂件形式</h2><ol>
<li><p>常⻅的配置⽂件格式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xml、properties、json、yaml</span><br></pre></td></tr></table></figure>
</li>
<li><p>Springboot⾥⾯常⽤xx.yml</p>
<p>YAML（Yet Another Markup Language）</p>
<p>写 YAML 要⽐写 XML 快得多(⽆需关注标签或引号) 使⽤空格 Space 缩进表示分层，不同层次之间的缩进可以使⽤不同的空格数⽬ </p>
<p>注意：key后⾯的冒号，后⾯⼀定要跟⼀个空格，树状结构</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line"> port: 8080 &#x2F;&#x2F;设置启动端⼝号为8080</span><br><span class="line"> </span><br><span class="line">house:</span><br><span class="line"> family:</span><br><span class="line">  name: Doe</span><br><span class="line">  parents:</span><br><span class="line">   - John</span><br><span class="line">   - Jane</span><br><span class="line">  children:</span><br><span class="line">   - Paul</span><br><span class="line">   - Mark</span><br><span class="line">   - Simone</span><br><span class="line"> address:</span><br><span class="line">  number: 34</span><br><span class="line">  street: Main Street</span><br><span class="line">  city: Nowheretown</span><br><span class="line">  zipcode: 12345</span><br></pre></td></tr></table></figure>
</li>
<li><p>Springboot⾥⾯常⽤ xx.properties（推荐）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">server.port=8082</span><br><span class="line">#session失效时间，30m表示30分钟</span><br><span class="line">server.servlet.session.timeout=30m</span><br><span class="line"># Maximum number of connections that the server accepts and processes at</span><br><span class="line">any given time.</span><br><span class="line">server.tomcat.max-connections=10000</span><br><span class="line"># Maximum size of the HTTP post content.</span><br><span class="line">server.tomcat.max-http-post-size=2MB</span><br><span class="line">server.tomcat.max-http-form-post-size=2MB</span><br><span class="line"># Maximum amount of worker threads</span><br><span class="line">server.tomcat.max-threads=200</span><br></pre></td></tr></table></figure>
</li>
<li><p>官⽅⽂档配置 </p>
<ol>
<li><a href="https://docs.spring.io/spring-boot/docs/2.3.0.BUILD-SNAPSHOT/reference/htmlsingle/#core-properties" target="_blank" rel="noopener">https://docs.spring.io/spring-boot/docs/2.3.0.BUILD-SNAPSHOT/reference/htmlsingle/#core-properties</a> </li>
<li>如果需要修改，直接复制对应的配置⽂件加到application.properties⾥⾯，⼀般不需要调整</li>
</ol>
</li>
</ol>
<h2 id="SpringBoot注解配置⽂件映射属性和实体类"><a href="#SpringBoot注解配置⽂件映射属性和实体类" class="headerlink" title="SpringBoot注解配置⽂件映射属性和实体类"></a>SpringBoot注解配置⽂件映射属性和实体类</h2><p>配置⽂件加载</p>
<ol>
<li><p>⽅式⼀</p>
<ol>
<li><p>Controller上⾯配置 @PropertySource({“classpath:resource.properties”})</p>
</li>
<li><p>增加属性 @Value(“${test.name}”) private String name;</p>
</li>
</ol>
</li>
</ol>
<ol start="2">
<li><p>⽅式⼆：实体类配置⽂件</p>
<ol>
<li><p>添加 @Component 注解；</p>
</li>
<li><p>使⽤ @PropertySource 注解指定配置⽂件位置；</p>
</li>
<li><p>使⽤ @ConfigurationProperties 注解，设置相关属性；</p>
</li>
<li><p>使⽤ @ConfigurationProperties 注解，设置相关属性；</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span> </span><br><span class="line"><span class="keyword">private</span> ServerSettings serverSettings;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix=<span class="string">"test"</span>)</span><br><span class="line"><span class="meta">@PropertySource</span>(value=<span class="string">"classpath:resource.properties"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServerConstant</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
</li>
</ol>
<p><strong>常⻅问题：</strong></p>
<ol>
<li><p>配置⽂件注⼊失败，Could not resolve placeholder </p>
<p>解决：根据springboot启动流程，会有⾃动扫描包没有扫描到相关注解, 默认Spring框架实现会从声明@ComponentScan所在的类的package进⾏扫描，来⾃动注⼊， 因此启动类最好放在根路径下⾯，或者指定扫描包范围 </p>
<p>spring-boot扫描启动类对应的⽬录和⼦⽬录</p>
</li>
<li><p>注⼊bean的⽅式，属性名称和配置⽂件⾥⾯的key⼀⼀对应，就⽤加@Value 这个注解 如果不⼀样，就要加@value(“${XXX}”)</p>
</li>
</ol>
<h2 id="Springboot2-X单元测试应⽤"><a href="#Springboot2-X单元测试应⽤" class="headerlink" title="Springboot2.X单元测试应⽤"></a>Springboot2.X单元测试应⽤</h2><h3 id="如何使⽤SpringBoot2-x的单元测试"><a href="#如何使⽤SpringBoot2-x的单元测试" class="headerlink" title="如何使⽤SpringBoot2.x的单元测试"></a>如何使⽤SpringBoot2.x的单元测试</h3><ol>
<li><p>引⼊相关依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--springboot程序测试依赖，如果是⾃动创建项⽬默认添加--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置相关注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringRunner<span class="class">.<span class="keyword">class</span>) //底层⽤<span class="title">junit</span> <span class="title">SpringJUnit4ClassRunner</span></span></span><br><span class="line"><span class="class">@<span class="title">SpringBootTest</span>(<span class="title">classes</span></span>=&#123;XdclassApplication<span class="class">.<span class="keyword">class</span>&#125;)//启动整个<span class="title">springboot</span>⼯程</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">SpringBootTests</span> </span>&#123; &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>常⽤单元测试的注解</p>
<ol>
<li>@before</li>
<li>@before</li>
<li>@After</li>
</ol>
</li>
<li><p>断⾔ 判断程序结果是否符合预期 TestCase.assertXXX</p>
</li>
</ol>
<h3 id="案例实战-Controller层登录⽅法测试"><a href="#案例实战-Controller层登录⽅法测试" class="headerlink" title="案例实战 Controller层登录⽅法测试"></a>案例实战 Controller层登录⽅法测试</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> UserController userController;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loginTest</span><span class="params">()</span></span>&#123;</span><br><span class="line">    User user = <span class="keyword">new</span> User();</span><br><span class="line">    user.setUsername(<span class="string">"jack"</span>);</span><br><span class="line">    user.setPwd(<span class="string">"1234"</span>);</span><br><span class="line">    JsonData jsonData = userController.login(user);</span><br><span class="line">    System.out.println(jsonData.toString());</span><br><span class="line">    TestCase.assertEquals(<span class="number">0</span>,jsonData.getCode());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="案例实战-视频列表Service层单元测试"><a href="#案例实战-视频列表Service层单元测试" class="headerlink" title="案例实战 视频列表Service层单元测试"></a>案例实战 视频列表Service层单元测试</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> VideoService videoService;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testVideoList</span><span class="params">()</span></span>&#123;</span><br><span class="line">    List&lt;Video&gt; videoList = videoService.listVideo();</span><br><span class="line">    TestCase.assertTrue(videoList.size()&gt;<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="MockMvc案例实战调⽤Controller层API接⼝"><a href="#MockMvc案例实战调⽤Controller层API接⼝" class="headerlink" title="MockMvc案例实战调⽤Controller层API接⼝"></a>MockMvc案例实战调⽤Controller层API接⼝</h3><p>如何测试Controller对外提供的接⼝？</p>
<ol>
<li>增加类注解 @AutoConfigureMockMvc </li>
<li>注⼊⼀个MockMvc类 </li>
<li>相关API ：<ol>
<li>perform执⾏⼀个RequestBuilder请求 </li>
<li>andExpect：添加ResultMatcher-&gt;MockMvcResultMatchers验证规则 </li>
<li>andReturn：最后返回相应的MvcResult-&gt;Response</li>
</ol>
</li>
</ol>
<p>案例：在线教育VideoController 视频列表接⼝ 单元测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> MockMvc mockMvc;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testVideoListApi</span><span class="params">()</span><span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">    MvcResult mvcResult = </span><br><span class="line">   mockMvc.perform(MockMvcRequestBuilders.get(<span class="string">"/api/v1/pub/video/list"</span>))</span><br><span class="line"></span><br><span class="line">   .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();</span><br><span class="line">    <span class="keyword">int</span> status = mvcResult.getResponse().getStatus();</span><br><span class="line">    System.out.println(status);</span><br><span class="line">    <span class="comment">//会乱码</span></span><br><span class="line">    <span class="comment">//String result = mvcResult.getResponse().getContentAsString();</span></span><br><span class="line">    <span class="comment">// 使⽤下⾯这个，增加 编码 说明，就不会乱码打印</span></span><br><span class="line">    String result =</span><br><span class="line">   	mvcResult.getResponse().getContentAsString(Charset.forName(<span class="string">"utf-8"</span>));</span><br><span class="line">    System.out.println(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Springboot2-X全局异常处理"><a href="#Springboot2-X全局异常处理" class="headerlink" title="Springboot2.X全局异常处理"></a>Springboot2.X全局异常处理</h2><ol>
<li><p>为什么要配置全局异常？</p>
<p>不配全局服务端报错场景 1/0、空指针等</p>
</li>
<li><p>配置好处 </p>
<p>统⼀的错误⻚⾯或者错误码 </p>
<p>对⽤户更友好 </p>
</li>
<li><p>Springboot2.X怎么在项⽬中配置全局异常 </p>
<ol>
<li>类添加注解 <ol>
<li>@ControllerAdvice，如果需要返回json数据，则⽅法需要加@ResponseBody</li>
<li>@RestControllerAdvice, 默认返回json数据，⽅法不需要加@ResponseBody </li>
</ol>
</li>
<li>⽅法添加处理器<ol>
<li>捕获全局异常,处理所有不可知的异常 </li>
<li>@ExceptionHandler(value=Exception.class)</li>
</ol>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.xdclass.online_xdclass.exception;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> net.xdclass.online_xdclass.utils.JsonData;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ControllerAdvice;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomExceptionHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> Logger logger = LoggerFactory.getLogger(CustomExceptionHandler<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(value = Exception<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    @<span class="title">ResponseBody</span></span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">JsonData</span> <span class="title">handle</span>(<span class="title">Exception</span> <span class="title">e</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">        logger.error(<span class="string">"[ 异常 ]&#123;&#125;"</span>,e.getMessage());</span><br><span class="line">        <span class="keyword">if</span>(e <span class="keyword">instanceof</span> XDException)&#123;</span><br><span class="line"></span><br><span class="line">            XDException xdException = (XDException) e;</span><br><span class="line">            <span class="keyword">return</span> JsonData.buildError(xdException.getCode(),xdException.getMsg());</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> JsonData.buildError(<span class="string">"全局异常，未知错误"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p><strong>使⽤SpringBoot⾃定义异常和错误⻚⾯</strong>：返回⾃定义异常界⾯，需要引⼊thymeleaf依赖（⾮必须，如果是简单的html界⾯则不⽤）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>resource⽬录下新建templates,并新建error.html</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ModelAndView modelAndView = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">modelAndView.setViewName(<span class="string">"error.html"</span>);</span><br><span class="line">modelAndView.addObject(<span class="string">"msg"</span>, e.getMessage());</span><br><span class="line"><span class="keyword">return</span> modelAndView;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span> <span class="attr">xmlns:th</span>=<span class="string">"http://www/thymeleaf.org"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">欢迎来到小滴课堂 这个是自定义异常界面</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">th:text</span>=<span class="string">"$&#123;msg&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="Servlet3-0和SpringBoot2-X过滤器"><a href="#Servlet3-0和SpringBoot2-X过滤器" class="headerlink" title="Servlet3.0和SpringBoot2.X过滤器"></a>Servlet3.0和SpringBoot2.X过滤器</h2><p>SpringBoot2.X⾥⾯的过滤器</p>
<blockquote>
<p>ApplicationContextHeaderFilter </p>
<p>OrderedCharacterEncodingFilter </p>
<p>OrderedFormContentFilter </p>
<p>OrderedRequestContextFilter</p>
</blockquote>
<p>那么多过滤器，哪个优先级⾼呢？ </p>
<blockquote>
<p>Ordered.HIGHEST_PRECEDENCE Ordered.LOWEST_PRECEDENCE </p>
<p>低位值意味着更⾼的优先级 Higher values are interpreted as lower priority</p>
<p>⾃定义Filter，避免和默认的Filter优先级⼀样，不然会冲突</p>
</blockquote>
<p><strong>抛弃传统⽅式，使⽤新版Servlet3.0的注解开发⾃定义Filter</strong></p>
<p>使⽤Servlet3.0注解开发⾃定义的过滤器 </p>
<p>使⽤Servlet3.0的注解进⾏配置步骤</p>
<ol>
<li>启动类⾥⾯增加 @ServletComponentScan，进⾏扫描 </li>
<li>新建⼀个Filter类，implements Filter，并实现对应的接⼝ </li>
<li>@WebFilter 标记⼀个类为filter，被spring进⾏扫描 urlPatterns：</li>
<li>拦截规则，⽀持正则 控制chain.doFilter的⽅法的调⽤，来实现是否通过放⾏ </li>
<li>不放⾏，web应⽤resp.sendRedirect(“/index.html”) 或者 返回json字符串</li>
</ol>
<p>前后端分离-⾃定义Filter 未登录json错误码提示开发</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.xdclass.demoproject2.filter;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> net.xdclass.demoproject2.domain.User;</span><br><span class="line"><span class="keyword">import</span> net.xdclass.demoproject2.service.impl.UserServiceImpl;</span><br><span class="line"><span class="keyword">import</span> net.xdclass.demoproject2.util.JsonData;</span><br><span class="line"><span class="keyword">import</span> org.thymeleaf.util.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebFilter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//@WebFilter(urlPatterns = "/api/v1/pri/*", filterName = "loginFilter")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 容器加载的时候</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> filterConfig</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ServletException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"init LoginFilter========"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"doFilter LoginFilter========"</span>);</span><br><span class="line"></span><br><span class="line">        HttpServletRequest req = (HttpServletRequest) servletRequest;</span><br><span class="line"></span><br><span class="line">        HttpServletResponse resp = (HttpServletResponse) servletResponse;</span><br><span class="line"></span><br><span class="line">        String token = req.getHeader(<span class="string">"token"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isEmpty(token))&#123;</span><br><span class="line">            token = req.getParameter(<span class="string">"token"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!StringUtils.isEmpty(token))&#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//判断token是否合法 TODO</span></span><br><span class="line">            User user = UserServiceImpl.sessionMap.get(token);</span><br><span class="line">            <span class="keyword">if</span>(user!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                filterChain.doFilter(servletRequest, servletResponse);</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                JsonData jsonData = JsonData.buildError(<span class="string">"登陆失败，token失效"</span>,-<span class="number">2</span>);</span><br><span class="line">                String  jsonStr = objectMapper.writeValueAsString(jsonData);</span><br><span class="line">                renderJson(resp, jsonStr);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            JsonData jsonData = JsonData.buildError(<span class="string">"未登陆"</span>,-<span class="number">3</span>);</span><br><span class="line">            String  jsonStr = objectMapper.writeValueAsString(jsonData);</span><br><span class="line">            renderJson(resp, jsonStr);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">renderJson</span><span class="params">(HttpServletResponse response, String json)</span></span>&#123;</span><br><span class="line">        response.setCharacterEncoding(<span class="string">"UTF-8"</span>);</span><br><span class="line">        response.setContentType(<span class="string">"application/json"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>(PrintWriter writer = response.getWriter())&#123;</span><br><span class="line"></span><br><span class="line">            writer.print(json);</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 容器销毁的时候</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"destroy LoginFilter========"</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="SpringBoot2-X拦截器配置实战"><a href="#SpringBoot2-X拦截器配置实战" class="headerlink" title="SpringBoot2.X拦截器配置实战"></a>SpringBoot2.X拦截器配置实战</h2><p>拦截器： 和过滤器⽤途基本类似</p>
<p>SpringBoot2.x使⽤步骤</p>
<p>SpringBoot2.X 新版本配置拦截器 implements WebMvcConfigurer</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.xdclass.demoproject2.intercepter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 拦截器配置类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Yuery</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/4/5/0005 - 9:06</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomWebMvcConfigurer</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        registry.addInterceptor(getLoginInterceptor()).addPathPatterns(<span class="string">"/api/v1/pri/**"</span>);</span><br><span class="line"></span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> TwoIntercepter()).addPathPatterns(<span class="string">"/api/v1/pri/**"</span>);</span><br><span class="line"></span><br><span class="line">        WebMvcConfigurer.<span class="keyword">super</span>.addInterceptors(registry);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> LoginIntercepter <span class="title">getLoginInterceptor</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> LoginIntercepter();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​    ⾃定义拦截器实现HandlerInterceptor</p>
<pre><code>1. preHandle：调⽤Controller某个⽅法之前
2. postHandle：Controller之后调⽤，视图渲染之前，如果控制器Controller出现了异常，则不会执⾏此⽅法
3. afterCompletion：不管有没有异常，这个afterCompletion都会被调⽤，⽤于资源清理</code></pre><p>注意：按照注册顺序进⾏拦截，先注册，先被拦截</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.xdclass.demoproject2.intercepter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> net.xdclass.demoproject2.domain.User;</span><br><span class="line"><span class="keyword">import</span> net.xdclass.demoproject2.service.impl.UserServiceImpl;</span><br><span class="line"><span class="keyword">import</span> net.xdclass.demoproject2.util.JsonData;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"><span class="keyword">import</span> org.thymeleaf.util.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Yuery</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/4/5/0005 - 9:08</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginIntercepter</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"LoginIntercepter preHandle ====="</span>);</span><br><span class="line"></span><br><span class="line">        String token = request.getHeader(<span class="string">"token"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isEmpty(token))&#123;</span><br><span class="line">            token = request.getParameter(<span class="string">"token"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!StringUtils.isEmpty(token))&#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//判断token是否合法 TODO</span></span><br><span class="line">            User user = UserServiceImpl.sessionMap.get(token);</span><br><span class="line">            <span class="keyword">if</span>(user!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                JsonData jsonData = JsonData.buildError(<span class="string">"登陆失败，token失效"</span>,-<span class="number">2</span>);</span><br><span class="line">                String  jsonStr = objectMapper.writeValueAsString(jsonData);</span><br><span class="line">                renderJson(response, jsonStr);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            JsonData jsonData = JsonData.buildError(<span class="string">"未登陆"</span>,-<span class="number">3</span>);</span><br><span class="line">            String  jsonStr = objectMapper.writeValueAsString(jsonData);</span><br><span class="line">            renderJson(response, jsonStr);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//return HandlerInterceptor.super.preHandle(request, response, handler);</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">renderJson</span><span class="params">(HttpServletResponse response, String json)</span></span>&#123;</span><br><span class="line">        response.setCharacterEncoding(<span class="string">"UTF-8"</span>);</span><br><span class="line">        response.setContentType(<span class="string">"application/json"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>(PrintWriter writer = response.getWriter())&#123;</span><br><span class="line"></span><br><span class="line">            writer.print(json);</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"LoginIntercepter postHandle ====="</span>);</span><br><span class="line"></span><br><span class="line">        HandlerInterceptor.<span class="keyword">super</span>.postHandle(request, response, handler, modelAndView);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"LoginIntercepter afterCompletion ====="</span>);</span><br><span class="line"></span><br><span class="line">        HandlerInterceptor.<span class="keyword">super</span>.afterCompletion(request, response, handler, ex);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Filter和Interceptor⼆者都是AOP编程思想的体现，功能基本都可以实现 </p>
<p>拦截器功能更强⼤些，Filter能做的事情它都能做 </p>
<p>Filter在只在Servlet前后起作⽤，⽽Interceptor够深⼊到⽅法前后、异常抛出前后等 filter依赖于Servlet容器即web应⽤中，⽽Interceptor不依赖于Servlet容器所以可以运⾏在 多种环境。 </p>
<p>在接⼝调⽤的⽣命周期⾥，Interceptor可以被多次调⽤，⽽Filter只能在容器初始化时调⽤⼀ 次。  </p>
<p>Filter和Interceptor的执⾏顺序：过滤前-&gt;拦截前-&gt;action执⾏-&gt;拦截后-&gt;过滤后</p>
</blockquote>
<h2 id="SpringBoot2-X定时任务schedule"><a href="#SpringBoot2-X定时任务schedule" class="headerlink" title="SpringBoot2.X定时任务schedule"></a>SpringBoot2.X定时任务schedule</h2><p><strong>常⻅定时任务</strong></p>
<ol>
<li><p>Java⾃带的java.util.Timer类配置⽐较麻烦，时间延后问题</p>
</li>
<li><p>Quartz框架: 配置更简单，xml或者注解适合分布式或者⼤型调度作业 </p>
</li>
<li><p>SpringBoot框架⾃带</p>
</li>
</ol>
<p><strong>SpringBoot使⽤注解⽅式开启定时任务</strong></p>
<ol>
<li>启动类⾥⾯ @EnableScheduling开启定时任务，⾃动扫描 </li>
<li>定时任务业务类 加注解 @Component被容器扫描 </li>
<li>定时执⾏的⽅法加上注解 @Scheduled(fixedRate=2000) 定期执⾏⼀次</li>
<li>fixedRate: 定时多久执⾏⼀次（上⼀次开始执⾏时间点后xx秒再次执⾏；）</li>
<li>fixedDelay: 上⼀次执⾏结束时间点后xx秒再次执⾏</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.xdclass.demoproject2.schedule;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Scheduled;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 定时统计订单，金额</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Yuery</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/4/5/0005 - 13:57</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VideoOrderTask</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//每两秒执行一次</span></span><br><span class="line">    <span class="comment">//@Scheduled(fixedRate = 2000)</span></span><br><span class="line">    <span class="comment">//@Scheduled(fixedDelay = 2000)</span></span><br><span class="line">    <span class="comment">//cron表达式 https://tool.lu.crontab/</span></span><br><span class="line">    <span class="meta">@Scheduled</span>(cron = <span class="string">"*/1 * * * * *"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sum</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//正常的是从数据库中查询</span></span><br><span class="line">        System.out.println(LocalDateTime.now()+<span class="string">" 当前交易额="</span>+ Math.random());</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            Thread.sleep(<span class="number">2000L</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (InterruptedException e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="SpringBoot2-x异步任务EnableAsync"><a href="#SpringBoot2-x异步任务EnableAsync" class="headerlink" title="SpringBoot2.x异步任务EnableAsync"></a>SpringBoot2.x异步任务EnableAsync</h2><ol>
<li><p>启动类⾥⾯使⽤@EnableAsync注解开启功能，⾃动扫描 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.xdclass.demoproject2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.EnableAutoConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.web.servlet.ServletComponentScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.EnableAsync;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.EnableScheduling;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@ServletComponentScan</span></span><br><span class="line"><span class="meta">@EnableScheduling</span></span><br><span class="line"><span class="meta">@EnableAsync</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoProject2Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		SpringApplication.run(DemoProject2Application<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>定义异步任务类并使⽤@Component标记组件被容器扫描，异步⽅法加上@Async</p>
</li>
<li><p>使⽤SpringBoot2.x开发异步任务Future获取结果 </p>
<p>定义异步任务类需要获取结果 </p>
<p>注意点：</p>
<ol>
<li>要把异步任务封装到类⾥⾯，不能直接写到Controller </li>
<li>增加Future 返回结果 AsyncResult(“task执⾏完成”); </li>
<li>如果需要拿到结果，需要判断全部的 task.isDone()</li>
</ol>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.xdclass.demoproject2.task;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Async;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.AsyncResult;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Future;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Yuery</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/4/5/0005 - 15:25</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Async</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsyncTask</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">task1</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">4000L</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"task1"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">task2</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">4000L</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"task2"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">task3</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">4000L</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"task3"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Future&lt;String&gt; <span class="title">task4</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">4000L</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"task4"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> AsyncResult&lt;String&gt;(<span class="string">" task4 "</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Future&lt;String&gt; <span class="title">task5</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">4000L</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"task5"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> AsyncResult&lt;String&gt;(<span class="string">" task5 "</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"async"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> JsonData <span class="title">testAsync</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">long</span> begin = System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line"><span class="comment">//        asyncTask.task1();</span></span><br><span class="line"><span class="comment">//        asyncTask.task2();</span></span><br><span class="line"><span class="comment">//        asyncTask.task3();</span></span><br><span class="line"></span><br><span class="line">        Future&lt;String&gt; task4 = asyncTask.task4();</span><br><span class="line">        Future&lt;String&gt; task5 = asyncTask.task5();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(;;)&#123;</span><br><span class="line">            <span class="keyword">if</span>(task4.isDone() &amp;&amp; task5.isDone())&#123;</span><br><span class="line">                <span class="keyword">try</span>&#123;</span><br><span class="line">                    String task4Result = task4.get();</span><br><span class="line">                    System.out.println(task4Result);</span><br><span class="line"></span><br><span class="line">                    String task5Result = task5.get();</span><br><span class="line">                    System.out.println(task5Result);</span><br><span class="line"></span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (ExecutionException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">long</span> end = System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">return</span> JsonData.buildSuccess(end - begin);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Kaluna</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://blog.kaluna.top/2021/04/21/%E5%B0%8F%E6%BB%B4%E8%AF%BE%E5%A0%82%E4%B8%80/">https://blog.kaluna.top/2021/04/21/%E5%B0%8F%E6%BB%B4%E8%AF%BE%E5%A0%82%E4%B8%80/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/springboot/">springboot</a></div><div class="post-qr-code"><div class="post-qr-code-item"><img class="post-qr-code__img" src="https://i.loli.net/2021/04/20/FbPtxEHeSDgCXBy.jpg"><div class="post-qr-code__desc">添加我为好友</div></div></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2021/04/21/%E5%B0%8F%E6%BB%B4%E8%AF%BE%E5%A0%82%E5%9C%A8%E7%BA%BF%E6%95%99%E8%82%B2%E7%B3%BB%E7%BB%9F/"><i class="fa fa-chevron-left">  </i><span>小滴课堂在线教育系统</span></a></div><div class="next-post pull-right"><a href="/2021/04/21/%E5%B0%8F%E6%BB%B4%E8%AF%BE%E5%A0%82%E4%B8%89/"><span>小滴课堂三</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="disqus_thread"></div><script>var unused = null;
var disqus_config = function () {
  this.page.url = 'https://blog.kaluna.top/2021/04/21/%E5%B0%8F%E6%BB%B4%E8%AF%BE%E5%A0%82%E4%B8%80/';
  this.page.identifier = '2021/04/21/小滴课堂一/';
  this.page.title = '小滴课堂一';
}
var d = document, s = d.createElement('script');
s.src = "https://" + 'shortname-pzy8cndfkq' +".disqus.com/embed.js";
s.setAttribute('data-timestamp', '' + +new Date());
(d.head || d.body).appendChild(s);</script><script id="dsq-count-scr" src="https://shortname-pzy8cndfkq.disqus.com/count.js" async></script></div></div><footer class="footer-bg" style="background-image: url(https://gitee.com/YuerryHUAHUA/figure/raw/master/img/20210521080208.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2021 By Kaluna</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="icp"><a><span></span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.7.0"></script><script src="/js/fancybox.js?version=1.7.0"></script><script src="/js/sidebar.js?version=1.7.0"></script><script src="/js/copy.js?version=1.7.0"></script><script src="/js/fireworks.js?version=1.7.0"></script><script src="/js/transition.js?version=1.7.0"></script><script src="/js/scroll.js?version=1.7.0"></script><script src="/js/head.js?version=1.7.0"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>