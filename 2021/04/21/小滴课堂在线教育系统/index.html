<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="小滴课堂在线教育系统"><meta name="keywords" content="小滴课堂"><meta name="author" content="Kaluna"><meta name="copyright" content="Kaluna"><title>小滴课堂在线教育系统 | 嘿，不停转的轮子</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="嘿，不停转的轮子" type="application/atom+xml">
</head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#小滴课堂在线教育系统"><span class="toc-number">1.</span> <span class="toc-text">小滴课堂在线教育系统</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#在线教育的核心模块"><span class="toc-number">1.1.</span> <span class="toc-text">在线教育的核心模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#在线教育的核心库表结构"><span class="toc-number">1.2.</span> <span class="toc-text">在线教育的核心库表结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringBoot2-X-后端项目框架搭建"><span class="toc-number">1.3.</span> <span class="toc-text">SpringBoot2.X 后端项目框架搭建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#创建相关的包和项目用的实体类"><span class="toc-number">1.4.</span> <span class="toc-text">创建相关的包和项目用的实体类</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#小滴课堂项目实战之打通Mybatis连接MySQL开发视频列表"><span class="toc-number">2.</span> <span class="toc-text">小滴课堂项目实战之打通Mybatis连接MySQL开发视频列表</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#小滴课堂实战之Mybatis打通MySQL数据库"><span class="toc-number">2.1.</span> <span class="toc-text">小滴课堂实战之Mybatis打通MySQL数据库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#小滴课堂实战之视频列表接口开发-API权限路径规划"><span class="toc-number">2.2.</span> <span class="toc-text">小滴课堂实战之视频列表接口开发+API权限路径规划</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#小滴课堂实战之实现IDEA项目热部署"><span class="toc-number">2.3.</span> <span class="toc-text">小滴课堂实战之实现IDEA项目热部署</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#小滴课堂实战之首页banner轮播图和视频详情接口开发"><span class="toc-number">2.4.</span> <span class="toc-text">小滴课堂实战之首页banner轮播图和视频详情接口开发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#小滴课堂实战之视频详情接口开发-三表关联查询映射"><span class="toc-number">2.5.</span> <span class="toc-text">小滴课堂实战之视频详情接口开发-三表关联查询映射</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#小滴课堂实战之自定义异常开发和配置"><span class="toc-number">2.6.</span> <span class="toc-text">小滴课堂实战之自定义异常开发和配置</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#小滴课堂项目实战之用户注册登录模块和JWT登录解决方案"><span class="toc-number">3.</span> <span class="toc-text">小滴课堂项目实战之用户注册登录模块和JWT登录解决方案</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#小滴课堂实战之用户注册功能开发和MD5加密工具类封装"><span class="toc-number">3.1.</span> <span class="toc-text">小滴课堂实战之用户注册功能开发和MD5加密工具类封装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#常见的互联网项目中-单机和分布式应用的登录校验解决方案"><span class="toc-number">3.2.</span> <span class="toc-text">常见的互联网项目中 单机和分布式应用的登录校验解决方案</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#分布式应用下登录检验解决方案-JWT讲解"><span class="toc-number">3.3.</span> <span class="toc-text">分布式应用下登录检验解决方案 JWT讲解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#登录校验Json-Web-Token实战之封装通用方法"><span class="toc-number">3.4.</span> <span class="toc-text">登录校验Json Web Token实战之封装通用方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#小滴课堂实战之登录模块开发整合Json-Web-Token"><span class="toc-number">3.5.</span> <span class="toc-text">小滴课堂实战之登录模块开发整合Json Web Token</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#小滴课堂项目实战之登录拦截器开发和订单模块开发"><span class="toc-number">4.</span> <span class="toc-text">小滴课堂项目实战之登录拦截器开发和订单模块开发</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#小滴课堂实战之用户登录校验拦截器开发"><span class="toc-number">4.1.</span> <span class="toc-text">小滴课堂实战之用户登录校验拦截器开发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#小滴课堂实战之loginInterceptor注册和放行路径"><span class="toc-number">4.2.</span> <span class="toc-text">小滴课堂实战之loginInterceptor注册和放行路径</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#小滴课堂实战之个人信息查询接口开发"><span class="toc-number">4.3.</span> <span class="toc-text">小滴课堂实战之个人信息查询接口开发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#小滴课堂实战之VideoOrder下单模块开发"><span class="toc-number">4.4.</span> <span class="toc-text">小滴课堂实战之VideoOrder下单模块开发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#小滴课堂实战之播放记录表设计和模块开发"><span class="toc-number">4.5.</span> <span class="toc-text">小滴课堂实战之播放记录表设计和模块开发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#小滴课堂实战之订单和播放记录事务控制"><span class="toc-number">4.6.</span> <span class="toc-text">小滴课堂实战之订单和播放记录事务控制</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#性能优化实战之协议优化和引入Guava缓存"><span class="toc-number">5.</span> <span class="toc-text">性能优化实战之协议优化和引入Guava缓存</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#小滴课堂实战之接口协议调整和日期格式"><span class="toc-number">5.1.</span> <span class="toc-text">小滴课堂实战之接口协议调整和日期格式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#高并发项目必备利器之分布式缓存和本地缓存"><span class="toc-number">5.2.</span> <span class="toc-text">高并发项目必备利器之分布式缓存和本地缓存</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#分布式缓存和本地缓存知识"><span class="toc-number">5.3.</span> <span class="toc-text">分布式缓存和本地缓存知识</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#谷歌开源缓存框架Guava-Cache讲解和封装缓存组件"><span class="toc-number">5.4.</span> <span class="toc-text">谷歌开源缓存框架Guava Cache讲解和封装缓存组件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#小滴课堂实战之引入本地缓存"><span class="toc-number">5.5.</span> <span class="toc-text">小滴课堂实战之引入本地缓存</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#压力测试工具Jmeter5-X快速入门实战"><span class="toc-number">6.</span> <span class="toc-text">压力测试工具Jmeter5.X快速入门实战</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#接口压测和常用压力测试工具对比"><span class="toc-number">6.1.</span> <span class="toc-text">接口压测和常用压力测试工具对比</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#压测工具本地快速安装Jmeter5-x"><span class="toc-number">6.2.</span> <span class="toc-text">压测工具本地快速安装Jmeter5.x</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Jmeter5-x目录文件讲解和汉化操作"><span class="toc-number">6.3.</span> <span class="toc-text">Jmeter5.x目录文件讲解和汉化操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Jmeter5-X基础功能组件介绍线程组和Sampler"><span class="toc-number">6.4.</span> <span class="toc-text">Jmeter5.X基础功能组件介绍线程组和Sampler</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Jmeter5-x实战之压测结果聚合报告分析"><span class="toc-number">6.5.</span> <span class="toc-text">Jmeter5.x实战之压测结果聚合报告分析</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#实战接口压力测试，明白优化前后的QPS并发差距和跨域配置"><span class="toc-number">7.</span> <span class="toc-text">实战接口压力测试，明白优化前后的QPS并发差距和跨域配置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#开启Guava缓存压测热点数据接口"><span class="toc-number">7.1.</span> <span class="toc-text">开启Guava缓存压测热点数据接口</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#取消Guava缓存压测热点数据接口和前后对比"><span class="toc-number">7.2.</span> <span class="toc-text">取消Guava缓存压测热点数据接口和前后对比</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringBoot2-X开启跨域配置"><span class="toc-number">7.3.</span> <span class="toc-text">SpringBoot2.X开启跨域配置</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#互联网公司前端开发环境搭建之Node和Npm介绍"><span class="toc-number">8.</span> <span class="toc-text">互联网公司前端开发环境搭建之Node和Npm介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#切换npm镜像源为淘宝npm镜像"><span class="toc-number">8.1.</span> <span class="toc-text">切换npm镜像源为淘宝npm镜像</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#新版Vue-脚手架Vue-Cli-4-3-安装"><span class="toc-number">9.</span> <span class="toc-text">新版Vue + 脚手架Vue-Cli 4.3 安装</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#互联网公司-前端-后端项目云服务器生产环境部署核心知识"><span class="toc-number">10.</span> <span class="toc-text">互联网公司 前端-后端项目云服务器生产环境部署核心知识</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#应用部署到可以公网访问需要的知识"><span class="toc-number">10.1.</span> <span class="toc-text">应用部署到可以公网访问需要的知识</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#云服务器介绍和阿里云服务器ECS服务器选购"><span class="toc-number">10.2.</span> <span class="toc-text">云服务器介绍和阿里云服务器ECS服务器选购</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#阿里云服务器远程登录和常用工具"><span class="toc-number">10.3.</span> <span class="toc-text">阿里云服务器远程登录和常用工具</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#生产环境Linux-CentOS云服务器常见相关软件安装"><span class="toc-number">11.</span> <span class="toc-text">生产环境Linux CentOS云服务器常见相关软件安装</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#阿里云Linux服务器Centos7-安装JDK8环境"><span class="toc-number">11.1.</span> <span class="toc-text">阿里云Linux服务器Centos7 安装JDK8环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#生产环境Linux服务器上Nginx介绍和安装"><span class="toc-number">11.2.</span> <span class="toc-text">生产环境Linux服务器上Nginx介绍和安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#生产环境Linux服务器上Mysql安装和导入数据"><span class="toc-number">11.3.</span> <span class="toc-text">生产环境Linux服务器上Mysql安装和导入数据</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#前端-后端集群部署线上Linux云服务器"><span class="toc-number">12.</span> <span class="toc-text">前端-后端集群部署线上Linux云服务器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#前后端项目总体部署架构和阿里云域名解析A记录配置"><span class="toc-number">12.1.</span> <span class="toc-text">前后端项目总体部署架构和阿里云域名解析A记录配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#后端Java-API项目阿里云服务器部署安装"><span class="toc-number">12.2.</span> <span class="toc-text">后端Java API项目阿里云服务器部署安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#前后端分离-前端项目打包上传阿里云服务器"><span class="toc-number">12.3.</span> <span class="toc-text">前后端分离-前端项目打包上传阿里云服务器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#线上部署之前端项目接入Nginx代理服务器"><span class="toc-number">12.4.</span> <span class="toc-text">线上部署之前端项目接入Nginx代理服务器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#高可用处理之后端API多节点集群部署"><span class="toc-number">12.5.</span> <span class="toc-text">高可用处理之后端API多节点集群部署</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">Kaluna</div><div class="author-info__description text-center"></div><div class="follow-button"><a href="https://github.com/lxy1866" target="_blank" rel="noopener">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">22</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">30</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">13</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://gitee.com/YuerryHUAHUA/figure/raw/master/img/20210521080208.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">嘿，不停转的轮子</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/about">About</a><a class="site-page" href="/tags/">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> Search</span></a></span></div><div id="post-info"><div id="post-title">小滴课堂在线教育系统</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-04-21</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Java%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/">Java项目实战</a><span class="post-meta__separator">|</span><i class="fa fa-comment-o post-meta__icon" aria-hidden="true"></i><a href="/2021/04/21/%E5%B0%8F%E6%BB%B4%E8%AF%BE%E5%A0%82%E5%9C%A8%E7%BA%BF%E6%95%99%E8%82%B2%E7%B3%BB%E7%BB%9F/#disqus_thread"><span class="disqus-comment-count" data-disqus-identifier="2021/04/21/小滴课堂在线教育系统/"></span></a></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="小滴课堂在线教育系统"><a href="#小滴课堂在线教育系统" class="headerlink" title="小滴课堂在线教育系统"></a>小滴课堂在线教育系统</h1><h2 id="在线教育的核心模块"><a href="#在线教育的核心模块" class="headerlink" title="在线教育的核心模块"></a>在线教育的核心模块</h2><ul>
<li>注册</li>
<li>登录</li>
<li>轮播图</li>
<li>视频列表</li>
<li>视频详情</li>
<li>下单购买</li>
<li>我的订单</li>
<li>个人中心</li>
</ul>
<p>项目技术栈</p>
<ul>
<li>后端 SpringBoot + Spring +Mybatis +JWT +MySQL +Gauva +Jmeter5.X + IDEA</li>
<li>前端 Vue +VueCLi + Axios +Vuex + CubeUI + VS CODE</li>
<li>部署 阿里云CentOS7 + Nginx + 域名解析</li>
</ul>
<h2 id="在线教育的核心库表结构"><a href="#在线教育的核心库表结构" class="headerlink" title="在线教育的核心库表结构"></a>在线教育的核心库表结构</h2><blockquote>
<ul>
<li>video_banner</li>
<li>video</li>
<li>chapter</li>
<li>episode</li>
<li>video_order</li>
<li>user</li>
</ul>
</blockquote>
<ul>
<li><p>MySQL测试数据导入</p>
</li>
<li><p>MySQL客户端软件</p>
<ul>
<li>苹果系统：sequel pro</li>
<li>Windows：navicat</li>
</ul>
</li>
<li><p>本地安装是可以直接访问</p>
</li>
<li><p>虚拟机或者云服务器安装，测试的话一定要开启MySQL远程访问和防火墙开放对应的端口（搜索博文）</p>
</li>
<li><p>没有一成不变的架构，没有通用的设计方案，一定跟业务结合</p>
</li>
<li><p>导入课程MySQL, 本地安装MySQL务必使用5.7版本</p>
<h2 id="SpringBoot2-X-后端项目框架搭建"><a href="#SpringBoot2-X-后端项目框架搭建" class="headerlink" title="SpringBoot2.X 后端项目框架搭建"></a>SpringBoot2.X 后端项目框架搭建</h2></li>
</ul>
<p>在线创建</p>
<ul>
<li><a href="https://start.spring.io/" target="_blank" rel="noopener">https://start.spring.io/</a></li>
</ul>
<p>添加依赖</p>
<ul>
<li><p>springboot核心包</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.vintage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-vintage-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>mybaits依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>mysql驱动 (注意需要去掉runtime，否则报错)</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>通用工具包</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang3<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>跨域身份验证解决方案 Json web token包</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- JWT相关 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>高性能缓存组件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--guava依赖包--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.guava<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>guava<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>19.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="创建相关的包和项目用的实体类"><a href="#创建相关的包和项目用的实体类" class="headerlink" title="创建相关的包和项目用的实体类"></a>创建相关的包和项目用的实体类</h2><p>项目基本包结构</p>
<ul>
<li>domain实体类创建完成</li>
<li>controller-service-mapper</li>
<li>utils-config-interceptor</li>
</ul>
<h1 id="小滴课堂项目实战之打通Mybatis连接MySQL开发视频列表"><a href="#小滴课堂项目实战之打通Mybatis连接MySQL开发视频列表" class="headerlink" title="小滴课堂项目实战之打通Mybatis连接MySQL开发视频列表"></a>小滴课堂项目实战之打通Mybatis连接MySQL开发视频列表</h1><h2 id="小滴课堂实战之Mybatis打通MySQL数据库"><a href="#小滴课堂实战之Mybatis打通MySQL数据库" class="headerlink" title="小滴课堂实战之Mybatis打通MySQL数据库"></a>小滴课堂实战之Mybatis打通MySQL数据库</h2><p>添加数据库配置</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">server.port</span>=<span class="string">8081</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#==============================数据库相关配置========================================</span></span><br><span class="line"><span class="meta">spring.datasource.driver-class-name</span> =<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="meta">spring.datasource.url</span>=<span class="string">jdbc:mysql://127.0.0.1:3306/online_xdclass?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false</span></span><br><span class="line"><span class="meta">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">spring.datasource.password</span>=<span class="string">xdclass.net</span></span><br><span class="line"><span class="comment">#使用阿里巴巴druid数据源，默认使用自带的</span></span><br><span class="line"><span class="comment">#spring.datasource.type =com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line"><span class="comment">#开启控制台打印sql</span></span><br><span class="line"><span class="meta">mybatis.configuration.log-impl</span>=<span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># mybatis 下划线转驼峰配置,两者都可以</span></span><br><span class="line"><span class="comment">#mybatis.configuration.mapUnderscoreToCamelCase=true</span></span><br><span class="line"><span class="meta">mybatis.configuration.map-underscore-to-camel-case</span>=<span class="string">true</span></span><br><span class="line"><span class="comment">#配置扫描</span></span><br><span class="line"><span class="meta">mybatis.mapper-locations</span>=<span class="string">classpath:mapper/*.xml</span></span><br><span class="line"><span class="comment">#配置xml的结果别名</span></span><br><span class="line"><span class="meta">mybatis.type-aliases-package</span>=<span class="string">net.xdclass.online_xdclass.domain</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>创建Video相关类</p>
</li>
<li><p>创建VideoMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span> <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"net.xdclass.online_xdclass.mapper.VideoMapper"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置扫描mapper路径</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan</span>(<span class="string">"net.xdclass.online_xdclass.mapper"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OnlineXdclassApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    SpringApplication.run(OnlineXdclassApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="小滴课堂实战之视频列表接口开发-API权限路径规划"><a href="#小滴课堂实战之视频列表接口开发-API权限路径规划" class="headerlink" title="小滴课堂实战之视频列表接口开发+API权限路径规划"></a>小滴课堂实战之视频列表接口开发+API权限路径规划</h2><p><strong>开发视频列表JSON接口</strong></p>
<ul>
<li>postman调试接口<ul>
<li>浏览器如果要支持json格化，需要安装谷歌插件，但是网络问题直接安装不了，推荐使用插件</li>
</ul>
</li>
<li>开发视频列表接口</li>
<li>开发jsondata工具类</li>
<li>规划api权限路径<ul>
<li>/api/v1/pub/AA/BB 这个是不需要登录</li>
<li>/api/v1/pri/AA/BB 这个是需要登录</li>
</ul>
</li>
</ul>
<h2 id="小滴课堂实战之实现IDEA项目热部署"><a href="#小滴课堂实战之实现IDEA项目热部署" class="headerlink" title="小滴课堂实战之实现IDEA项目热部署"></a>小滴课堂实战之实现IDEA项目热部署</h2><p>dev-tool不好使</p>
<p>我用了<code>JRebel</code></p>
<h2 id="小滴课堂实战之首页banner轮播图和视频详情接口开发"><a href="#小滴课堂实战之首页banner轮播图和视频详情接口开发" class="headerlink" title="小滴课堂实战之首页banner轮播图和视频详情接口开发"></a>小滴课堂实战之首页banner轮播图和视频详情接口开发</h2><p><strong>首页banner轮播图接口开发</strong></p>
<p>开发轮播列表接口</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"listVideoBanner"</span> <span class="attr">resultType</span>=<span class="string">"VideoBanner"</span>&gt;</span></span><br><span class="line">        select  * from video_banner order by weight asc</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="小滴课堂实战之视频详情接口开发-三表关联查询映射"><a href="#小滴课堂实战之视频详情接口开发-三表关联查询映射" class="headerlink" title="小滴课堂实战之视频详情接口开发-三表关联查询映射"></a>小滴课堂实战之视频详情接口开发-三表关联查询映射</h2><p><strong>视频详情接口，多表关联开发</strong></p>
<ul>
<li>修改Video-Chapter POJO类, 增加属性（不使用DTO）</li>
<li>定义ResultMap</li>
<li>调试接口数据</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"VideoDetailResultMap"</span> <span class="attr">type</span>=<span class="string">"Video"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">jdbcType</span>=<span class="string">"INTEGER"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"title"</span> <span class="attr">jdbcType</span>=<span class="string">"VARCHAR"</span> <span class="attr">property</span>=<span class="string">"title"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"summary"</span> <span class="attr">jdbcType</span>=<span class="string">"VARCHAR"</span> <span class="attr">property</span>=<span class="string">"summary"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"cover_img"</span> <span class="attr">jdbcType</span>=<span class="string">"VARCHAR"</span> <span class="attr">property</span>=<span class="string">"coverImg"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"price"</span> <span class="attr">jdbcType</span>=<span class="string">"INTEGER"</span> <span class="attr">property</span>=<span class="string">"price"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"point"</span> <span class="attr">jdbcType</span>=<span class="string">"DOUBLE"</span> <span class="attr">property</span>=<span class="string">"point"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"create_time"</span> <span class="attr">jdbcType</span>=<span class="string">"TIMESTAMP"</span> <span class="attr">property</span>=<span class="string">"createTime"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"chapterList"</span> <span class="attr">ofType</span>=<span class="string">"Chapter"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"chapter_id"</span> <span class="attr">jdbcType</span>=<span class="string">"INTEGER"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"chapter_title"</span> <span class="attr">jdbcType</span>=<span class="string">"VARCHAR"</span> <span class="attr">property</span>=<span class="string">"title"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"ordered"</span> <span class="attr">jdbcType</span>=<span class="string">"INTEGER"</span> <span class="attr">property</span>=<span class="string">"ordered"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"chapter_create_time"</span> <span class="attr">jdbcType</span>=<span class="string">"TIMESTAMP"</span> <span class="attr">property</span>=<span class="string">"createTime"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"episodeList"</span> <span class="attr">ofType</span>=<span class="string">"Episode"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"episode_id"</span> <span class="attr">jdbcType</span>=<span class="string">"INTEGER"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"num"</span> <span class="attr">jdbcType</span>=<span class="string">"INTEGER"</span> <span class="attr">property</span>=<span class="string">"num"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"episode_title"</span> <span class="attr">jdbcType</span>=<span class="string">"VARCHAR"</span> <span class="attr">property</span>=<span class="string">"title"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"episode_ordered"</span> <span class="attr">jdbcType</span>=<span class="string">"INTEGER"</span> <span class="attr">property</span>=<span class="string">"ordered"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"play_url"</span> <span class="attr">jdbcType</span>=<span class="string">"VARCHAR"</span> <span class="attr">property</span>=<span class="string">"playUrl"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"free"</span> <span class="attr">jdbcType</span>=<span class="string">"INTEGER"</span> <span class="attr">property</span>=<span class="string">"free"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"episode_create_time"</span> <span class="attr">jdbcType</span>=<span class="string">"TIMESTAMP"</span> <span class="attr">property</span>=<span class="string">"createTime"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findDetailById"</span> <span class="attr">resultMap</span>=<span class="string">"VideoDetailResultMap"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        select</span><br><span class="line">        v.id, v.title,v.summary,v.cover_img,v.price,v.point,v.create_time,</span><br><span class="line">        c.id as chapter_id, c.title as chapter_title, c.ordered,c.create_time as chapter_create_time,</span><br><span class="line">        e.id as episode_id, e.num, e.title as episode_title,e.ordered as episode_ordered,e.play_url,e.free,e.create_time as episode_create_time</span><br><span class="line"></span><br><span class="line">        from video v</span><br><span class="line"></span><br><span class="line">        left join chapter c on v.id=c.video_id</span><br><span class="line"></span><br><span class="line">        left join episode e on c.id=e.chapter_id</span><br><span class="line"></span><br><span class="line">        where v.id = #&#123;video_id&#125;</span><br><span class="line">        order by c.ordered,e.num asc</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="小滴课堂实战之自定义异常开发和配置"><a href="#小滴课堂实战之自定义异常开发和配置" class="headerlink" title="小滴课堂实战之自定义异常开发和配置"></a>小滴课堂实战之自定义异常开发和配置</h2><p><strong>开发自定义异常和配置</strong></p>
<p>自定义异常 继承 RuntimeException</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 小滴课堂</span></span><br><span class="line"><span class="comment"> * 自定义异常类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XDException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">XDException</span><span class="params">(Integer code, String msg)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line">        <span class="keyword">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCode</span><span class="params">(Integer code)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMsg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> msg;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMsg</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>开发异常处理器ExceptionHandler</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 异常处理类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomExceptionHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> Logger logger = LoggerFactory.getLogger(CustomExceptionHandler<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(value = Exception<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    @<span class="title">ResponseBody</span></span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">JsonData</span> <span class="title">handle</span>(<span class="title">Exception</span> <span class="title">e</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">        logger.error(<span class="string">"[ 系统异常 ]&#123;&#125;"</span>,e);</span><br><span class="line">        <span class="keyword">if</span>( e <span class="keyword">instanceof</span> XDException )&#123;</span><br><span class="line">            XDException xdException = (XDException) e;</span><br><span class="line">            <span class="keyword">return</span> JsonData.buildError(xdException.getCode(),xdException.getMsg());</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> JsonData.buildError(<span class="string">"全局异常，未知错误"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="小滴课堂项目实战之用户注册登录模块和JWT登录解决方案"><a href="#小滴课堂项目实战之用户注册登录模块和JWT登录解决方案" class="headerlink" title="小滴课堂项目实战之用户注册登录模块和JWT登录解决方案"></a>小滴课堂项目实战之用户注册登录模块和JWT登录解决方案</h1><h2 id="小滴课堂实战之用户注册功能开发和MD5加密工具类封装"><a href="#小滴课堂实战之用户注册功能开发和MD5加密工具类封装" class="headerlink" title="小滴课堂实战之用户注册功能开发和MD5加密工具类封装"></a>小滴课堂实战之用户注册功能开发和MD5加密工具类封装</h2><p><strong>用户注册功能接口开发</strong></p>
<p>注册接口开发</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//增加唯一索引</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`user`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`name`</span> <span class="built_in">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'昵称'</span>,</span><br><span class="line">  <span class="string">`pwd`</span> <span class="built_in">varchar</span>(<span class="number">124</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'密码'</span>,</span><br><span class="line">  <span class="string">`head_img`</span> <span class="built_in">varchar</span>(<span class="number">524</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'头像'</span>,</span><br><span class="line">  <span class="string">`phone`</span> <span class="built_in">varchar</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="string">''</span> <span class="keyword">COMMENT</span> <span class="string">'手机号'</span>,</span><br><span class="line">  <span class="string">`create_time`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'创建时间'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>),</span><br><span class="line">  <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> <span class="string">`phone`</span> (<span class="string">`phone`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">8</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br></pre></td></tr></table></figure>

<p>MD5加密工具类封装（不用死记，不常用的方法，直接拷贝使用就行，基本是写一次，其他项目直接拷贝）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">MD5</span><span class="params">(String data)</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            java.security.MessageDigest md = MessageDigest.getInstance(<span class="string">"MD5"</span>);</span><br><span class="line">            <span class="keyword">byte</span>[] array = md.digest(data.getBytes(<span class="string">"UTF-8"</span>));</span><br><span class="line">            StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">byte</span> item : array) &#123;</span><br><span class="line">                sb.append(Integer.toHexString((item &amp; <span class="number">0xFF</span>) | <span class="number">0x100</span>).substring(<span class="number">1</span>, <span class="number">3</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> sb.toString().toUpperCase();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception exception) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>随机头像生成</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String [] headImg = &#123;</span><br><span class="line">            <span class="string">"https://xd-video-pc-img.oss-cn-beijing.aliyuncs.com/xdclass_pro/default/head_img/12.jpeg"</span>,</span><br><span class="line">            <span class="string">"https://xd-video-pc-img.oss-cn-beijing.aliyuncs.com/xdclass_pro/default/head_img/11.jpeg"</span>,</span><br><span class="line">            <span class="string">"https://xd-video-pc-img.oss-cn-beijing.aliyuncs.com/xdclass_pro/default/head_img/13.jpeg"</span>,</span><br><span class="line">            <span class="string">"https://xd-video-pc-img.oss-cn-beijing.aliyuncs.com/xdclass_pro/default/head_img/14.jpeg"</span>,</span><br><span class="line">            <span class="string">"https://xd-video-pc-img.oss-cn-beijing.aliyuncs.com/xdclass_pro/default/head_img/15.jpeg"</span></span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure>

<h2 id="常见的互联网项目中-单机和分布式应用的登录校验解决方案"><a href="#常见的互联网项目中-单机和分布式应用的登录校验解决方案" class="headerlink" title="常见的互联网项目中 单机和分布式应用的登录校验解决方案"></a>常见的互联网项目中 单机和分布式应用的登录校验解决方案</h2><p><strong>讲解单机和分布式应用下登录校验，session共享，分布式缓存使用</strong></p>
<p>单机tomcat应用登录检验</p>
<ul>
<li>sesssion保存在浏览器和应用服务器会话之间</li>
<li>用户登录成功，服务端会保存一个session，当然客户端有一个sessionId</li>
<li>客户端会把sessionId保存在cookie中，每次请求都会携带这个sessionId</li>
</ul>
<p>分布式应用中session共享</p>
<ul>
<li>真实的应用不可能单节点部署，所以就有个多节点登录session共享的问题需要解决</li>
<li>tomcat支持session共享，但是有广播风暴；用户量大的时候，占用资源就严重，不推荐</li>
<li>使用redis存储token:<ul>
<li>服务端使用UUID生成随机64位或者128位token，放入redis中，然后返回给客户端并存储在cookie中</li>
<li>用户每次访问都携带此token，服务端去redis中校验是否有此用户即可</li>
</ul>
</li>
</ul>
<h2 id="分布式应用下登录检验解决方案-JWT讲解"><a href="#分布式应用下登录检验解决方案-JWT讲解" class="headerlink" title="分布式应用下登录检验解决方案 JWT讲解"></a>分布式应用下登录检验解决方案 JWT讲解</h2><p>什么是JWT</p>
<p>JWT 的原理是，服务器认证以后，生成一个 JSON 对象，发回给用户，就像下面这样。</p>
<ul>
<li>JWT 是一个开放标准，它定义了一种用于简洁，自包含的用于通信双方之间以 JSON 对象的形式安全传递信息的方法。 可以使用 HMAC 算法或者是 RSA 的公钥密钥对进行签名</li>
<li><strong>简单来说: 就是通过一定规范来生成token，然后可以通过解密算法逆向解密token，这样就可以获取用户信息</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  id:888,</span><br><span class="line">  name:&#39;小D&#39;,</span><br><span class="line">  expire:10000</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">funtion 加密(object, appsecret)&#123;</span><br><span class="line">xxxx</span><br><span class="line">return base64( token);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function 解密(token ,appsecret)&#123;</span><br><span class="line"></span><br><span class="line">xxxx</span><br><span class="line">&#x2F;&#x2F;成功返回true,失败返回false</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>优点</p>
<ul>
<li>生产的token可以包含基本信息，比如id、用户昵称、头像等信息，避免再次查库</li>
<li>存储在客户端，不占用服务端的内存资源</li>
</ul>
</li>
<li><p>缺点</p>
<ul>
<li>token是经过base64编码，所以可以解码，因此token加密前的对象不应该包含敏感信息，如用户权限，密码等</li>
<li>如果没有服务端存储，则不能做登录失效处理，除非服务端改秘钥</li>
</ul>
<p>JWT格式组成 头部、负载、签名</p>
</li>
<li><p>header+payload+signature</p>
<ul>
<li>头部：主要是描述签名算法</li>
<li>负载：主要描述是加密对象的信息，如用户的id等，也可以加些规范里面的东西，如iss签发者，exp 过期时间，sub 面向的用户</li>
<li>签名：主要是把前面两部分进行加密，防止别人拿到token进行base解密后篡改token</li>
</ul>
</li>
</ul>
<p>关于jwt客户端存储</p>
<ul>
<li>可以存储在cookie，localstorage和sessionStorage里面</li>
</ul>
<h2 id="登录校验Json-Web-Token实战之封装通用方法"><a href="#登录校验Json-Web-Token实战之封装通用方法" class="headerlink" title="登录校验Json Web Token实战之封装通用方法"></a>登录校验Json Web Token实战之封装通用方法</h2><p><strong>引入相关依赖并开发JWT工具类, 开发生产token和校验token的办法</strong></p>
<p>加入相关依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- JWT相关 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>封装生产token方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据用户信息，生成令牌</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">geneJsonWebToken</span><span class="params">(User user)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        String token = Jwts.builder().setSubject(SUBJECT)</span><br><span class="line">                .claim(<span class="string">"head_img"</span>,user.getHeadImg())</span><br><span class="line">                .claim(<span class="string">"id"</span>,user.getId())</span><br><span class="line">                .claim(<span class="string">"name"</span>,user.getName())</span><br><span class="line">                .setIssuedAt(<span class="keyword">new</span> Date())</span><br><span class="line">                .setExpiration(<span class="keyword">new</span> Date(System.currentTimeMillis() + EXPIRE))</span><br><span class="line">                .signWith(SignatureAlgorithm.HS256,SECRET).compact();</span><br><span class="line"></span><br><span class="line">        token = TOKEN_PREFIX + token;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> token;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>封装校验token方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 校验token的方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> token</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Claims <span class="title">checkJWT</span><span class="params">(String token)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="keyword">final</span>  Claims claims = Jwts.parser().setSigningKey(SECRET)</span><br><span class="line">                    .parseClaimsJws(token.replace(TOKEN_PREFIX,<span class="string">""</span>)).getBody();</span><br><span class="line">            <span class="keyword">return</span> claims;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="小滴课堂实战之登录模块开发整合Json-Web-Token"><a href="#小滴课堂实战之登录模块开发整合Json-Web-Token" class="headerlink" title="小滴课堂实战之登录模块开发整合Json Web Token"></a>小滴课堂实战之登录模块开发整合Json Web Token</h2><p><strong>开发登录模块功能，并整合JSON Web Token</strong></p>
<ul>
<li><p>开发登录功能</p>
</li>
<li><p>修改domain 为model层</p>
<ul>
<li><p>增加entity、request包</p>
</li>
<li><p>记得改application.properties配置文件扫描路径!!!!</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">server.port</span>=<span class="string">8089</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#==============================数据库相关配置========================================</span></span><br><span class="line"><span class="meta">spring.datasource.driver-class-name</span> =<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="meta">spring.datasource.url</span>=<span class="string">jdbc:mysql://127.0.0.1:33061/online_xdclass?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false</span></span><br><span class="line"><span class="meta">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">spring.datasource.password</span>=<span class="string">xdclass.net</span></span><br><span class="line"><span class="comment">#使用阿里巴巴druid数据源，默认使用自带的</span></span><br><span class="line"><span class="comment">#spring.datasource.type =com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line"><span class="comment">#开启控制台打印sql</span></span><br><span class="line"><span class="meta">mybatis.configuration.log-impl</span>=<span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># mybatis 下划线转驼峰配置,两者都可以</span></span><br><span class="line"><span class="comment">#mybatis.configuration.mapUnderscoreToCamelCase=true</span></span><br><span class="line"><span class="meta">mybatis.configuration.map-underscore-to-camel-case</span>=<span class="string">true</span></span><br><span class="line"><span class="comment">#配置扫描</span></span><br><span class="line"><span class="meta">mybatis.mapper-locations</span>=<span class="string">classpath:mapper/*.xml</span></span><br><span class="line"><span class="comment">#配置xml的结果别名</span></span><br><span class="line"><span class="meta">mybatis.type-aliases-package</span>=<span class="string">net.xdclass.online_xdclass.model.entity</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>整合JWT工具类</p>
</li>
</ul>
<h1 id="小滴课堂项目实战之登录拦截器开发和订单模块开发"><a href="#小滴课堂项目实战之登录拦截器开发和订单模块开发" class="headerlink" title="小滴课堂项目实战之登录拦截器开发和订单模块开发"></a>小滴课堂项目实战之登录拦截器开发和订单模块开发</h1><h2 id="小滴课堂实战之用户登录校验拦截器开发"><a href="#小滴课堂实战之用户登录校验拦截器开发" class="headerlink" title="小滴课堂实战之用户登录校验拦截器开发"></a>小滴课堂实战之用户登录校验拦截器开发</h2><p>开发loginInterceptor</p>
<ul>
<li><p>登录校验成功放行</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 进入到controller之前的方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> handler</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String accesToken = request.getHeader(<span class="string">"token"</span>);</span><br><span class="line">            <span class="keyword">if</span> (accesToken == <span class="keyword">null</span>) &#123;</span><br><span class="line">                accesToken = request.getParameter(<span class="string">"token"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (StringUtils.isNotBlank(accesToken)) &#123;</span><br><span class="line">                Claims claims = JWTUtils.checkJWT(accesToken);</span><br><span class="line">                <span class="keyword">if</span> (claims == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="comment">//告诉登录过期，重新登录</span></span><br><span class="line">                    sendJsonMessage(response, JsonData.buildError(<span class="string">"登录过期，重新登录"</span>));</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                Integer id = (Integer) claims.get(<span class="string">"id"</span>);</span><br><span class="line">                String name = (String) claims.get(<span class="string">"name"</span>);</span><br><span class="line">                request.setAttribute(<span class="string">"user_id"</span>, id);</span><br><span class="line">                request.setAttribute(<span class="string">"name"</span>, name);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;&#125;</span><br><span class="line">        sendJsonMessage(response, JsonData.buildError(<span class="string">"登录过期，重新登录"</span>));</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="小滴课堂实战之loginInterceptor注册和放行路径"><a href="#小滴课堂实战之loginInterceptor注册和放行路径" class="headerlink" title="小滴课堂实战之loginInterceptor注册和放行路径"></a>小滴课堂实战之loginInterceptor注册和放行路径</h2><p><strong>loginInterceptor 拦截器注册和路径校验配置</strong></p>
<ul>
<li>继承 WebMvcConfigurer</li>
<li>配置拦截路径和放行路径</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 拦截器配置</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 不用权限可以访问url    /api/v1/pub/</span></span><br><span class="line"><span class="comment"> * 要登录可以访问url    /api/v1/pri/</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InterceptorConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">LoginInterceptor <span class="title">loginInterceptor</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> LoginInterceptor();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//拦截全部</span></span><br><span class="line">        registry.addInterceptor(loginInterceptor()).addPathPatterns(<span class="string">"/api/v1/pri/*/*/**"</span>)</span><br><span class="line">                <span class="comment">//不拦截哪些路径   斜杠一定要加</span></span><br><span class="line">                .excludePathPatterns(<span class="string">"/api/v1/pri/user/login"</span>,<span class="string">"/api/v1/pri/user/register"</span>);</span><br><span class="line"></span><br><span class="line">        WebMvcConfigurer.<span class="keyword">super</span>.addInterceptors(registry);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="小滴课堂实战之个人信息查询接口开发"><a href="#小滴课堂实战之个人信息查询接口开发" class="headerlink" title="小滴课堂实战之个人信息查询接口开发"></a>小滴课堂实战之个人信息查询接口开发</h2><p><strong>根据token查询个人信息接口开发</strong></p>
<ul>
<li>通过token解密查询数据库获取个人信息</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"api/v1/pri/user"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据用户id查询用户信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"find_by_token"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> JsonData <span class="title">findUserInfoByToken</span><span class="params">(HttpServletRequest request)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        Integer userId = (Integer) request.getAttribute(<span class="string">"user_id"</span>);</span><br><span class="line">        <span class="keyword">if</span>(userId == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> JsonData.buildError(<span class="string">"查询失败"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        User user =  userService.findByUserId(userId);</span><br><span class="line">        <span class="keyword">return</span> JsonData.buildSuccess(user);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="function">User <span class="title">findByUserId</span><span class="params">(Integer userId)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">findByUserId</span><span class="params">(Integer userId)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    User user = userMapper.findByUserId(userId);</span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">    <span class="function">User <span class="title">findByUserId</span><span class="params">(@Param(<span class="string">"user_id"</span>)</span> Integer userId)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findByUserId"</span> <span class="attr">resultType</span>=<span class="string">"User"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    select  * from user where id=#&#123;user_id&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="小滴课堂实战之VideoOrder下单模块开发"><a href="#小滴课堂实战之VideoOrder下单模块开发" class="headerlink" title="小滴课堂实战之VideoOrder下单模块开发"></a>小滴课堂实战之VideoOrder下单模块开发</h2><p>VideoOrderRequest类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.xdclass.online_xdclass.model.request;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonProperty;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Yuery</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/4/15/0015 - 18:01</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VideoOrderRequest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonProperty</span>(<span class="string">"video_id"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> videoId;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getVideoId</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> videoId;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setVideoId</span><span class="params">(<span class="keyword">int</span> videoId)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.videoId = videoId;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.xdclass.online_xdclass.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> net.xdclass.online_xdclass.model.entity.VideoOrder;</span><br><span class="line"><span class="keyword">import</span> net.xdclass.online_xdclass.model.request.VideoOrderRequest;</span><br><span class="line"><span class="keyword">import</span> net.xdclass.online_xdclass.service.VideoOrderService;</span><br><span class="line"><span class="keyword">import</span> net.xdclass.online_xdclass.utils.JsonData;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/api/v1/pri/order"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VideoOrderController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> VideoOrderService videoOrderService;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 下单接口</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"save"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> JsonData <span class="title">saveOrder</span><span class="params">(@RequestBody VideoOrderRequest videoOrderRequest, HttpServletRequest request)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        Integer userId = (Integer) request.getAttribute(<span class="string">"user_id"</span>);</span><br><span class="line">        <span class="keyword">int</span> rows = videoOrderService.save(userId, videoOrderRequest.getVideoId());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> rows == <span class="number">0</span> ? JsonData.buildError(<span class="string">"下单失败"</span>):JsonData.buildSuccess();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 订单列表</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"list"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> JsonData <span class="title">listOrder</span><span class="params">(HttpServletRequest request)</span></span>&#123;</span><br><span class="line">        Integer userId = (Integer) request.getAttribute(<span class="string">"user_id"</span>);</span><br><span class="line"></span><br><span class="line">        List&lt;VideoOrder&gt; videoOrderList = videoOrderService.listOrderByUserId(userId);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> JsonData.buildSuccess(videoOrderList);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.xdclass.online_xdclass.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> net.xdclass.online_xdclass.model.entity.VideoOrder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">VideoOrderService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">save</span><span class="params">(<span class="keyword">int</span> userId, <span class="keyword">int</span> videoId)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">List&lt;VideoOrder&gt; <span class="title">listOrderByUserId</span><span class="params">(Integer userId)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.xdclass.online_xdclass.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> net.xdclass.online_xdclass.exception.XDException;</span><br><span class="line"><span class="keyword">import</span> net.xdclass.online_xdclass.mapper.*;</span><br><span class="line"><span class="keyword">import</span> net.xdclass.online_xdclass.model.entity.Episode;</span><br><span class="line"><span class="keyword">import</span> net.xdclass.online_xdclass.model.entity.PlayRecord;</span><br><span class="line"><span class="keyword">import</span> net.xdclass.online_xdclass.model.entity.Video;</span><br><span class="line"><span class="keyword">import</span> net.xdclass.online_xdclass.model.entity.VideoOrder;</span><br><span class="line"><span class="keyword">import</span> net.xdclass.online_xdclass.model.request.VideoOrderRequest;</span><br><span class="line"><span class="keyword">import</span> net.xdclass.online_xdclass.service.VideoOrderService;</span><br><span class="line"><span class="keyword">import</span> net.xdclass.online_xdclass.service.VideoService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VideoOrderServiceImpl</span> <span class="keyword">implements</span> <span class="title">VideoOrderService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> VideoOrderMapper videoOrderMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> VideoMapper videoMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EpisodeMapper episodeMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PlayRecordMapper playRecordMapper;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 下单操作</span></span><br><span class="line"><span class="comment">     * 未来版本：优惠券抵扣，风控用户检查，生成订单基础信息，生成支付信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> videoId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">save</span><span class="params">(<span class="keyword">int</span> userId, <span class="keyword">int</span> videoId)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//判断是否已经购买</span></span><br><span class="line">        VideoOrder videoOrder = videoOrderMapper.findByUserIdAndVideoIdAndState(userId,videoId,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(videoOrder!=<span class="keyword">null</span>)&#123;<span class="keyword">return</span>  <span class="number">0</span>;&#125;</span><br><span class="line"></span><br><span class="line">        Video video = videoMapper.findById(videoId);</span><br><span class="line"></span><br><span class="line">        VideoOrder newVideoOrder = <span class="keyword">new</span> VideoOrder();</span><br><span class="line">        newVideoOrder.setCreateTime(<span class="keyword">new</span> Date());</span><br><span class="line">        newVideoOrder.setOutTradeNo(UUID.randomUUID().toString());</span><br><span class="line">        newVideoOrder.setState(<span class="number">1</span>);</span><br><span class="line">        newVideoOrder.setTotalFee(video.getPrice());</span><br><span class="line">        newVideoOrder.setUserId(userId);</span><br><span class="line"></span><br><span class="line">        newVideoOrder.setVideoId(videoId);</span><br><span class="line">        newVideoOrder.setVideoImg(video.getCoverImg());</span><br><span class="line">        newVideoOrder.setVideoTitle(video.getTitle());</span><br><span class="line">        <span class="keyword">int</span> rows = videoOrderMapper.saveOrder(newVideoOrder);</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;VideoOrder&gt; <span class="title">listOrderByUserId</span><span class="params">(Integer userId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> videoOrderMapper.listOrderByUserId(userId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.xdclass.online_xdclass.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> net.xdclass.online_xdclass.model.entity.VideoOrder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">VideoOrderService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">save</span><span class="params">(<span class="keyword">int</span> userId, <span class="keyword">int</span> videoId)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">List&lt;VideoOrder&gt; <span class="title">listOrderByUserId</span><span class="params">(Integer userId)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.xdclass.online_xdclass.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> net.xdclass.online_xdclass.model.entity.VideoOrder;</span><br><span class="line"><span class="keyword">import</span> net.xdclass.online_xdclass.service.VideoOrderService;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Param;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.security.PermitAll;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">VideoOrderMapper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">VideoOrder <span class="title">findByUserIdAndVideoIdAndState</span><span class="params">(@Param(<span class="string">"user_id"</span>)</span> <span class="keyword">int</span> userId, @<span class="title">Param</span><span class="params">(<span class="string">"video_id"</span>)</span> <span class="keyword">int</span> videoId, @<span class="title">Param</span><span class="params">(<span class="string">"state"</span>)</span> <span class="keyword">int</span> state)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 下单</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> videoOrder</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">saveOrder</span><span class="params">(VideoOrder videoOrder)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 视频订单列表</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">List&lt;VideoOrder&gt; <span class="title">listOrderByUserId</span><span class="params">(@Param(<span class="string">"user_id"</span>)</span> Integer userId)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"saveOrder"</span> <span class="attr">useGeneratedKeys</span>=<span class="string">"true"</span> <span class="attr">keyColumn</span>=<span class="string">"id"</span> <span class="attr">keyProperty</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line">    INSERT INTO `video_order` (`out_trade_no`, `state`, `create_time`, `total_fee`, `video_id`,</span><br><span class="line">    `video_title`, `video_img`, `user_id`)</span><br><span class="line">    VALUES</span><br><span class="line">    (#&#123;outTradeNo,jdbcType=VARCHAR&#125;,#&#123;state,jdbcType=INTEGER&#125;,#&#123;createTime,jdbcType=TIMESTAMP&#125;,#&#123;totalFee,jdbcType=INTEGER&#125;,</span><br><span class="line">    #&#123;videoId,jdbcType=INTEGER&#125;,#&#123;videoTitle,jdbcType=VARCHAR&#125;,#&#123;videoImg,jdbcType=VARCHAR&#125;,#&#123;userId,jdbcType=INTEGER&#125;);</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="小滴课堂实战之播放记录表设计和模块开发"><a href="#小滴课堂实战之播放记录表设计和模块开发" class="headerlink" title="小滴课堂实战之播放记录表设计和模块开发"></a>小滴课堂实战之播放记录表设计和模块开发</h2><p>play_record表设计</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`play_record`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`user_id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`video_id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`current_num`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'当前播放第几集'</span>,</span><br><span class="line">  <span class="string">`episode_id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'当前播放第几集视频id'</span>,</span><br><span class="line">  <span class="string">`create_time`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">1</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8mb4;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PlayRecord</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonProperty</span>(<span class="string">"user_id"</span>)</span><br><span class="line">    <span class="keyword">private</span> Integer userId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonProperty</span>(<span class="string">"video_id"</span>)</span><br><span class="line">    <span class="keyword">private</span> Integer videoId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonProperty</span>(<span class="string">"current_num"</span>)</span><br><span class="line">    <span class="keyword">private</span> Integer currentNum;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonProperty</span>(<span class="string">"episode_id"</span>)</span><br><span class="line">    <span class="keyword">private</span> Integer episodeId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonProperty</span>(<span class="string">"create_time"</span>)</span><br><span class="line">    <span class="meta">@JsonFormat</span>(pattern = <span class="string">"yyyy-MM-dd HH:mm:ss"</span>, timezone = <span class="string">"GMT+8"</span>)</span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">    <span class="comment">//省略set get方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.xdclass.online_xdclass.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> net.xdclass.online_xdclass.exception.XDException;</span><br><span class="line"><span class="keyword">import</span> net.xdclass.online_xdclass.mapper.*;</span><br><span class="line"><span class="keyword">import</span> net.xdclass.online_xdclass.model.entity.Episode;</span><br><span class="line"><span class="keyword">import</span> net.xdclass.online_xdclass.model.entity.PlayRecord;</span><br><span class="line"><span class="keyword">import</span> net.xdclass.online_xdclass.model.entity.Video;</span><br><span class="line"><span class="keyword">import</span> net.xdclass.online_xdclass.model.entity.VideoOrder;</span><br><span class="line"><span class="keyword">import</span> net.xdclass.online_xdclass.model.request.VideoOrderRequest;</span><br><span class="line"><span class="keyword">import</span> net.xdclass.online_xdclass.service.VideoOrderService;</span><br><span class="line"><span class="keyword">import</span> net.xdclass.online_xdclass.service.VideoService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VideoOrderServiceImpl</span> <span class="keyword">implements</span> <span class="title">VideoOrderService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> VideoOrderMapper videoOrderMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> VideoMapper videoMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EpisodeMapper episodeMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PlayRecordMapper playRecordMapper;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 下单操作</span></span><br><span class="line"><span class="comment">     * 未来版本：优惠券抵扣，风控用户检查，生成订单基础信息，生成支付信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> videoId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">save</span><span class="params">(<span class="keyword">int</span> userId, <span class="keyword">int</span> videoId)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//判断是否已经购买</span></span><br><span class="line">        VideoOrder videoOrder = videoOrderMapper.findByUserIdAndVideoIdAndState(userId,videoId,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(videoOrder!=<span class="keyword">null</span>)&#123;<span class="keyword">return</span>  <span class="number">0</span>;&#125;</span><br><span class="line"></span><br><span class="line">        Video video = videoMapper.findById(videoId);</span><br><span class="line"></span><br><span class="line">        VideoOrder newVideoOrder = <span class="keyword">new</span> VideoOrder();</span><br><span class="line">        newVideoOrder.setCreateTime(<span class="keyword">new</span> Date());</span><br><span class="line">        newVideoOrder.setOutTradeNo(UUID.randomUUID().toString());</span><br><span class="line">        newVideoOrder.setState(<span class="number">1</span>);</span><br><span class="line">        newVideoOrder.setTotalFee(video.getPrice());</span><br><span class="line">        newVideoOrder.setUserId(userId);</span><br><span class="line"></span><br><span class="line">        newVideoOrder.setVideoId(videoId);</span><br><span class="line">        newVideoOrder.setVideoImg(video.getCoverImg());</span><br><span class="line">        newVideoOrder.setVideoTitle(video.getTitle());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> rows = videoOrderMapper.saveOrder(newVideoOrder);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//生成播放记录</span></span><br><span class="line">        <span class="keyword">if</span>(rows == <span class="number">1</span>)&#123;</span><br><span class="line">            Episode episode = episodeMapper.findFirstEpisodeByVideoId(videoId);</span><br><span class="line">            <span class="keyword">if</span>(episode == <span class="keyword">null</span>)&#123;</span><br><span class="line">                <span class="keyword">throw</span>  <span class="keyword">new</span> XDException(-<span class="number">1</span>,<span class="string">"视频没有集信息，请运营人员检查"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            PlayRecord playRecord = <span class="keyword">new</span> PlayRecord();</span><br><span class="line">            playRecord.setCreateTime(<span class="keyword">new</span> Date());</span><br><span class="line">            playRecord.setEpisodeId(episode.getId());</span><br><span class="line">            playRecord.setCurrentNum(episode.getNum());</span><br><span class="line">            playRecord.setUserId(userId);</span><br><span class="line">            playRecord.setVideoId(videoId);</span><br><span class="line">            playRecordMapper.saveRecord(playRecord);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> rows;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;VideoOrder&gt; <span class="title">listOrderByUserId</span><span class="params">(Integer userId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> videoOrderMapper.listOrderByUserId(userId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.xdclass.online_xdclass.mapper;</span><br><span class="line"><span class="keyword">import</span> net.xdclass.online_xdclass.model.entity.PlayRecord;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PlayRecordMapper</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">saveRecord</span><span class="params">(PlayRecord playRecord)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"saveRecord"</span> <span class="attr">useGeneratedKeys</span>=<span class="string">"true"</span> <span class="attr">keyProperty</span>=<span class="string">"id"</span> <span class="attr">keyColumn</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    INSERT INTO `play_record` ( `user_id`, `video_id`, `current_num`, `episode_id`, `create_time`)</span><br><span class="line">    VALUES (#&#123;userId&#125;,#&#123;videoId&#125;,#&#123;currentNum&#125;,#&#123;episodeId&#125;,#&#123;createTime&#125;);</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="小滴课堂实战之订单和播放记录事务控制"><a href="#小滴课堂实战之订单和播放记录事务控制" class="headerlink" title="小滴课堂实战之订单和播放记录事务控制"></a>小滴课堂实战之订单和播放记录事务控制</h2><p>开启事务控制</p>
<ul>
<li>启动类 @EnableTransactionManagement</li>
<li>业务类，或者业务方法 @Transactional</li>
<li>默认事务的隔离级别和传播属性</li>
</ul>
<h1 id="性能优化实战之协议优化和引入Guava缓存"><a href="#性能优化实战之协议优化和引入Guava缓存" class="headerlink" title="性能优化实战之协议优化和引入Guava缓存"></a>性能优化实战之协议优化和引入Guava缓存</h1><h2 id="小滴课堂实战之接口协议调整和日期格式"><a href="#小滴课堂实战之接口协议调整和日期格式" class="headerlink" title="小滴课堂实战之接口协议调整和日期格式"></a>小滴课堂实战之接口协议调整和日期格式</h2><ul>
<li><p>统一输出协议，驼峰转下划线</p>
</li>
<li><p>格式化日期</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@JsonProperty</span>(<span class="string">"create_time"</span>)</span><br><span class="line"><span class="meta">@JsonFormat</span>(pattern = <span class="string">"yyyy-MM-dd HH:mm:ss"</span>, timezone = <span class="string">"GMT+8"</span>)</span><br><span class="line"><span class="keyword">private</span> Date createTime;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="高并发项目必备利器之分布式缓存和本地缓存"><a href="#高并发项目必备利器之分布式缓存和本地缓存" class="headerlink" title="高并发项目必备利器之分布式缓存和本地缓存"></a>高并发项目必备利器之分布式缓存和本地缓存</h2><h2 id="分布式缓存和本地缓存知识"><a href="#分布式缓存和本地缓存知识" class="headerlink" title="分布式缓存和本地缓存知识"></a>分布式缓存和本地缓存知识</h2><ul>
<li><p>什么是缓存</p>
<ul>
<li>程序经常要调用的对象存在内存中,方便其使用时可以快速调用,不必去数据库或者其他持久化设备中查询，主要就是提高性能</li>
<li>DNS缓存、前端缓存、代理服务器缓存Nginx、应用程序缓存（本地缓存、分布式缓存）、数据库缓存</li>
</ul>
</li>
<li><p>分布式缓存</p>
<ul>
<li>与应用分离的缓存组件或服务，与本地应用隔离一个独立的应用，多个应用可直接的共享缓存</li>
<li>常见的分布式缓存 Redis、Memcached等</li>
</ul>
</li>
<li><p>本地缓存</p>
<ul>
<li>和业务程序一起的缓存，例如mybatis的一级或者二级缓存，本地缓存自然是最快的，但是不能在多个节点共享</li>
<li>常见的本地缓存：myabtis一级缓存、mybatis二级缓存；框架本身的缓存； redis本地单机服务；ehchche；guava cache、Caffeine等</li>
</ul>
</li>
<li><p>选择本地缓存和分布式缓存</p>
<ul>
<li>和业务数据结合去选择</li>
<li>高并发项目里面一般都是有本地缓存和分布式缓存共同存在的</li>
</ul>
</li>
</ul>
<h2 id="谷歌开源缓存框架Guava-Cache讲解和封装缓存组件"><a href="#谷歌开源缓存框架Guava-Cache讲解和封装缓存组件" class="headerlink" title="谷歌开源缓存框架Guava Cache讲解和封装缓存组件"></a>谷歌开源缓存框架Guava Cache讲解和封装缓存组件</h2><p>Guava Cache</p>
<ul>
<li>github地址：<a href="https://github.com/google/guava/wiki/CachesExplained" target="_blank" rel="noopener">https://github.com/google/guava/wiki/CachesExplained</a></li>
<li>全内存的本地缓存实现</li>
<li>高性能且功能丰富</li>
<li>线程安全，操作简单 (底层实现机制类似ConcurrentMap)</li>
</ul>
<p>添加依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--guava依赖包--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.guava<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>guava<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>19.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>封装api</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.xdclass.online_xdclass.utils;</span><br><span class="line"><span class="keyword">import</span> com.google.common.cache.Cache;</span><br><span class="line"><span class="keyword">import</span> com.google.common.cache.CacheBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseCache</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Cache&lt;String,Object&gt; tenMinuteCache = CacheBuilder.newBuilder()</span><br><span class="line"></span><br><span class="line">            <span class="comment">//设置缓存初始大小，应该合理设置，后续会扩容</span></span><br><span class="line">            .initialCapacity(<span class="number">10</span>)</span><br><span class="line">            <span class="comment">//最大值</span></span><br><span class="line">            .maximumSize(<span class="number">100</span>)</span><br><span class="line">            <span class="comment">//并发数设置</span></span><br><span class="line">            .concurrencyLevel(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment">//缓存过期时间，写入后10分钟过期</span></span><br><span class="line">            .expireAfterWrite(<span class="number">600</span>,TimeUnit.SECONDS)</span><br><span class="line"></span><br><span class="line">            <span class="comment">//统计缓存命中率</span></span><br><span class="line">            .recordStats()</span><br><span class="line"></span><br><span class="line">            .build();</span><br><span class="line">    <span class="keyword">private</span> Cache&lt;String,Object&gt; oneHourCache = CacheBuilder.newBuilder()</span><br><span class="line">            <span class="comment">//设置缓存初始大小，应该合理设置，后续会扩容</span></span><br><span class="line">            .initialCapacity(<span class="number">30</span>)</span><br><span class="line">            <span class="comment">//最大值</span></span><br><span class="line">            .maximumSize(<span class="number">100</span>)</span><br><span class="line">            <span class="comment">//并发数设置</span></span><br><span class="line">            .concurrencyLevel(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment">//缓存过期时间，写入后1小时 过期</span></span><br><span class="line">            .expireAfterWrite(<span class="number">3600</span>,TimeUnit.SECONDS)</span><br><span class="line"></span><br><span class="line">            <span class="comment">//统计缓存命中率</span></span><br><span class="line">            .recordStats()</span><br><span class="line"></span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Cache&lt;String, Object&gt; <span class="title">getOneHourCache</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> oneHourCache;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOneHourCache</span><span class="params">(Cache&lt;String, Object&gt; oneHourCache)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.oneHourCache = oneHourCache;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Cache&lt;String, Object&gt; <span class="title">getTenMinuteCache</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> tenMinuteCache;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTenMinuteCache</span><span class="params">(Cache&lt;String, Object&gt; tenMinuteCache)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.tenMinuteCache = tenMinuteCache;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="小滴课堂实战之引入本地缓存"><a href="#小滴课堂实战之引入本地缓存" class="headerlink" title="小滴课堂实战之引入本地缓存"></a>小滴课堂实战之引入本地缓存</h2><p><strong>轮播图接口加入缓存</strong></p>
<p><strong>视频列表引入本地缓存</strong></p>
<p><strong>视频详情加入本地缓存</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.xdclass.online_xdclass.config;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 缓存key管理类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CacheKeyManager</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 首页轮播图缓存key</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String INDEX_BANNER_KEY = <span class="string">"index:banner:list"</span>; </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 首页视频列表缓存key</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String INDEX_VIDEL_LIST = <span class="string">"index:video:list"</span>; </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 视频详情缓存key, %s是视频id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String VIDEO_DETAIL = <span class="string">"video:detail:%s"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.xdclass.online_xdclass.service.impl;</span><br><span class="line"><span class="keyword">import</span> net.xdclass.online_xdclass.config.CacheKeyManager;</span><br><span class="line"><span class="keyword">import</span> net.xdclass.online_xdclass.model.entity.Video;</span><br><span class="line"><span class="keyword">import</span> net.xdclass.online_xdclass.model.entity.VideoBanner;</span><br><span class="line"><span class="keyword">import</span> net.xdclass.online_xdclass.mapper.VideoMapper;</span><br><span class="line"><span class="keyword">import</span> net.xdclass.online_xdclass.service.VideoService;</span><br><span class="line"><span class="keyword">import</span> net.xdclass.online_xdclass.utils.BaseCache;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VideoServiceImpl</span> <span class="keyword">implements</span> <span class="title">VideoService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> VideoMapper videoMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BaseCache baseCache;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Video&gt; <span class="title">listVideo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            Object cacheObj =  baseCache.getTenMinuteCache().get(CacheKeyManager.INDEX_VIDEL_LIST,()-&gt;&#123;</span><br><span class="line">                List&lt;Video&gt; videoList = videoMapper.listVideo();</span><br><span class="line">                <span class="keyword">return</span> videoList;</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">if</span>(cacheObj <span class="keyword">instanceof</span> List)&#123;</span><br><span class="line">                List&lt;Video&gt; videoList = (List&lt;Video&gt;)cacheObj;</span><br><span class="line">                <span class="keyword">return</span> videoList;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//可以返回兜底数据，业务系统降级-》SpringCloud专题课程</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;VideoBanner&gt; <span class="title">listBanner</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            Object cacheObj =  baseCache.getTenMinuteCache().get(CacheKeyManager.INDEX_BANNER_KEY, ()-&gt;&#123;</span><br><span class="line">                List&lt;VideoBanner&gt; bannerList =  videoMapper.listVideoBanner();</span><br><span class="line">                System.out.println(<span class="string">"从数据库里面找轮播图列表"</span>);</span><br><span class="line">                <span class="keyword">return</span> bannerList;</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">if</span>(cacheObj <span class="keyword">instanceof</span> List)&#123;</span><br><span class="line">                List&lt;VideoBanner&gt; bannerList = (List&lt;VideoBanner&gt;)cacheObj;</span><br><span class="line">                <span class="keyword">return</span> bannerList;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Video <span class="title">findDetailById</span><span class="params">(<span class="keyword">int</span> videoId)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//单独构建一个缓存key，每个视频的key是不一样的</span></span><br><span class="line">        String videoCacheKey = String.format(CacheKeyManager.VIDEO_DETAIL,videoId);</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            Object cacheObject = baseCache.getOneHourCache().get( videoCacheKey, ()-&gt;&#123;</span><br><span class="line">                <span class="comment">// 需要使用mybaits关联复杂查询</span></span><br><span class="line">                Video video = videoMapper.findDetailById(videoId);</span><br><span class="line">                <span class="keyword">return</span> video;</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">if</span>(cacheObject <span class="keyword">instanceof</span> Video)&#123;</span><br><span class="line">                Video video = (Video)cacheObject;</span><br><span class="line">                <span class="keyword">return</span> video;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="压力测试工具Jmeter5-X快速入门实战"><a href="#压力测试工具Jmeter5-X快速入门实战" class="headerlink" title="压力测试工具Jmeter5.X快速入门实战"></a>压力测试工具Jmeter5.X快速入门实战</h1><h2 id="接口压测和常用压力测试工具对比"><a href="#接口压测和常用压力测试工具对比" class="headerlink" title="接口压测和常用压力测试工具对比"></a>接口压测和常用压力测试工具对比</h2><ul>
<li><p>LoadRunner</p>
<ul>
<li>性能稳定，压测结果及细粒度大，可以自定义脚本进行压测，但是太过于重大，功能比较繁多</li>
</ul>
</li>
<li><p>Apache AB(单接口压测最方便)</p>
<ul>
<li>模拟多线程并发请求,ab命令对发出负载的计算机要求很低，既不会占用很多CPU，也不会占用太多的内存，但却会给目标服务器造成巨大的负载, 简单DDOS攻击等</li>
</ul>
</li>
<li><p>Webbench</p>
<ul>
<li>webbench首先fork出多个子进程，每个子进程都循环做web访问测试。子进程把访问的结果通过pipe告诉父进程，父进程做最终的统计结果。</li>
</ul>
</li>
<li><p>Jmeter</p>
<ul>
<li>开源免费，功能强大，在互联网公司普遍使用</li>
<li>压测不同的协议和应用 <ul>
<li>Web - HTTP, HTTPS (Java, NodeJS, PHP, ASP.NET, …) </li>
<li>SOAP / REST Webservices </li>
<li>FTP </li>
<li>Database via JDBC </li>
<li>LDAP 轻量目录访问协议</li>
<li>Message-oriented middleware (MOM) via JMS </li>
<li>Mail - SMTP(S), POP3(S) and IMAP(S) </li>
<li>TCP等等</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="压测工具本地快速安装Jmeter5-x"><a href="#压测工具本地快速安装Jmeter5-x" class="headerlink" title="压测工具本地快速安装Jmeter5.x"></a>压测工具本地快速安装Jmeter5.x</h2><ul>
<li>需要安装JDK8 以上<ul>
<li>建议安装JDK环境，虽然JRE也可以，但是压测https需要JDK里面的 keytool工具</li>
</ul>
</li>
<li>快速下载 <a href="https://jmeter.apache.org/download_jmeter.cgi" target="_blank" rel="noopener">https://jmeter.apache.org/download_jmeter.cgi</a></li>
<li>文档地址：<a href="http://jmeter.apache.org/usermanual/get-started.html" target="_blank" rel="noopener">http://jmeter.apache.org/usermanual/get-started.html</a></li>
</ul>
<h2 id="Jmeter5-x目录文件讲解和汉化操作"><a href="#Jmeter5-x目录文件讲解和汉化操作" class="headerlink" title="Jmeter5.x目录文件讲解和汉化操作"></a>Jmeter5.x目录文件讲解和汉化操作</h2><p>目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">bin:核心可执行文件，包含配置</span><br><span class="line">        jmeter.bat: windows启动文件(window系统一定要配置显示文件拓展名)</span><br><span class="line">        jmeter: mac或者linux启动文件</span><br><span class="line">        jmeter-server：mac或者Liunx分布式压测使用的启动文件</span><br><span class="line">        jmeter-server.bat：window分布式压测使用的启动文件</span><br><span class="line">        jmeter.properties: 核心配置文件   </span><br><span class="line">extras：插件拓展的包</span><br><span class="line"></span><br><span class="line">lib:核心的依赖包</span><br></pre></td></tr></table></figure>

<p>Jmeter语言版本中英文切换</p>
<ul>
<li>控制台修改 menu -&gt; options -&gt; choose language</li>
</ul>
<p>配置文件修改</p>
<ul>
<li><p>bin目录 -&gt; jmeter.properties</p>
</li>
<li><p>默认 #language=en</p>
</li>
<li><p>改为 language=zh_CN</p>
<h2 id="Jmeter5-X基础功能组件介绍线程组和Sampler"><a href="#Jmeter5-X基础功能组件介绍线程组和Sampler" class="headerlink" title="Jmeter5.X基础功能组件介绍线程组和Sampler"></a>Jmeter5.X基础功能组件介绍线程组和Sampler</h2></li>
</ul>
<p>添加-&gt;threads-&gt;线程组（控制总体并发）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">线程数：虚拟用户数。一个虚拟用户占用一个进程或线程</span><br><span class="line"></span><br><span class="line">准备时长（Ramp-Up Period(in seconds)）：全部线程启动的时长，比如100个线程，20秒，则表示20秒内 100个线程都要启动完成，每秒启动5个线程</span><br><span class="line"></span><br><span class="line">循环次数：每个线程发送的次数，假如值为5，100个线程，则会发送500次请求，可以勾选永远循环</span><br></pre></td></tr></table></figure>

<p>线程组-&gt;添加-&gt; Sampler(采样器) -&gt; Http （一个线程组下面可以增加几个Sampler）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">名称：采样器名称</span><br><span class="line">注释：对这个采样器的描述</span><br><span class="line">web服务器：</span><br><span class="line">  默认协议是http</span><br><span class="line">  默认端口是80</span><br><span class="line">  服务器名称或IP ：请求的目标服务器名称或IP地址</span><br><span class="line"></span><br><span class="line">路径：服务器URL</span><br></pre></td></tr></table></figure>

<p>查看测试结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">线程组-&gt;添加-&gt;监听器-&gt;察看结果树</span><br></pre></td></tr></table></figure>

<h2 id="Jmeter5-x实战之压测结果聚合报告分析"><a href="#Jmeter5-x实战之压测结果聚合报告分析" class="headerlink" title="Jmeter5.x实战之压测结果聚合报告分析"></a>Jmeter5.x实战之压测结果聚合报告分析</h2><p>新增聚合报告：线程组-&gt;添加-&gt;监听器-&gt;聚合报告（Aggregate Report）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">lable: sampler的名称</span><br><span class="line">Samples: 一共发出去多少请求,例如10个用户，循环10次，则是 100</span><br><span class="line">Average: 平均响应时间</span><br><span class="line">Median: 中位数，也就是 50％ 用户的响应时间</span><br><span class="line"></span><br><span class="line">90% Line : 90％ 用户的响应不会超过该时间 （90% of the samples took no more than this time.     The remaining samples at least as long as this）</span><br><span class="line">95% Line : 95％ 用户的响应不会超过该时间</span><br><span class="line">99% Line : 99％ 用户的响应不会超过该时间</span><br><span class="line">min : 最小响应时间</span><br><span class="line">max : 最大响应时间</span><br><span class="line"></span><br><span class="line">Error%：错误的请求的数量&#x2F;请求的总数</span><br><span class="line">Throughput： 吞吐量——默认情况下表示每秒完成的请求数（Request per Second) 可类比为qps、tps</span><br><span class="line">KB&#x2F;Sec: 每秒接收数据量</span><br></pre></td></tr></table></figure>

<h1 id="实战接口压力测试，明白优化前后的QPS并发差距和跨域配置"><a href="#实战接口压力测试，明白优化前后的QPS并发差距和跨域配置" class="headerlink" title="实战接口压力测试，明白优化前后的QPS并发差距和跨域配置"></a>实战接口压力测试，明白优化前后的QPS并发差距和跨域配置</h1><h2 id="开启Guava缓存压测热点数据接口"><a href="#开启Guava缓存压测热点数据接口" class="headerlink" title="开启Guava缓存压测热点数据接口"></a>开启Guava缓存压测热点数据接口</h2><p>视频轮播图接口 Throughput: 14000</p>
<p><img src="https://file.xdclass.net/note/2020/%E6%96%B0%E7%89%88ssm/%E5%9B%BE%E7%89%87/image-20200422223934690.png" alt="image-20200422223934690"></p>
<p><img src="https://file.xdclass.net/note/2020/%E6%96%B0%E7%89%88ssm/%E5%9B%BE%E7%89%87/image-20200422223910158.png" alt="image-20200422223910158"></p>
<p>注意：接口的性能影响因素很多：机器的配置如CPU、内存、当前负载情况等，还有网络带宽因素影响，只能尽量减少影响因素</p>
<h2 id="取消Guava缓存压测热点数据接口和前后对比"><a href="#取消Guava缓存压测热点数据接口和前后对比" class="headerlink" title="取消Guava缓存压测热点数据接口和前后对比"></a>取消Guava缓存压测热点数据接口和前后对比</h2><p><strong>不启用缓存 压测热点数据接口</strong></p>
<ul>
<li>视频轮播图接口 Throughput : 2700</li>
</ul>
<p><img src="https://file.xdclass.net/note/2020/%E6%96%B0%E7%89%88ssm/%E5%9B%BE%E7%89%87/image-20200422224833120.png" alt="image-20200422224833120"></p>
<p><img src="https://file.xdclass.net/note/2020/%E6%96%B0%E7%89%88ssm/%E5%9B%BE%E7%89%87/image-20200422224740181.png" alt="image-20200422224740181"></p>
<h2 id="SpringBoot2-X开启跨域配置"><a href="#SpringBoot2-X开启跨域配置" class="headerlink" title="SpringBoot2.X开启跨域配置"></a>SpringBoot2.X开启跨域配置</h2><p><strong>什么是浏览器跨域和springboot怎么解决</strong></p>
<p>跨域：浏览器同源策略 1995年，同源政策由 Netscape 公司引入浏览器。目前，所有浏览器都实行这个政策。 最初，它的含义是指，A网页设置的 Cookie，B网页不能打开，除非这两个网页”同源”。所谓”同源”指的是”三个相同”</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">协议相同  http https</span><br><span class="line">域名相同  www.xdclass.net</span><br><span class="line">端口相同  80  81</span><br><span class="line"></span><br><span class="line">一句话：浏览器从一个域名的网页去请求另一个域名的资源时，域名、端口、协议任一不同，都是跨域</span><br><span class="line"></span><br><span class="line">浏览器控制台跨域提示：</span><br><span class="line">No &#39;Access-Control-Allow-Origin&#39; header is present on the requested resource. Origin &#39;null&#39; is therefore not allowed access.</span><br></pre></td></tr></table></figure>

<ul>
<li>解决方法</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1）JSONP</span><br><span class="line">    2）Http响应头配置允许跨域</span><br><span class="line">            nginx层配置 https:&#x2F;&#x2F;www.cnblogs.com&#x2F;hawk-whu&#x2F;p&#x2F;6725699.html</span><br><span class="line">    3）程序代码中处理 SpringBoot 通过拦截器配置</span><br><span class="line">    </span><br><span class="line">     &#x2F;&#x2F;表示接受任意域名的请求,也可以指定域名</span><br><span class="line">    response.setHeader(&quot;Access-Control-Allow-Origin&quot;, request.getHeader(&quot;origin&quot;));</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F;该字段可选，是个布尔值，表示是否可以携带cookie</span><br><span class="line">    response.setHeader(&quot;Access-Control-Allow-Credentials&quot;, &quot;true&quot;);</span><br><span class="line">    </span><br><span class="line">    response.setHeader(&quot;Access-Control-Allow-Methods&quot;, &quot;GET, HEAD, POST, PUT, PATCH, DELETE, OPTIONS&quot;);</span><br><span class="line">    </span><br><span class="line">    response.setHeader(&quot;Access-Control-Allow-Headers&quot;, &quot;*&quot;);</span><br></pre></td></tr></table></figure>

<ul>
<li>options请求，这个需要注意</li>
<li>注意点: 假如接口报错，则跨域配置可能不生效（报错建议断点调试，排除异常错误）</li>
</ul>
<h1 id="互联网公司前端开发环境搭建之Node和Npm介绍"><a href="#互联网公司前端开发环境搭建之Node和Npm介绍" class="headerlink" title="互联网公司前端开发环境搭建之Node和Npm介绍"></a>互联网公司前端开发环境搭建之Node和Npm介绍</h1><p><strong>搭建node环境和npm安装</strong></p>
<ul>
<li><p>什么是NodeJS: Node.js 就是运行在服务端的 JavaScript</p>
</li>
<li><p>什么是npm: nodejs的包管理工具，可以下载使用公共仓库的包，类似maven 包安装分为本地安装（local）、全局安装（global）两种</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install express          # 本地安装express</span><br><span class="line">npm install express -g       # 全局安装express</span><br><span class="line">npm list -g                 #查看所有全局安装的模块</span><br></pre></td></tr></table></figure>
</li>
<li><p>Node安装包：<a href="http://nodejs.cn/download/" target="_blank" rel="noopener">http://nodejs.cn/download/</a></p>
</li>
<li><p>新版的nodejs已经集成了npm，所以npm也一并安装好</p>
</li>
<li><p>苹果系统Mac安装node和npm： brew install nodejs brew install npm</p>
</li>
<li><p>Window安装node和npm 下载后一步步安装就行 参考文档：<a href="https://www.jianshu.com/p/03a76b2e7e00" target="_blank" rel="noopener">https://www.jianshu.com/p/03a76b2e7e00</a></p>
</li>
<li><p>验证是否成功</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node -v</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm -v</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="切换npm镜像源为淘宝npm镜像"><a href="#切换npm镜像源为淘宝npm镜像" class="headerlink" title="切换npm镜像源为淘宝npm镜像"></a>切换npm镜像源为淘宝npm镜像</h2><p><strong>修改npm镜像源为国内</strong></p>
<ul>
<li>类似maven，从国外下载包很慢，所以就有人改成国内的maven仓库就会快很多，或者搭建自己本地的私服</li>
<li>国内直接使用 npm 的官方镜像是非常慢的，推荐使用淘宝 NPM 镜像。</li>
</ul>
<p>淘宝 NPM 镜像是一个完整 npmjs.org 镜像，可以用此代替官方版本。</p>
<p>使用淘宝定制的 cnpm 命令行工具代替默认的 npm:(需要管理员权限)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g cnpm --registry&#x3D;https:&#x2F;&#x2F;registry.npm.taobao.org</span><br></pre></td></tr></table></figure>

<p>这样就可以使用 cnpm 命令来安装模块了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm install [name]</span><br></pre></td></tr></table></figure>

<p>更多信息可以查阅：<a href="https://developer.aliyun.com/mirror/NPM" target="_blank" rel="noopener">https://developer.aliyun.com/mirror/NPM</a></p>
<h1 id="新版Vue-脚手架Vue-Cli-4-3-安装"><a href="#新版Vue-脚手架Vue-Cli-4-3-安装" class="headerlink" title="新版Vue + 脚手架Vue-Cli 4.3 安装"></a>新版Vue + 脚手架Vue-Cli 4.3 安装</h1><p><strong>本地搭建Vue 、CLI、Cube-UI相关框架</strong></p>
<ul>
<li><p>什么是VUE 一套用于构建用户界面的渐进式框架。与其它大型框架不同的是，Vue 被设计为可以自底向上逐层应用。Vue 的核心库只关注视图层，不仅易于上手，还便于与第三方库或既有项目整合. 文档：<a href="https://cn.vuejs.org/" target="_blank" rel="noopener">https://cn.vuejs.org/</a></p>
<p>安装新版Vue (直接使用 cli)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install vue (可以不用)</span><br></pre></td></tr></table></figure>
</li>
<li><p>什么是VUE-CLI Vue 提供了一个官方的 CLI，为单页面应用 (SPA) 快速搭建繁杂的脚手架</p>
<p>安装 新版vue-cli</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cnpm install -g @vue&#x2F;cli</span><br><span class="line">cnpm install -g @vue&#x2F;cli-init</span><br></pre></td></tr></table></figure>

<p>使用vue-cli创建项目（测试项目，验证vue环境）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vue create my-project</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>前端构建项目就到这里吧，太繁琐省略不写。。。</p>
<h1 id="互联网公司-前端-后端项目云服务器生产环境部署核心知识"><a href="#互联网公司-前端-后端项目云服务器生产环境部署核心知识" class="headerlink" title="互联网公司 前端-后端项目云服务器生产环境部署核心知识"></a>互联网公司 前端-后端项目云服务器生产环境部署核心知识</h1><h2 id="应用部署到可以公网访问需要的知识"><a href="#应用部署到可以公网访问需要的知识" class="headerlink" title="应用部署到可以公网访问需要的知识"></a>应用部署到可以公网访问需要的知识</h2><ul>
<li>一个http请求基本流程<ul>
<li>客户端通过发起域名资源请求 -&gt; DNS解析获得IP -&gt; 寻找服务器获得资源</li>
</ul>
</li>
<li>域名和ip的关系，DNS作用<ul>
<li>DNS：Domain Name Server 域名服务器 域名虽然便于人们记忆，但网络中的计算机之间只能互相认识IP地址，它们之间的转换工作称为域名解析，域名解析需要由专门的域名解析服务器来完成，DNS 就是进行域名解析的服务器</li>
</ul>
</li>
<li>什么是cname和a记录<ul>
<li>a记录<ul>
<li>用户可以在此设置域名并指向到自己的目标主机地址上，从而实现通过域名找到服务器（也叫ip指向域名配置）</li>
</ul>
</li>
<li>cname<ul>
<li>别名指向，可以为一个主机设置别名。比如设置open1024.com，用来指向一个主机 xdclass.net 那么以后就可以用open1024.com来代替访问 xdclass.net 了</li>
<li><a href="http://www.xdclass.net/" target="_blank" rel="noopener">http://www.xdclass.net</a> –&gt; xdclass.net</li>
</ul>
</li>
</ul>
</li>
<li>购买服务器，阿里云，腾讯云，亚马逊云aws</li>
<li>购买域名，备案<ul>
<li>阿里云 备案地址：<a href="https://beian.aliyun.com/" target="_blank" rel="noopener">https://beian.aliyun.com/</a></li>
</ul>
</li>
<li>安装项目依赖的基本环境，比如java、nginx等软件(看项目)</li>
<li>配置域名解析到服务器</li>
<li>备注：后端项目一般部署Linux服务器，前端静态资源可以部署Linux也可以部署在CDN上</li>
</ul>
<h2 id="云服务器介绍和阿里云服务器ECS服务器选购"><a href="#云服务器介绍和阿里云服务器ECS服务器选购" class="headerlink" title="云服务器介绍和阿里云服务器ECS服务器选购"></a>云服务器介绍和阿里云服务器ECS服务器选购</h2><ul>
<li><p>演示本地例子，部署阿里云</p>
</li>
<li><p>阿里云、腾讯云、亚马逊云 阿里云：<a href="https://www.aliyun.com/" target="_blank" rel="noopener">https://www.aliyun.com/</a> 腾讯云：<a href="https://cloud.tencent.com/" target="_blank" rel="noopener">https://cloud.tencent.com/</a> 亚马逊云：<a href="https://aws.amazon.com/" target="_blank" rel="noopener">https://aws.amazon.com/</a></p>
</li>
<li><p>阿里云新用户地址（如果地址失效，联系我或者客服即可） <a href="https://www.aliyun.com/minisite/goods?userCode=r5saexap&amp;share_source=copy_link" target="_blank" rel="noopener">https://www.aliyun.com/minisite/goods?userCode=r5saexap&amp;share_source=copy_link</a></p>
</li>
</ul>
<h2 id="阿里云服务器远程登录和常用工具"><a href="#阿里云服务器远程登录和常用工具" class="headerlink" title="阿里云服务器远程登录和常用工具"></a>阿里云服务器远程登录和常用工具</h2><ul>
<li><p>备注：(服务器、域名等使用你们自己购买的哈，上面有提供低价购买链接，失效找我)</p>
<ul>
<li>阿里云新用户地址 <a href="https://www.aliyun.com/minisite/goods?userCode=r5saexap&amp;share_source=copy_link" target="_blank" rel="noopener">https://www.aliyun.com/minisite/goods?userCode=r5saexap&amp;share_source=copy_link</a></li>
</ul>
</li>
<li><p>控制台修改阿里云远程连接密码</p>
</li>
<li><p>windows工具 putty，xshell, security 参考资料： <a href="https://jingyan.baidu.com/article/e75057f210c6dcebc91a89dd.html" target="_blank" rel="noopener">https://jingyan.baidu.com/article/e75057f210c6dcebc91a89dd.html</a> <a href="https://www.jb51.net/softjc/88235.html" target="_blank" rel="noopener">https://www.jb51.net/softjc/88235.html</a></p>
</li>
<li><p>苹果系统MAC ： 通过终端登录</p>
<ul>
<li>ssh root@ip 回车后输入密码</li>
<li>ssh <a href="mailto:root@112.74.55.160">root@112.74.55.160</a></li>
</ul>
</li>
<li><p>linux图形操作工具（用于远程连接上传文件）</p>
<ul>
<li>mac: filezilla<ul>
<li>s<a href="ftp://112.74.55.160">ftp://112.74.55.160</a></li>
</ul>
</li>
<li>windows: winscp</li>
<li>资料：<a href="https://jingyan.baidu.com/article/ed2a5d1f346fd409f6be179a.html" target="_blank" rel="noopener">https://jingyan.baidu.com/article/ed2a5d1f346fd409f6be179a.html</a></li>
</ul>
</li>
<li><p>尝试自己通过百度进行找文档， 安装mysql jdk nginx maven git redis</p>
</li>
</ul>
<h1 id="生产环境Linux-CentOS云服务器常见相关软件安装"><a href="#生产环境Linux-CentOS云服务器常见相关软件安装" class="headerlink" title="生产环境Linux CentOS云服务器常见相关软件安装"></a>生产环境Linux CentOS云服务器常见相关软件安装</h1><h2 id="阿里云Linux服务器Centos7-安装JDK8环境"><a href="#阿里云Linux服务器Centos7-安装JDK8环境" class="headerlink" title="阿里云Linux服务器Centos7 安装JDK8环境"></a>阿里云Linux服务器Centos7 安装JDK8环境</h2><p><strong>Linux云服务器安装JDK1.8</strong></p>
<ul>
<li><p>官方地址：<a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html" target="_blank" rel="noopener">http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html</a></p>
</li>
<li><p>本地上传JDK1.8到服务器（课程提供安装包，对应章集的资料里面）</p>
</li>
<li><p>配置全局环境变量</p>
<ul>
<li><p>解压：tar -zxvf jdk-8u171-linux-x64.tar.gz</p>
</li>
<li><p>重命名</p>
</li>
<li><p>vim /etc/profile</p>
</li>
<li><p>配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">JAVA_HOME&#x3D;&#x2F;usr&#x2F;local&#x2F;software&#x2F;jdk1.8</span><br><span class="line">CLASSPATH&#x3D;$JAVA_HOME&#x2F;lib&#x2F;</span><br><span class="line">PATH&#x3D;$PATH:$JAVA_HOME&#x2F;bin</span><br><span class="line">export PATH JAVA_HOME CLASSPATH</span><br></pre></td></tr></table></figure>
</li>
<li><p>环境变量立刻生效</p>
<ul>
<li>source /etc/profile</li>
</ul>
</li>
</ul>
</li>
<li><p>查看安装情况 java -version</p>
</li>
</ul>
<h2 id="生产环境Linux服务器上Nginx介绍和安装"><a href="#生产环境Linux服务器上Nginx介绍和安装" class="headerlink" title="生产环境Linux服务器上Nginx介绍和安装"></a>生产环境Linux服务器上Nginx介绍和安装</h2><ul>
<li><p>什么是Nginx服务器</p>
<ul>
<li>一个高性能的HTTP和反向代理web服务器</li>
</ul>
</li>
<li><p>安装依赖</p>
<ul>
<li>yum -y install gcc zlib zlib-devel pcre-devel openssl openssl-devel</li>
</ul>
</li>
<li><p>创建一个文件夹，上传本地提供的nginx包</p>
<ul>
<li><p>tar -zxvf nginx-1.13.7.tar.gz </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;执行命令</span><br><span class="line">.&#x2F;configure</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>默认安装路径</p>
</li>
<li><p>/usr/local/nginx</p>
</li>
<li><p>访问配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin   </span><br><span class="line">.&#x2F;nginx</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>防火墙开放端口，阿里云网络安全组配置80端口</p>
<h2 id="生产环境Linux服务器上Mysql安装和导入数据"><a href="#生产环境Linux服务器上Mysql安装和导入数据" class="headerlink" title="生产环境Linux服务器上Mysql安装和导入数据"></a>生产环境Linux服务器上Mysql安装和导入数据</h2><ul>
<li>安装Mysql 5.7 （注意，Mysql和系统务必保持一致，不然存在不一致）</li>
<li>开启mysql远程连接（如果是准线上，建议不要开启远程连接）</li>
<li>开放阿里云网络安全组配置 3306 端口</li>
<li>导入测试数据到Mysql</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">#下载mysql的Yum仓库</span><br><span class="line">wget -i -c http:&#x2F;&#x2F;dev.mysql.com&#x2F;get&#x2F;mysql57-community-release-el7-10.noarch.rpm</span><br><span class="line"></span><br><span class="line">yum -y install mysql57-community-release-el7-10.noarch.rpm</span><br><span class="line"></span><br><span class="line">#安装 mysql服务</span><br><span class="line">yum -y install mysql-community-server</span><br><span class="line"></span><br><span class="line">#启动数据库服务， systemctl 该命令可用于查看系统状态和管理系统及服务，centos7上开始使用</span><br><span class="line">systemctl start  mysqld.service</span><br><span class="line"></span><br><span class="line">#查看状态</span><br><span class="line">systemctl status mysqld.service</span><br><span class="line"></span><br><span class="line">#在日志文件中查看初始密码</span><br><span class="line">grep &quot;password&quot; &#x2F;var&#x2F;log&#x2F;mysqld.log</span><br><span class="line"></span><br><span class="line">#进入修改Mysql密码</span><br><span class="line"></span><br><span class="line">mysql -uroot -p</span><br><span class="line"></span><br><span class="line">#新密码设置必须由大小写字母、数字和特殊符号组成</span><br><span class="line">ALTER USER &#39;root&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;Xdclass.net168&#39;;</span><br><span class="line"></span><br><span class="line">#开启mysql的远程访问， %是指全部</span><br><span class="line">grant all privileges on *.* to &#39;root&#39;@&#39;%&#39; identified by &#39;Xdclass.net168&#39; with grant option;</span><br><span class="line"></span><br><span class="line">#刷新权限</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure>

<h1 id="前端-后端集群部署线上Linux云服务器"><a href="#前端-后端集群部署线上Linux云服务器" class="headerlink" title="前端-后端集群部署线上Linux云服务器"></a>前端-后端集群部署线上Linux云服务器</h1><h2 id="前后端项目总体部署架构和阿里云域名解析A记录配置"><a href="#前后端项目总体部署架构和阿里云域名解析A记录配置" class="headerlink" title="前后端项目总体部署架构和阿里云域名解析A记录配置"></a>前后端项目总体部署架构和阿里云域名解析A记录配置</h2><p><strong>前端、后端项目总体部署架构和A记录配置</strong></p>
<ul>
<li><p>后端接口地址 api.16web.net</p>
<ul>
<li>阿里云机器：112.74.55.160</li>
</ul>
</li>
<li><p>前端接口地址 web.16web.net</p>
<ul>
<li>阿里云机器：112.74.55.160</li>
</ul>
</li>
<li><p>前端部署nginx上</p>
<ul>
<li>后端部署多个节点，同过nginx反向代理做集群</li>
</ul>
</li>
</ul>
<h2 id="后端Java-API项目阿里云服务器部署安装"><a href="#后端Java-API项目阿里云服务器部署安装" class="headerlink" title="后端Java API项目阿里云服务器部署安装"></a>后端Java API项目阿里云服务器部署安装</h2><p><strong>SpringBoot项目部署阿里云服务器</strong></p>
<ul>
<li><p>打包上传</p>
<ul>
<li>打包命令，各个系统通用，只要按照maven</li>
<li>mvn install -Dmaven.test.skip=true<ul>
<li>修改配置文件：数据库连接，账户密码</li>
</ul>
</li>
</ul>
</li>
<li><p>启动应用指定外部文件</p>
</li>
<li><p>nohup java -jar -Dspring.config.location=./application.properties online_xdclass-0.0.1-SNAPSHOT.jar &amp;</p>
</li>
<li><p>测试访问接口是否畅通</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">curl 127.0.0.1:8089&#x2F;api&#x2F;v1&#x2F;pub&#x2F;video&#x2F;list_banner</span><br><span class="line"></span><br><span class="line">112.74.55.160:8089&#x2F;api&#x2F;v1&#x2F;pub&#x2F;video&#x2F;list_banner</span><br><span class="line"></span><br><span class="line">112.74.55.160:8088&#x2F;api&#x2F;v1&#x2F;pub&#x2F;video&#x2F;list_banner</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="前后端分离-前端项目打包上传阿里云服务器"><a href="#前后端分离-前端项目打包上传阿里云服务器" class="headerlink" title="前后端分离-前端项目打包上传阿里云服务器"></a>前后端分离-前端项目打包上传阿里云服务器</h2><ul>
<li><p>本地vue项目进行打包</p>
<ul>
<li>cnpm run build</li>
</ul>
</li>
<li><p>上传dist目录到Centos系统某个目录</p>
</li>
</ul>
<h2 id="线上部署之前端项目接入Nginx代理服务器"><a href="#线上部署之前端项目接入Nginx代理服务器" class="headerlink" title="线上部署之前端项目接入Nginx代理服务器"></a>线上部署之前端项目接入Nginx代理服务器</h2><ul>
<li><p>后端接口地址 api.16web.net</p>
<ul>
<li>阿里云机器：112.74.55.160</li>
</ul>
</li>
<li><p>前端接口地址 web.16web.net</p>
<ul>
<li>阿里云机器：112.74.55.160</li>
</ul>
</li>
<li><p>注意：配置A记录后不会立刻生效，且如果二次修改存在本地dns缓存，应该清除本地dns缓存，才可以访问</p>
</li>
<li><p>前端配置Nginx</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location &#x2F; &#123;</span><br><span class="line">        root   &#x2F;usr&#x2F;local&#x2F;software&#x2F;front_end&#x2F;dist;</span><br><span class="line">        index  index.html index.htm;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>重启nginx<ul>
<li>./nginx -s reload</li>
</ul>
</li>
</ul>
<h2 id="高可用处理之后端API多节点集群部署"><a href="#高可用处理之后端API多节点集群部署" class="headerlink" title="高可用处理之后端API多节点集群部署"></a>高可用处理之后端API多节点集群部署</h2><p><strong>springboot应用多节点部署和配置nginx访问</strong></p>
<ul>
<li>多节点启动 节点1：112.74.55.160:8088 节点2：112.74.55.160:8089</li>
<li>配置nginx集群访问</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">upstream lbs &#123;</span><br><span class="line">   server 112.74.55.160:8089;</span><br><span class="line">   server 112.74.55.160:8088;</span><br><span class="line">&#125;</span><br><span class="line"> location &#x2F;api&#x2F; &#123;</span><br><span class="line">    proxy_pass http:&#x2F;&#x2F;lbs;</span><br><span class="line">    proxy_redirect default;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>重启nginx命令<ul>
<li>./nginx -s reload</li>
</ul>
</li>
</ul>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Kaluna</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://blog.kaluna.top/2021/04/21/%E5%B0%8F%E6%BB%B4%E8%AF%BE%E5%A0%82%E5%9C%A8%E7%BA%BF%E6%95%99%E8%82%B2%E7%B3%BB%E7%BB%9F/">https://blog.kaluna.top/2021/04/21/%E5%B0%8F%E6%BB%B4%E8%AF%BE%E5%A0%82%E5%9C%A8%E7%BA%BF%E6%95%99%E8%82%B2%E7%B3%BB%E7%BB%9F/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%B0%8F%E6%BB%B4%E8%AF%BE%E5%A0%82/">小滴课堂</a></div><div class="post-qr-code"><div class="post-qr-code-item"><img class="post-qr-code__img" src="https://i.loli.net/2021/04/20/FbPtxEHeSDgCXBy.jpg"><div class="post-qr-code__desc">添加我为好友</div></div></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2021/04/22/Jenkins%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%20Git%20Gitlab%20Sonar/"><i class="fa fa-chevron-left">  </i><span>Jenkins持续集成 Git Gitlab Sonar</span></a></div><div class="next-post pull-right"><a href="/2021/04/21/%E5%B0%8F%E6%BB%B4%E8%AF%BE%E5%A0%82%E4%B8%80/"><span>小滴课堂一</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="disqus_thread"></div><script>var unused = null;
var disqus_config = function () {
  this.page.url = 'https://blog.kaluna.top/2021/04/21/%E5%B0%8F%E6%BB%B4%E8%AF%BE%E5%A0%82%E5%9C%A8%E7%BA%BF%E6%95%99%E8%82%B2%E7%B3%BB%E7%BB%9F/';
  this.page.identifier = '2021/04/21/小滴课堂在线教育系统/';
  this.page.title = '小滴课堂在线教育系统';
}
var d = document, s = d.createElement('script');
s.src = "https://" + 'shortname-pzy8cndfkq' +".disqus.com/embed.js";
s.setAttribute('data-timestamp', '' + +new Date());
(d.head || d.body).appendChild(s);</script><script id="dsq-count-scr" src="https://shortname-pzy8cndfkq.disqus.com/count.js" async></script></div></div><footer class="footer-bg" style="background-image: url(https://gitee.com/YuerryHUAHUA/figure/raw/master/img/20210521080208.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2021 By Kaluna</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="icp"><a><span></span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.7.0"></script><script src="/js/fancybox.js?version=1.7.0"></script><script src="/js/sidebar.js?version=1.7.0"></script><script src="/js/copy.js?version=1.7.0"></script><script src="/js/fireworks.js?version=1.7.0"></script><script src="/js/transition.js?version=1.7.0"></script><script src="/js/scroll.js?version=1.7.0"></script><script src="/js/head.js?version=1.7.0"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>