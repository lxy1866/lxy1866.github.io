<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="小滴课堂三"><meta name="keywords" content="spring framework"><meta name="author" content="Kaluna"><meta name="copyright" content="Kaluna"><title>小滴课堂三 | 嘿，不停转的轮子</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="嘿，不停转的轮子" type="application/atom+xml">
</head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#SSM之Spring-Framework5-X快速入门"><span class="toc-number">1.</span> <span class="toc-text">SSM之Spring Framework5.X快速入门</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#IDEA-Maven-Spring5-X项目创建"><span class="toc-number">1.1.</span> <span class="toc-text">IDEA+Maven+Spring5.X项目创建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ApplicationContext-xml配置文件和Helloworld例子解读"><span class="toc-number">1.2.</span> <span class="toc-text">ApplicationContext.xml配置文件和Helloworld例子解读</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringFramework5-X核心之-IOC-容器"><span class="toc-number">1.3.</span> <span class="toc-text">SpringFramework5.X核心之 IOC 容器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#spring的IOC设计思想"><span class="toc-number">1.3.1.</span> <span class="toc-text">spring的IOC设计思想</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringFramework5-X核心之-DI依赖注入"><span class="toc-number">1.4.</span> <span class="toc-text">SpringFramework5.X核心之 DI依赖注入</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Spring5-X-bean-的作用域和注入"><span class="toc-number">2.</span> <span class="toc-text">Spring5.X bean 的作用域和注入</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#spring的bean-属性scope作用域"><span class="toc-number">2.1.</span> <span class="toc-text">spring的bean 属性scope作用域</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实战Spring5-X常见的注入方式"><span class="toc-number">2.2.</span> <span class="toc-text">实战Spring5.X常见的注入方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实战Spring5-X-List-Map类型的注入"><span class="toc-number">2.3.</span> <span class="toc-text">实战Spring5.X List-Map类型的注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#玩转spring-ioc容器Bean之间的依赖和继承"><span class="toc-number">2.4.</span> <span class="toc-text">玩转spring ioc容器Bean之间的依赖和继承</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#玩转Spring5-X-bean-的生命周期和二次处理"><span class="toc-number">3.</span> <span class="toc-text">玩转Spring5.X bean 的生命周期和二次处理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#spring-ioc容器Bean的生命周期的init和destroy方法"><span class="toc-number">3.1.</span> <span class="toc-text">spring ioc容器Bean的生命周期的init和destroy方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bean的二次加工-Spring5-x后置处理器-BeanPostProcessor"><span class="toc-number">3.2.</span> <span class="toc-text">bean的二次加工-Spring5.x后置处理器 BeanPostProcessor</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring5-X-bean自动装配Autowire-属性"><span class="toc-number">3.3.</span> <span class="toc-text">Spring5.X bean自动装配Autowire 属性</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#玩转Spring5-X-面向切面编程-AOP"><span class="toc-number">4.</span> <span class="toc-text">玩转Spring5.X 面向切面编程 AOP</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#什么是AOP面向切面编程"><span class="toc-number">4.1.</span> <span class="toc-text">什么是AOP面向切面编程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AOP面向切面编程相关核心概念"><span class="toc-number">4.2.</span> <span class="toc-text">AOP面向切面编程相关核心概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AOP里面的通知Advice类型"><span class="toc-number">4.3.</span> <span class="toc-text">AOP里面的通知Advice类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring5-X-AOP切入点表达式"><span class="toc-number">4.4.</span> <span class="toc-text">Spring5.X AOP切入点表达式</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Spring-AOP里面的代理知识"><span class="toc-number">5.</span> <span class="toc-text">Spring AOP里面的代理知识</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#静态代理和动态代理"><span class="toc-number">5.1.</span> <span class="toc-text">静态代理和动态代理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#代理模式实战之静态代理"><span class="toc-number">5.2.</span> <span class="toc-text">代理模式实战之静态代理</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#AOP的实现策略之JDK动态代理"><span class="toc-number">6.</span> <span class="toc-text">AOP的实现策略之JDK动态代理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#AOP的实现策略之CGLib动态代理"><span class="toc-number">6.1.</span> <span class="toc-text">AOP的实现策略之CGLib动态代理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CGLib动态代理和JDK动态代理总结"><span class="toc-number">6.2.</span> <span class="toc-text">CGLib动态代理和JDK动态代理总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#面向切面编程-Spring-AOP-实战-配置"><span class="toc-number">7.</span> <span class="toc-text">面向切面编程 Spring AOP 实战 配置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#基于Spring的AOP快速实现通用日志打印"><span class="toc-number">7.1.</span> <span class="toc-text">基于Spring的AOP快速实现通用日志打印</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#玩转Spring5-X-Xml配置转换到注解配置"><span class="toc-number">8.</span> <span class="toc-text">玩转Spring5.X Xml配置转换到注解配置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#spring的使用注解配置项目"><span class="toc-number">8.1.</span> <span class="toc-text">spring的使用注解配置项目</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实战Spring5-X的常用注解和xml对比"><span class="toc-number">8.2.</span> <span class="toc-text">实战Spring5.X的常用注解和xml对比</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#玩转Spring5-X-Xml配置转换到注解配置进阶"><span class="toc-number">9.</span> <span class="toc-text">玩转Spring5.X Xml配置转换到注解配置进阶</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#spring的-Configuration和-Bean注解定义第三方bean"><span class="toc-number">9.1.</span> <span class="toc-text">spring的@Configuration和@Bean注解定义第三方bean</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring的自动映射配置文件PropertySource注解"><span class="toc-number">9.2.</span> <span class="toc-text">Spring的自动映射配置文件PropertySource注解</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#案例实战之基于Spring注解配置AOP面向切面编程"><span class="toc-number">10.</span> <span class="toc-text">案例实战之基于Spring注解配置AOP面向切面编程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-AOP注解的基础准备"><span class="toc-number">10.1.</span> <span class="toc-text">Spring AOP注解的基础准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#开启Spring-AOP注解配置和扫描"><span class="toc-number">10.2.</span> <span class="toc-text">开启Spring AOP注解配置和扫描</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AOP案例实战之环绕通知统计接口耗时"><span class="toc-number">10.3.</span> <span class="toc-text">AOP案例实战之环绕通知统计接口耗时</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#新版SSM整合-打通Mysql数据库控制事务"><span class="toc-number">11.</span> <span class="toc-text">新版SSM整合-打通Mysql数据库控制事务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Spring-常见的事务管理"><span class="toc-number">11.0.0.1.</span> <span class="toc-text">Spring 常见的事务管理</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Spring事务的传播属性和隔离级别"><span class="toc-number">12.</span> <span class="toc-text">Spring事务的传播属性和隔离级别</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringBoot-Spring-Mybatsi事务控制"><span class="toc-number">12.1.</span> <span class="toc-text">SpringBoot-Spring-Mybatsi事务控制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Transactional-事务控制"><span class="toc-number">12.2.</span> <span class="toc-text">@Transactional 事务控制</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">Kaluna</div><div class="author-info__description text-center"></div><div class="follow-button"><a href="https://github.com/lxy1866" target="_blank" rel="noopener">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">22</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">30</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">13</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://gitee.com/YuerryHUAHUA/figure/raw/master/img/20210521080208.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">嘿，不停转的轮子</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/about">About</a><a class="site-page" href="/tags/">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> Search</span></a></span></div><div id="post-info"><div id="post-title">小滴课堂三</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-04-21</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Java%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/">Java项目实战</a><span class="post-meta__separator">|</span><i class="fa fa-comment-o post-meta__icon" aria-hidden="true"></i><a href="/2021/04/21/%E5%B0%8F%E6%BB%B4%E8%AF%BE%E5%A0%82%E4%B8%89/#disqus_thread"><span class="disqus-comment-count" data-disqus-identifier="2021/04/21/小滴课堂三/"></span></a></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="SSM之Spring-Framework5-X快速入门"><a href="#SSM之Spring-Framework5-X快速入门" class="headerlink" title="SSM之Spring Framework5.X快速入门"></a>SSM之Spring Framework5.X快速入门</h1><ul>
<li><p>面向切面编程（AOP）可以解耦核心业务和边缘业务的关系</p>
<p>场景：用户调用下单购买视频接口，需要判断登录，拦截器是AOP思想的一种实现</p>
<p>使用前：代码写逻辑，每次下单都调用方法判断，多个方法需要判断登录则都需要登录方法判断</p>
<p>使用后：根据一定的方法或者路径规则进行判断是否要调用，降低代码耦合度</p>
<ul>
<li>包含java大型项目里面常见解决方案 web层、业务层、数据访问层等</li>
<li>极其便利的整合其他主流技术栈，比如redis、mq、mybatis、jpa</li>
<li>社区庞大和活跃，在微服务、大数据、云计算都有对应的组件</li>
</ul>
</li>
<li><p>为什么要学？（springboot帮我们简化了很多配置）</p>
<ul>
<li>使用springboot2.x后，大家很少接触到各种细化的bean配置，但是底层实现流程和原理是必须掌握的，面试+工作都是必备</li>
</ul>
</li>
</ul>
<h2 id="IDEA-Maven-Spring5-X项目创建"><a href="#IDEA-Maven-Spring5-X项目创建" class="headerlink" title="IDEA+Maven+Spring5.X项目创建"></a>IDEA+Maven+Spring5.X项目创建</h2><p>添加依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-context --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-core --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-beans --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-beans<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>添加配置文件applicationContext.xml</p>
<p>添加bean配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        https://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"video"</span> <span class="attr">class</span>=<span class="string">"net.xdclass.sp.domain.Video"</span> <span class="attr">scope</span>=<span class="string">"prototype"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"tom"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">value</span>=<span class="string">"23"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="ApplicationContext-xml配置文件和Helloworld例子解读"><a href="#ApplicationContext-xml配置文件和Helloworld例子解读" class="headerlink" title="ApplicationContext.xml配置文件和Helloworld例子解读"></a>ApplicationContext.xml配置文件和Helloworld例子解读</h2><ul>
<li>bean标签 id属性：指定Bean的名称，在Bean被别的类依赖时使用</li>
<li>name属性：用于指定Bean的别名，如果没有id，也可以用name</li>
<li>class属性：用于指定Bean的来源，要创建的Bean的class类，需要全限定名</li>
</ul>
<h2 id="SpringFramework5-X核心之-IOC-容器"><a href="#SpringFramework5-X核心之-IOC-容器" class="headerlink" title="SpringFramework5.X核心之 IOC 容器"></a>SpringFramework5.X核心之 IOC 容器</h2><h3 id="spring的IOC设计思想"><a href="#spring的IOC设计思想" class="headerlink" title="spring的IOC设计思想"></a>spring的IOC设计思想</h3><ul>
<li><p>什么是IOC Inverse of Control（控制反转）是一种设计思想 将原本在程序中手动创建对象的流程，交由Spring框架来管理 核心：把创建对象的控制权反转给Spring框架，对象的生命周期由Spring统一管理</p>
<p>把spring ioc当成一个容器，里面存储管理的对象称为Bean,类实例</p>
</li>
<li><p>案例实操 配置文件里面定义一个bean，通过代码去获取</p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span>  <span class="attr">name</span>=<span class="string">"video"</span> <span class="attr">class</span>=<span class="string">"net.xdclass.sp.domain.Video"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">value</span>=<span class="string">"9"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"title"</span> <span class="attr">value</span>=<span class="string">"Spring 5.X课程"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext applicationContext = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line"></span><br><span class="line">Video  video = (Video)applicationContext.getBean(<span class="string">"video"</span>);</span><br><span class="line"></span><br><span class="line">System.out.println(video.getTitle());</span><br></pre></td></tr></table></figure>

<h2 id="SpringFramework5-X核心之-DI依赖注入"><a href="#SpringFramework5-X核心之-DI依赖注入" class="headerlink" title="SpringFramework5.X核心之 DI依赖注入"></a>SpringFramework5.X核心之 DI依赖注入</h2><p>IOC容器在运行期间，动态地将对象某种依赖关系注入到对象之中，比如视频订单对象，依赖用视频对象</p>
<p>案例实操</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"video"</span> <span class="attr">class</span>=<span class="string">"net.xdclass.sp.domain.Video"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">value</span>=<span class="string">"9"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"title"</span> <span class="attr">value</span>=<span class="string">"Spring 5.X课程"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"videoOrder"</span> <span class="attr">class</span>=<span class="string">"net.xdclass.sp.domain.VideoOrder"</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">value</span>=<span class="string">"8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"outTradeNo"</span> <span class="attr">value</span>=<span class="string">"23432fnfwedwefqwef2"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"video"</span> <span class="attr">ref</span>=<span class="string">"video"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line"></span><br><span class="line">Video  video = (Video)context.getBean(<span class="string">"video"</span>);</span><br><span class="line">System.out.println(video.getTitle());</span><br><span class="line"></span><br><span class="line">VideoOrder videoOrder = (VideoOrder) context.getBean(<span class="string">"videoOrder"</span>);</span><br><span class="line">System.out.println(videoOrder.getOutTradeNo());</span><br><span class="line">System.out.println(videoOrder.getVideo().getTitle());</span><br></pre></td></tr></table></figure>

<h1 id="Spring5-X-bean-的作用域和注入"><a href="#Spring5-X-bean-的作用域和注入" class="headerlink" title="Spring5.X bean 的作用域和注入"></a>Spring5.X bean 的作用域和注入</h1><h2 id="spring的bean-属性scope作用域"><a href="#spring的bean-属性scope作用域" class="headerlink" title="spring的bean 属性scope作用域"></a>spring的bean 属性scope作用域</h2><p>scope属性</p>
<ul>
<li>singleton：单例, 默认值，调用getBean方法返回是同一个对象,实例会被缓存起来，效率比较高 当一个bean被标识为singleton时候，spring的IOC容器中只会存在一个该bean</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--&lt;bean id="video" class="net.xdclass.sp.domain.Video" scope="singleton"&gt; --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"video"</span> <span class="attr">class</span>=<span class="string">"net.xdclass.sp.domain.Video"</span> <span class="attr">scope</span>=<span class="string">"prototype"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">value</span>=<span class="string">"9"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"title"</span> <span class="attr">value</span>=<span class="string">"Spring 5.X课程"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>prototype: 多例，调用getBean方法创建不同的对象，会频繁的创建和销毁对象造成很大的开销</p>
<p>其他少用 （作用域 只在 WebApplicationContext）</p>
<ul>
<li>request ：每个Http请求都会创建一个新的bean</li>
<li>session: 每个Http Session请求都会创建一个新的bean</li>
<li>global session（基本不用）</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span>  <span class="keyword">void</span> <span class="title">testScope</span><span class="params">(ApplicationContext context)</span></span>&#123;</span><br><span class="line">        Video  video1 = (Video)context.getBean(<span class="string">"video"</span>);</span><br><span class="line"></span><br><span class="line">        Video  video2 = (Video)context.getBean(<span class="string">"video"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//靠匹配内存地址，== 是匹配内存地址</span></span><br><span class="line">        System.out.println( video1 == video2 );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="实战Spring5-X常见的注入方式"><a href="#实战Spring5-X常见的注入方式" class="headerlink" title="实战Spring5.X常见的注入方式"></a>实战Spring5.X常见的注入方式</h2><ul>
<li>使用set方法注入</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"video"</span> <span class="attr">class</span>=<span class="string">"net.xdclass.sp.domain.Video"</span> <span class="attr">scope</span>=<span class="string">"singleton"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">value</span>=<span class="string">"9"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"title"</span> <span class="attr">value</span>=<span class="string">"Spring 5.X课程"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public class Video &#123;</span><br><span class="line">private String title;</span><br><span class="line">public void setTitle(String title) &#123;</span><br><span class="line">    &#x2F;&#x2F;System.out.println(&quot;Video setTitle方法被调用&quot;);</span><br><span class="line">    this.title &#x3D; title;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>使用带参的构造函数注入</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"video"</span> <span class="attr">class</span>=<span class="string">"net.xdclass.sp.domain.Video"</span> &gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"title"</span> <span class="attr">value</span>=<span class="string">"面试专题课程第一季"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>POJO类型注入(property 没有使用value属性，而是使用了ref属性)</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"video"</span> <span class="attr">class</span>=<span class="string">"net.xdclass.sp.domain.Video"</span> &gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"title"</span> <span class="attr">value</span>=<span class="string">"面试专题课程第一季"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"videoOrder"</span> <span class="attr">class</span>=<span class="string">"net.xdclass.sp.domain.VideoOrder"</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">value</span>=<span class="string">"8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"outTradeNo"</span> <span class="attr">value</span>=<span class="string">"23432fnfwedwefqwef2"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"video"</span> <span class="attr">ref</span>=<span class="string">"video"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>注意: 类的构造函数重写的时候，一定要保留空构造函数！！！</li>
</ul>
<h2 id="实战Spring5-X-List-Map类型的注入"><a href="#实战Spring5-X-List-Map类型的注入" class="headerlink" title="实战Spring5.X List-Map类型的注入"></a>实战Spring5.X List-Map类型的注入</h2><ul>
<li>复杂类型注入，添加两个属性</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"video"</span> <span class="attr">class</span>=<span class="string">"net.xdclass.sp.domain.Video"</span> &gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--list类型注入--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"chapterList"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>第一章SpringBoot<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>第二章Mybatis<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>第三章Spring<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"videoMap"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"1"</span> <span class="attr">value</span>=<span class="string">"SpringCloud课程"</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"2"</span> <span class="attr">value</span>=<span class="string">"面试课程"</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"3"</span> <span class="attr">value</span>=<span class="string">"javaweb课程"</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Video</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; chapterList;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;Integer,String&gt; videoMap;</span><br><span class="line"></span><br><span class="line"><span class="comment">//省略set get方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="玩转spring-ioc容器Bean之间的依赖和继承"><a href="#玩转spring-ioc容器Bean之间的依赖和继承" class="headerlink" title="玩转spring ioc容器Bean之间的依赖和继承"></a>玩转spring ioc容器Bean之间的依赖和继承</h2><ul>
<li>bean继承：两个类之间大多数的属性都相同，避免重复配置，通过bean标签的parent属性重用已有的Bean元素的配置信息 继承指的是配置信息的复用，和Java类的继承没有关系</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"video"</span> <span class="attr">class</span>=<span class="string">"net.xdclass.sp.domain.Video"</span> <span class="attr">scope</span>=<span class="string">"singleton"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">value</span>=<span class="string">"9"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"title"</span> <span class="attr">value</span>=<span class="string">"Spring 5.X课程"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"video2"</span> <span class="attr">class</span>=<span class="string">"net.xdclass.sp.domain.Video2"</span> <span class="attr">scope</span>=<span class="string">"singleton"</span> <span class="attr">parent</span>=<span class="string">"video"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"summary"</span> <span class="attr">value</span>=<span class="string">"这个是summary"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Video2</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> String summary;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Video</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>属性依赖: 如果类A是作为类B的属性, 想要类A比类B先实例化，设置两个Bean的依赖关系</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"video"</span> <span class="attr">class</span>=<span class="string">"net.xdclass.sp.domain.Video"</span> <span class="attr">scope</span>=<span class="string">"singleton"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">value</span>=<span class="string">"9"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"title"</span> <span class="attr">value</span>=<span class="string">"Spring 5.X课程"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--设置两个bean的关系，video要先于videoOrder实例化--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"videoOrder"</span> <span class="attr">class</span>=<span class="string">"net.xdclass.sp.domain.VideoOrder"</span> <span class="attr">depends-on</span>=<span class="string">"video"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">value</span>=<span class="string">"8"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"outTradeNo"</span> <span class="attr">value</span>=<span class="string">"23432fnfwedwefqwef2"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"video"</span> <span class="attr">ref</span>=<span class="string">"video"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="玩转Spring5-X-bean-的生命周期和二次处理"><a href="#玩转Spring5-X-bean-的生命周期和二次处理" class="headerlink" title="玩转Spring5.X bean 的生命周期和二次处理"></a>玩转Spring5.X bean 的生命周期和二次处理</h1><h2 id="spring-ioc容器Bean的生命周期的init和destroy方法"><a href="#spring-ioc容器Bean的生命周期的init和destroy方法" class="headerlink" title="spring ioc容器Bean的生命周期的init和destroy方法"></a>spring ioc容器Bean的生命周期的init和destroy方法</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=<span class="string">"video"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"net.xdclass.sp.domain.Video"</span> scope=<span class="string">"singleton"</span> init-method=<span class="string">"init"</span> destroy-method=<span class="string">"destroy"</span>&gt;</span><br><span class="line"></span><br><span class="line">        &lt;property name=<span class="string">"id"</span> value=<span class="string">"9"</span>/&gt;</span><br><span class="line">        &lt;property name=<span class="string">"title"</span> value=<span class="string">"Spring 5.X课程"</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String [] args)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">  ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line">  ((ClassPathXmlApplicationContext) context).registerShutdownHook();</span><br><span class="line"></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h2 id="bean的二次加工-Spring5-x后置处理器-BeanPostProcessor"><a href="#bean的二次加工-Spring5-x后置处理器-BeanPostProcessor" class="headerlink" title="bean的二次加工-Spring5.x后置处理器 BeanPostProcessor"></a>bean的二次加工-Spring5.x后置处理器 BeanPostProcessor</h2><p>什么是BeanPostProcessor</p>
<ul>
<li>是Spring IOC容器给我们提供的一个扩展接口</li>
<li>在调用初始化方法前后对 Bean 进行额外加工，ApplicationContext 会自动扫描实现了BeanPostProcessor的 bean，并注册这些 bean 为后置处理器</li>
<li>是Bean的统一前置后置处理而不是基于某一个bean</li>
</ul>
<p>执行顺序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Spring IOC容器实例化Bean</span><br><span class="line">调用BeanPostProcessor的postProcessBeforeInitialization方法</span><br><span class="line">调用bean实例的初始化方法</span><br><span class="line">调用BeanPostProcessor的postProcessAfterInitialization方法</span><br></pre></td></tr></table></figure>

<p>注意：接口重写的两个方法不能返回null，如果返回null那么在后续初始化方法将报空指针异常或者通过getBean()方法获取不到bean实例对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomBeanPostProcessor</span> <span class="keyword">implements</span> <span class="title">BeanPostProcessor</span>,<span class="title">Ordered</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"CustomBeanPostProcessor1 postProcessBeforeInitialization beanName="</span>+beanName);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"CustomBeanPostProcessor1 postProcessAfterInitialization beanName="</span>+beanName);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以注册多个BeanPostProcessor顺序</p>
<ul>
<li>在Spring机制中可以指定后置处理器调用顺序，通过BeanPostProcessor接口实现类实现Ordered接口getOrder方法，该方法返回整数，默认值为 0优先级最高，值越大优先级越低</li>
</ul>
<h2 id="Spring5-X-bean自动装配Autowire-属性"><a href="#Spring5-X-bean自动装配Autowire-属性" class="headerlink" title="Spring5.X bean自动装配Autowire 属性"></a>Spring5.X bean自动装配Autowire 属性</h2><ul>
<li>属性注入<ul>
<li>前面学过属性注入，set方法、构造函数等，属于手工注入</li>
<li>有没办法实现自动装配注入？</li>
</ul>
</li>
</ul>
<p>Spring自动注入</p>
<ul>
<li>使用元素的 autowire 属性为一个 bean 定义指定自动装配模式</li>
<li><strong>autowire</strong>设置值<ul>
<li>no：没开启</li>
<li>byName: 根据bean的id名称，注入到对应的属性里面</li>
<li>byType：根据bean需要注入的类型，注入到对应的属性里面<ul>
<li>如果按照类型注入，存在2个以上bean的话会抛异常</li>
<li>expected single matching bean but found 2</li>
</ul>
</li>
<li>constructor: 通过构造函数注入，需要这个类型的构造函数</li>
</ul>
</li>
</ul>
<p>VideoOrder有Video属性，把Video注进来</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--&lt;bean id="videoOrder" class="net.xdclass.sp.domain.VideoOrder" autowire="byName"&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&lt;bean id="videoOrder" class="net.xdclass.sp.domain.VideoOrder" autowire="byType"&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"videoOrder"</span> <span class="attr">class</span>=<span class="string">"net.xdclass.sp.domain.VideoOrder"</span> <span class="attr">autowire</span>=<span class="string">"constructor"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">value</span>=<span class="string">"8"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"outTradeNo"</span> <span class="attr">value</span>=<span class="string">"23432fnfwedwefqwef2"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="玩转Spring5-X-面向切面编程-AOP"><a href="#玩转Spring5-X-面向切面编程-AOP" class="headerlink" title="玩转Spring5.X 面向切面编程 AOP"></a>玩转Spring5.X 面向切面编程 AOP</h1><h2 id="什么是AOP面向切面编程"><a href="#什么是AOP面向切面编程" class="headerlink" title="什么是AOP面向切面编程"></a>什么是AOP面向切面编程</h2><ul>
<li>Aspect Oriented Program 面向切面编程</li>
<li>在不改变原有逻辑上增加额外的功能，比如解决系统层面的问题，或者增加新的功能</li>
</ul>
<p>场景</p>
<ul>
<li>权限控制</li>
<li>缓存</li>
<li>日志处理</li>
<li>事务控制</li>
</ul>
<p>AOP思想把功能分两个部分，分离系统中的各种关注点</p>
<ul>
<li><p>核心关注点</p>
<ul>
<li>业务的主要功能</li>
</ul>
</li>
<li><p>横切关注点</p>
<ul>
<li>非核心、额外增加的功能</li>
</ul>
<p>好处</p>
</li>
<li><p>减少代码侵入，解耦</p>
</li>
<li><p>可以统一处理横切逻辑</p>
</li>
<li><p>方便添加和删除横切逻辑</p>
</li>
</ul>
<h2 id="AOP面向切面编程相关核心概念"><a href="#AOP面向切面编程相关核心概念" class="headerlink" title="AOP面向切面编程相关核心概念"></a>AOP面向切面编程相关核心概念</h2><p>横切关注点</p>
<ul>
<li>对哪些方法进行拦截，拦截后怎么处理，这些就叫横切关注点</li>
<li>比如 权限认证、日志、事物</li>
</ul>
<p>通知 Advice</p>
<ul>
<li>在特定的切入点上执行的增强处理，有5种通知，后面讲解</li>
<li>做啥？ 比如你需要记录日志，控制事务 ，提前编写好通用的模块，需要的地方直接调用</li>
</ul>
<p>连接点 JointPoint</p>
<ul>
<li>要用通知的地方，业务流程在运行过程中需要插入切面的具体位置，</li>
<li>一般是方法的调用前后，全部方法都可以是连接点</li>
<li>只是概念，没啥特殊</li>
</ul>
<p>切入点 Pointcut</p>
<ul>
<li>不能全部方法都是连接点，通过特定的规则来筛选连接点, 就是Pointcut，选中那几个你想要的方法</li>
<li>在程序中主要体现为书写切入点表达式（通过通配、正则表达式）过滤出特定的一组 JointPoint连接点</li>
<li>过滤出相应的 Advice 将要发生的joinpoint地方</li>
</ul>
<p>切面 Aspect</p>
<ul>
<li>通常是一个类，里面定义 <strong>切入点+通知</strong> , 定义在什么地方； 什么时间点、做什么事情</li>
<li><strong>通知 advice指明了时间和做的事情（前置、后置等）</strong></li>
<li><strong>切入点 pointcut 指定在什么地方干这个事情</strong></li>
<li>web接口设计中，web层-&gt;网关层-&gt;服务层-&gt;数据层，每一层之间也是一个切面，对象和对象，方法和方法之间都是一个个切面</li>
</ul>
<p>目标 target</p>
<ul>
<li>目标类，真正的业务逻辑，可以在目标类不知情的条件下，增加新的功能到目标类的链路上</li>
</ul>
<p>织入 Weaving</p>
<ul>
<li>把切面（某个类）应用到目标函数的过程称为织入</li>
</ul>
<p>AOP代理</p>
<ul>
<li>AOP框架创建的对象，代理就是目标对象的加强</li>
<li>Spring中的AOP代理可以使JDK动态代理，也可以是CGLIB代理</li>
</ul>
<h2 id="AOP里面的通知Advice类型"><a href="#AOP里面的通知Advice类型" class="headerlink" title="AOP里面的通知Advice类型"></a>AOP里面的通知Advice类型</h2><p><strong>AOP里面Advice通知</strong></p>
<ul>
<li>@Before前置通知<ul>
<li>在执行目标方法之前运行</li>
</ul>
</li>
<li>@After后置通知<ul>
<li>在目标方法运行结束之后</li>
</ul>
</li>
<li>@AfterReturning返回通知<ul>
<li>在目标方法正常返回值后运行</li>
</ul>
</li>
<li>@AfterThrowing异常通知<ul>
<li>在目标方法出现异常后运行</li>
</ul>
</li>
<li>@Around环绕通知<ul>
<li>在目标方法完成前、后做增强处理 ,环绕通知是最重要的通知类型 ,像事务,日志等都是环绕通知,注意编程中核心是一个ProceedingJoinPoint，需要手动执行 joinPoint.procced()</li>
</ul>
</li>
</ul>
<p>接口业务流程例子</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//目标类 VideoOrderService； 里面每个方法都是连接点，；切入点是CUD类型的方法，R读取的不作为切入点</span></span><br><span class="line"><span class="comment">//CRDU全称：增加(Create)、读取查询(Retrieve)、更新(Update)和删除(Delete)</span></span><br><span class="line"></span><br><span class="line">VideoOrderService&#123;</span><br><span class="line">    <span class="comment">//新增订单</span></span><br><span class="line">    addOrder()&#123; &#125;</span><br><span class="line">    <span class="comment">//查询订单</span></span><br><span class="line">   findOrderById()&#123;&#125;</span><br><span class="line">   <span class="comment">//删除订单</span></span><br><span class="line">   delOrder()&#123;&#125;</span><br><span class="line">   <span class="comment">//更新订单</span></span><br><span class="line">   updateOrder()&#123;&#125;   </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//权限切面类 = 切入点+通知 </span></span><br><span class="line">PermissionAspects&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//切入点  定义了什么地方</span></span><br><span class="line">  <span class="meta">@Pointcut</span>(<span class="string">"execution(public int net.xdclass.sp.service.VideoOrderService.*(..))"</span>)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pointCut</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//before 通知 表示在目标方法执行前切入, 并指定在哪个方法前切入</span></span><br><span class="line">  <span class="comment">//什么时候，做什么事情</span></span><br><span class="line">  <span class="meta">@Before</span>(<span class="string">"pointCut()"</span>)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">permissionCheck</span><span class="params">()</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"在 xxx 之前执行权限校验"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  ....</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//日志切面类 = 切入点+通知 </span></span><br><span class="line">LogAspect&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//切入点  定义了什么地方</span></span><br><span class="line">  <span class="meta">@Pointcut</span>(<span class="string">"execution(public int net.xdclass.sp.service.VideoOrderService.*(..))"</span>)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pointCut</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">//after 通知 表示在目标方法执行后切入, 并指定在哪个方法前切入</span></span><br><span class="line">    <span class="comment">//什么时候，做什么事情</span></span><br><span class="line">    <span class="meta">@After</span>(<span class="string">"pointCut()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">logStart</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"在 xxx 之后记录日志"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  ....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Spring5-X-AOP切入点表达式"><a href="#Spring5-X-AOP切入点表达式" class="headerlink" title="Spring5.X AOP切入点表达式"></a>Spring5.X AOP切入点表达式</h2><p>切入点表示式</p>
<ul>
<li>除了返回类型、方法名和参数外，其它项都是可选的 (修饰符基本都是省略不写)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">			访问修饰符    	返回值类型（必填）     包和类            方法（必填）     参数</span><br><span class="line">execution(modifiers-pattern? ret-type-pattern declaring-type-pattern?name-pattern(param-pattern)  throws-pattern?)</span><br></pre></td></tr></table></figure>

<ul>
<li>@Pointcut(“execution(public int net.xdclass.sp.service.VideoOrderService.*(..))”)</li>
</ul>
<p>常见匹配语法</p>
<ul>
<li><p>*：匹配任何数量字符单个；</p>
</li>
<li><p>..：匹配任何数量字符，可以多个，在类型模式中匹配任何数量子包；在方法参数模式中匹配任何数量参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">() 匹配一个不接受任何参数的方法</span><br><span class="line">(..) 匹配一个接受任意数量参数的方法</span><br><span class="line">(*) 匹配了一个接受一个任何类型的参数的方法</span><br><span class="line">(*,Integer) 匹配了一个接受两个参数的方法，其中第一个参数是任意类型，第二个参数必须是Integer类型</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>常见例子</p>
<ul>
<li><p>任意公共方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execution（public * *（..））</span><br></pre></td></tr></table></figure>
</li>
<li><p>任何一个名字以“save”开始的方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execution（* save*（..））</span><br></pre></td></tr></table></figure>
</li>
<li><p>VideoService接口定义的任意方法（识别）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execution（* net.xdclass.service.VideoService.*（..））</span><br></pre></td></tr></table></figure>
</li>
<li><p>在service包中定义的任意方法（识别）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execution（* net.xdclass.service.*.*（..））</span><br></pre></td></tr></table></figure>
</li>
<li><p>匹配 service 包，子孙包下所有类的所有方法（识别）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execution（* net.xdclass.service..*.*（..））</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h1 id="Spring-AOP里面的代理知识"><a href="#Spring-AOP里面的代理知识" class="headerlink" title="Spring AOP里面的代理知识"></a>Spring AOP里面的代理知识</h1><h2 id="静态代理和动态代理"><a href="#静态代理和动态代理" class="headerlink" title="静态代理和动态代理"></a>静态代理和动态代理</h2><p>什么是代理</p>
<ul>
<li>为某一个对象创建一个代理对象，程序不直接用原本的对象，而是由创建的代理对象来控制对原对象，通过代理类这中间一层，能有效控制对委托类对象的直接访问，也可以很好地隐藏和保护委托类对象，同时也为实施不同控制策略预留了空间</li>
<li>A -&gt;B-&gt; C</li>
</ul>
<p>什么是静态代理</p>
<ul>
<li>由程序创建或特定工具自动生成源代码，在程序运行前，代理类的.class文件就已经存在</li>
</ul>
<p>什么是动态代理</p>
<ul>
<li>在程序运行时，运用反射机制动态创建而成，无需手动编写代码<ul>
<li>JDK动态代理</li>
<li>CGLIB动态代理</li>
</ul>
</li>
</ul>
<h2 id="代理模式实战之静态代理"><a href="#代理模式实战之静态代理" class="headerlink" title="代理模式实战之静态代理"></a>代理模式实战之静态代理</h2><ul>
<li>什么是静态代理<ul>
<li>由程序创建或特定工具自动生成源代码，在程序运行前，代理类的.class文件就已经存在</li>
<li>通过将目标类与代理类实现同一个接口，让代理类<strong>持有真实类对象</strong>，然后在代理类方法中调用真实类方法，在调用真实类方法的前后添加我们所需要的功能扩展代码来达到增强的目的</li>
<li>A -&gt; B -&gt; C</li>
</ul>
</li>
<li>优点<ul>
<li>代理使客户端不需要知道实现类是什么，怎么做的，而客户端只需知道代理即可</li>
<li>方便增加功能，拓展业务逻辑</li>
</ul>
</li>
<li>缺点<ul>
<li>代理类中出现大量冗余的代码，非常不利于扩展和维护</li>
<li>如果接口增加一个方法，除了所有实现类需要实现这个方法外，所有代理类也需要实现此方法。增加了代码维护的复杂度</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StaticProxyPayServiceImpl</span> <span class="keyword">implements</span> <span class="title">PayService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> PayService payService;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="title">StaticProxyPayServiceImpl</span><span class="params">(PayService payService)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.payService = payService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">callback</span><span class="params">(String outTradeNo)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"StaticProxyPayServiceImpl callback begin"</span>);</span><br><span class="line">        String result = payService.callback(outTradeNo);</span><br><span class="line">        System.out.println(<span class="string">"StaticProxyPayServiceImpl callback end"</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">save</span><span class="params">(<span class="keyword">int</span> userId, <span class="keyword">int</span> productId)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"StaticProxyPayServiceImpl save begin"</span>);</span><br><span class="line">        <span class="keyword">int</span> id = payService.save(userId, productId);</span><br><span class="line">        System.out.println(<span class="string">"StaticProxyPayServiceImpl save end"</span>);</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PayServiceImpl</span> <span class="keyword">implements</span> <span class="title">PayService</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">callback</span><span class="params">(String outTradeNo)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"目标类 PayServiceImpl 回调 方法 callback"</span>);</span><br><span class="line">        <span class="keyword">return</span> outTradeNo;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">save</span><span class="params">(<span class="keyword">int</span> userId, <span class="keyword">int</span> productId)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"目标类 PayServiceImpl 回调 方法 save"</span>);</span><br><span class="line">        <span class="keyword">return</span> productId;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.xdclass.sp.proxy;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProxyTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//PayService payService = new PayServiceImpl();</span></span><br><span class="line">        <span class="comment">//payService.callback("abdjd");</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//将真实类对象传进去</span></span><br><span class="line">        PayService payService = <span class="keyword">new</span> StaticProxyPayServiceImpl(<span class="keyword">new</span> PayServiceImpl());</span><br><span class="line">        payService.save(<span class="number">234</span>,<span class="number">6879</span>);</span><br><span class="line">        payService.callback(<span class="string">"879"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="AOP的实现策略之JDK动态代理"><a href="#AOP的实现策略之JDK动态代理" class="headerlink" title="AOP的实现策略之JDK动态代理"></a>AOP的实现策略之JDK动态代理</h1><p>什么是动态代理</p>
<ul>
<li>在程序运行时，运用反射机制动态创建而成，无需手动编写代码</li>
<li>JDK动态代理与静态代理一样，目标类需要实现一个代理接口，再通过代理对象调用目标方法</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义一个java.lang.reflect.InvocationHandler接口的实现类，重写invoke方法</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Object proxy:被代理的对象  </span></span><br><span class="line"><span class="comment">//Method method:要调用的方法  </span></span><br><span class="line"><span class="comment">//Object[] args:方法调用时所需要参数  </span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">InvocationHandler</span> </span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.xdclass.sp.proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdkProxy</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//通用的代理对象</span></span><br><span class="line">    <span class="keyword">private</span> Object targetObject;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取代理对象</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">newProxyInstance</span><span class="params">(Object targetObject)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.targetObject = targetObject;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//绑定关系，也就是和具体的哪个实现类关联</span></span><br><span class="line">        <span class="keyword">return</span> Proxy.newProxyInstance(targetObject.getClass().getClassLoader(), targetObject.getClass().getInterfaces(),<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line"></span><br><span class="line">        Object result = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            System.out.println(<span class="string">"通过jdk动态代理调用"</span>+method.getName()+<span class="string">", 打印日志 begin"</span>);</span><br><span class="line">            result = method.invoke(targetObject,args);</span><br><span class="line">            System.out.println(<span class="string">"通过jdk动态代理调用"</span>+method.getName()+<span class="string">", 打印日志 end"</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.xdclass.sp.proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProxyTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">//动态代理</span></span><br><span class="line">        JdkProxy jdkProxy = <span class="keyword">new</span> JdkProxy();</span><br><span class="line">        <span class="comment">//获取代理类对象</span></span><br><span class="line">        PayService payServiceProxy = (PayService) jdkProxy.newProxyInstance(<span class="keyword">new</span> PayServiceImpl());</span><br><span class="line"></span><br><span class="line">        payServiceProxy.callback(<span class="string">"dhiouo"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="AOP的实现策略之CGLib动态代理"><a href="#AOP的实现策略之CGLib动态代理" class="headerlink" title="AOP的实现策略之CGLib动态代理"></a>AOP的实现策略之CGLib动态代理</h2><ul>
<li>什么是动态代理<ul>
<li>在程序运行时，运用反射机制动态创建而成，无需手动编写代码</li>
<li>CgLib动态代理的原理是对指定的业务类生成一个子类，并覆盖其中的业务方法来实现代理</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.xdclass.sp.proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aopalliance.intercept.MethodInvocation;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cglib.proxy.Enhancer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cglib.proxy.MethodInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cglib.proxy.MethodProxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CglibProxy</span> <span class="keyword">implements</span> <span class="title">MethodInterceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//通用的代理对象</span></span><br><span class="line">    <span class="keyword">private</span> Object targetObject;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//绑定关系</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">newProxyInstance</span><span class="params">(Object targetObject)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.targetObject = targetObject;</span><br><span class="line"></span><br><span class="line">        Enhancer enhancer = <span class="keyword">new</span> Enhancer();</span><br><span class="line">        <span class="comment">//设置代理类的父类（目标类）</span></span><br><span class="line">        enhancer.setSuperclass(<span class="keyword">this</span>.targetObject.getClass());</span><br><span class="line">        <span class="comment">//设置回调函数</span></span><br><span class="line">        enhancer.setCallback(<span class="keyword">this</span>);</span><br><span class="line">        <span class="comment">//创建子类（代理对象）</span></span><br><span class="line">        <span class="keyword">return</span> enhancer.create();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Object o, Method method, Object[] args, MethodProxy methodProxy)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line"></span><br><span class="line">        Object result = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            System.out.println(<span class="string">"通过Cglib动态代理调用"</span>+method.getName()+<span class="string">", 打印日志 begin"</span>);</span><br><span class="line">            result = methodProxy.invokeSuper(o, args);</span><br><span class="line">            System.out.println(<span class="string">"通过Cglib动态代理调用"</span>+method.getName()+<span class="string">", 打印日志 begin"</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.xdclass.sp.proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProxyTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//CGLIB动态代理</span></span><br><span class="line">        CglibProxy cglibProxy = <span class="keyword">new</span> CglibProxy();</span><br><span class="line">        PayService payService = (PayService) cglibProxy.newProxyInstance(<span class="keyword">new</span> PayServiceImpl());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//调用目标方法</span></span><br><span class="line">        payService.callback(<span class="string">"ghloo"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="CGLib动态代理和JDK动态代理总结"><a href="#CGLib动态代理和JDK动态代理总结" class="headerlink" title="CGLib动态代理和JDK动态代理总结"></a>CGLib动态代理和JDK动态代理总结</h2><ul>
<li><p>动态代理与静态代理相比较，最大的好处是接口中声明的所有方法都被转移到调用处理器一个集中的方法中处理，解耦和易维护</p>
</li>
<li><p>两种动态代理的区别：</p>
<ul>
<li>JDK动态代理：要求目标对象<em>实现一个接口</em>，但是有时候目标对象只是一个单独的对象,并没有实现任何的接口,这个时候就可以用CGLib动态代理</li>
<li>CGLib动态代理,它是在内存中构建一个子类对象从而实现对目标对象功能的扩展</li>
<li>JDK动态代理是自带的，CGlib需要引入第三方包</li>
<li>CGLib动态代理基于继承来实现代理，所以无法对final类、private方法和static方法实现代理</li>
</ul>
</li>
</ul>
<p>Spring AOP中的代理使用的默认策略：</p>
<ul>
<li>如果目标对象实现了接口，则默认采用JDK动态代理</li>
<li>如果目标对象没有实现接口，则采用CgLib进行动态代理</li>
<li>如果目标对象实现了接扣，程序里面依旧可以指定使用CGlib动态代理</li>
</ul>
<h1 id="面向切面编程-Spring-AOP-实战-配置"><a href="#面向切面编程-Spring-AOP-实战-配置" class="headerlink" title="面向切面编程 Spring AOP 实战 配置"></a>面向切面编程 Spring AOP 实战 配置</h1><p><strong>实战SpringAOP配置日志打印基础准备</strong></p>
<ul>
<li><p>需求分析：针对Videoservice接口实现日志打印</p>
</li>
<li><p>三个核心包</p>
<ul>
<li>spring-aop：AOP核心功能，例如代理工厂</li>
<li>aspectjweaver：简单理解，支持切入点表达式</li>
<li>aspectjrt：简单理解，支持aop相关注解</li>
</ul>
</li>
<li><p>定义service接口和实现类 </p>
</li>
<li><p>定义横切关注点</p>
</li>
<li><p>引入相关包</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.6.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>maven仓库改为阿里云</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>maven-ali<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">releases</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">updatePolicy</span>&gt;</span>always<span class="tag">&lt;/<span class="name">updatePolicy</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">checksumPolicy</span>&gt;</span>fail<span class="tag">&lt;/<span class="name">checksumPolicy</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="基于Spring的AOP快速实现通用日志打印"><a href="#基于Spring的AOP快速实现通用日志打印" class="headerlink" title="基于Spring的AOP快速实现通用日志打印"></a>基于Spring的AOP快速实现通用日志打印</h2><p>添加schema</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;aop</span><br><span class="line">http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;aop&#x2F;spring-aop-4.2.xsd&quot;</span><br><span class="line">xmlns:aop&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;aop&quot;</span><br></pre></td></tr></table></figure>

<p>配置bean和aop</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"timeHandler"</span> <span class="attr">class</span>=<span class="string">"net.xdclass.sp.aop.TimeHandler"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"videoService"</span> <span class="attr">class</span>=<span class="string">"net.xdclass.sp.service.VideoServiceImpl"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--aop配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--横切关注点--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">id</span>=<span class="string">"timeAspect"</span> <span class="attr">ref</span>=<span class="string">"timeHandler"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--定义切入点表达式--&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--&lt;aop:pointcut id="allMethodLogPointCut" expression="execution(* net.xdclass.sp.service.VideoService.sav*(..))"/&gt;--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">"allMethodLogPointCut"</span> <span class="attr">expression</span>=<span class="string">"execution(* net.xdclass.sp.service.VideoService.*(..))"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!--配置前置通知和后置通知--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">"printBefore"</span> <span class="attr">pointcut-ref</span>=<span class="string">"allMethodLogPointCut"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">"printAfter"</span> <span class="attr">pointcut-ref</span>=<span class="string">"allMethodLogPointCut"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="玩转Spring5-X-Xml配置转换到注解配置"><a href="#玩转Spring5-X-Xml配置转换到注解配置" class="headerlink" title="玩转Spring5.X Xml配置转换到注解配置"></a>玩转Spring5.X Xml配置转换到注解配置</h1><h2 id="spring的使用注解配置项目"><a href="#spring的使用注解配置项目" class="headerlink" title="spring的使用注解配置项目"></a>spring的使用注解配置项目</h2><ul>
<li><p>开启注解配置和包扫描</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">     AnnotationConfigApplicationContext context = <span class="keyword">new</span> AnnotationConfigApplicationContext();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//扫描指定的包，包括子包</span></span><br><span class="line">        context.scan(<span class="string">"net.xdclass"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//里面完成初始化操作，核心方法</span></span><br><span class="line">        context.refresh();</span><br><span class="line"></span><br><span class="line">        VideoService videoService = (VideoService) context.getBean(<span class="string">"videoService"</span>);</span><br><span class="line">        videoService.findById(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        Video video = (Video) context.getBean(<span class="string">"video"</span>);</span><br><span class="line">        video.init();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>(<span class="string">"videoService"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VideoServiceImpl</span> <span class="keyword">implements</span> <span class="title">VideoService</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>(<span class="string">"video"</span>)</span><br><span class="line"><span class="comment">//@Scope("prototype")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Video</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>spring的使用方式有两种 xml 配置和注解</p>
<ul>
<li>有些公司只用其中一种，也有公司 xml 配置与注解配置一起使用</li>
</ul>
</li>
<li><p>注解的优势：配置简单，维护方便</p>
</li>
<li><p>xml的优势：单修改xml时不用改源码，不用重新编译和部署</p>
</li>
<li><p>结论：看团队开发规范进行选择，没有强调一定用哪个，更多的是xml+注解配合使用，比如spring整合mybatis</p>
</li>
</ul>
<h2 id="实战Spring5-X的常用注解和xml对比"><a href="#实战Spring5-X的常用注解和xml对比" class="headerlink" title="实战Spring5.X的常用注解和xml对比"></a>实战Spring5.X的常用注解和xml对比</h2><p>常用注解</p>
<ul>
<li><p>bean定义</p>
<ul>
<li>xml方式：</li>
<li>注解方式：@Component 通用组件 细分： @Controller (用于web层) @Service (用于service层) @Repository (用于dao仓库层)</li>
</ul>
</li>
<li><p>bean取名</p>
<ul>
<li>xml方式：通过id或者name</li>
<li>注解方式：@Component(“XXXX”)</li>
</ul>
</li>
<li><p>bean注入</p>
<ul>
<li>xml方式：</li>
<li>注解方式：类型注入@Autowired 名称注入@Qualifier</li>
</ul>
</li>
<li><p>bean生命周期</p>
<ul>
<li>xml方式：init-method、destroy-method</li>
<li>注解方式：@PostConstruct初始化、@PreDestroy销毁</li>
</ul>
</li>
<li><p>bean作用范围</p>
<ul>
<li>xml方式：scope属性</li>
<li>注解方式：@scope注解</li>
</ul>
<h1 id="玩转Spring5-X-Xml配置转换到注解配置进阶"><a href="#玩转Spring5-X-Xml配置转换到注解配置进阶" class="headerlink" title="玩转Spring5.X Xml配置转换到注解配置进阶"></a>玩转Spring5.X Xml配置转换到注解配置进阶</h1></li>
</ul>
<h2 id="spring的-Configuration和-Bean注解定义第三方bean"><a href="#spring的-Configuration和-Bean注解定义第三方bean" class="headerlink" title="spring的@Configuration和@Bean注解定义第三方bean"></a>spring的@Configuration和@Bean注解定义第三方bean</h2><ul>
<li><p>@Configuration标注在类上，相当于把该类作为spring的xml配置文件中的，作用为：配置spring容器(应用上下文)</p>
</li>
<li><p>@bean注解：用于告诉方法产生一个Bean对象，然后这个Bean对象交给Spring管理，Spring将会将这个Bean对象放在自己的IOC容器中</p>
</li>
<li><p>注意点:SpringIOC容器管理一个或者多个bean，这些bean都需要在@Configuration注解下进行创建</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//使用@bean注解，表明这个bean交个spring 进行管理</span></span><br><span class="line">    <span class="comment">// 如果没有指定名称，默认采用 方法名 + 第一个字母小写 作为bean的名称</span></span><br><span class="line">    <span class="meta">@Bean</span>(name = <span class="string">"videoOrderName"</span>,initMethod = <span class="string">"init"</span>,destroyMethod = <span class="string">"destroy"</span>)</span><br><span class="line">    <span class="meta">@Scope</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> VideoOrder <span class="title">videoOrder</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> VideoOrder();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Spring的自动映射配置文件PropertySource注解"><a href="#Spring的自动映射配置文件PropertySource注解" class="headerlink" title="Spring的自动映射配置文件PropertySource注解"></a>Spring的自动映射配置文件PropertySource注解</h2><ul>
<li>@PropertySource，指定加载配置文件<ul>
<li>配置文件映射到实体类</li>
</ul>
</li>
<li>使用@Value映射到具体的java属性</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@PropertySource</span>(value = &#123;<span class="string">"classpath:config.properties"</span>&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;server.host&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String host;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;server.port&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> port;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getHost</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> host;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHost</span><span class="params">(String host)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.host = host;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPort</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> port;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPort</span><span class="params">(<span class="keyword">int</span> port)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.port = port;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="案例实战之基于Spring注解配置AOP面向切面编程"><a href="#案例实战之基于Spring注解配置AOP面向切面编程" class="headerlink" title="案例实战之基于Spring注解配置AOP面向切面编程"></a>案例实战之基于Spring注解配置AOP面向切面编程</h1><h2 id="Spring-AOP注解的基础准备"><a href="#Spring-AOP注解的基础准备" class="headerlink" title="Spring AOP注解的基础准备"></a>Spring AOP注解的基础准备</h2><ul>
<li>声明切面类 @Aspect(切面): 通常是一个类，里面可以定义切入点和通知</li>
<li>配置切入点和通知</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="comment">//告诉spring，这个一个切面类，里面可以定义切入点和通知</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogAdvice</span> </span>&#123;</span><br><span class="line">    <span class="comment">//切入点表达式</span></span><br><span class="line">    <span class="meta">@Pointcut</span>(<span class="string">"execution(* net.xdclass.sp.service.VideoServiceImpl.*(..))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">aspect</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//前置通知</span></span><br><span class="line">    <span class="meta">@Before</span>(<span class="string">"aspect()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeLog</span><span class="params">(JoinPoint joinPoint)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"LogAdvice  beforeLog"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//后置通知</span></span><br><span class="line">    <span class="meta">@After</span>(<span class="string">"aspect()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterLog</span><span class="params">(JoinPoint joinPoint)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"LogAdvice  afterLog"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="开启Spring-AOP注解配置和扫描"><a href="#开启Spring-AOP注解配置和扫描" class="headerlink" title="开启Spring AOP注解配置和扫描"></a>开启Spring AOP注解配置和扫描</h2><ul>
<li>开启SpringAOP注解配置</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(<span class="string">"net.xdclass"</span>)</span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span>  <span class="comment">//开启了spring对aspect的支持</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AnnotationAppConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">AnnotationConfigApplicationContext context = <span class="keyword">new</span> AnnotationConfigApplicationContext(AnnotationAppConfig<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">        VideoService videoService = (VideoService) context.getBean(<span class="string">"videoService"</span>);</span><br><span class="line"></span><br><span class="line">        videoService.findById(<span class="number">2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>效果测试</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="comment">//告诉spring，这个一个切面类，里面可以定义切入点和通知</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogAdvice</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//切入点表达式,也可以直接在通知上编写切入点表达式</span></span><br><span class="line">    <span class="meta">@Pointcut</span>(<span class="string">"execution(* net.xdclass.sp.service.VideoServiceImpl.*(..))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">aspect</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//前置通知</span></span><br><span class="line">    <span class="comment">//@Before("aspect()")</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span>(<span class="string">"execution(* net.xdclass.sp.service.VideoServiceImpl.*(..))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeLog</span><span class="params">(JoinPoint joinPoint)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"LogAdvice  beforeLog"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//后置通知</span></span><br><span class="line">    <span class="meta">@After</span>(<span class="string">"aspect()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterLog</span><span class="params">(JoinPoint joinPoint)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"LogAdvice  afterLog"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="AOP案例实战之环绕通知统计接口耗时"><a href="#AOP案例实战之环绕通知统计接口耗时" class="headerlink" title="AOP案例实战之环绕通知统计接口耗时"></a>AOP案例实战之环绕通知统计接口耗时</h2><ul>
<li>配置环绕通知：打印方法请求耗时时间</li>
<li>环绕通知获取目标方法和参数</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 环绕通知</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> joinPoint</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">   <span class="meta">@Around</span>(<span class="string">"aspect()"</span>)</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">around</span><span class="params">(JoinPoint joinPoint)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">       Object target = joinPoint.getTarget().getClass().getName();</span><br><span class="line">       System.out.println(<span class="string">"调用者="</span>+target);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//目标方法签名</span></span><br><span class="line">       System.out.println(<span class="string">"调用方法="</span>+joinPoint.getSignature());</span><br><span class="line"></span><br><span class="line">       <span class="comment">//通过joinPoint获取参数</span></span><br><span class="line">       Object [] args = joinPoint.getArgs();</span><br><span class="line">       System.out.println(<span class="string">"参数="</span>+args[<span class="number">0</span>]);</span><br><span class="line">       </span><br><span class="line">       </span><br><span class="line">       <span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line">       System.out.println(<span class="string">"环绕通知 环绕前========="</span>);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//执行连接点的方法</span></span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           ((ProceedingJoinPoint)joinPoint).proceed();</span><br><span class="line">       &#125; <span class="keyword">catch</span> (Throwable throwable) &#123;</span><br><span class="line">           throwable.printStackTrace();</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">long</span> end = System.currentTimeMillis();</span><br><span class="line">       System.out.println(<span class="string">"环绕通知 环绕后========="</span>);</span><br><span class="line"></span><br><span class="line">       System.out.println(<span class="string">"调用方法总耗时 time = "</span> + (end - start) +<span class="string">" ms"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="新版SSM整合-打通Mysql数据库控制事务"><a href="#新版SSM整合-打通Mysql数据库控制事务" class="headerlink" title="新版SSM整合-打通Mysql数据库控制事务"></a>新版SSM整合-打通Mysql数据库控制事务</h1><h4 id="Spring-常见的事务管理"><a href="#Spring-常见的事务管理" class="headerlink" title="Spring 常见的事务管理"></a>Spring 常见的事务管理</h4><p>具备ACID四种特性</p>
<ul>
<li>Atomic（原子性）</li>
<li>Consistency（一致性）</li>
<li>Isolation（隔离性）</li>
<li>Durability（持久性）</li>
</ul>
<p>你知道常见的Spring事务管理方式吗？</p>
<ul>
<li>编程式事务管理：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* 代码中调用beginTransaction()、commit()、rollback()等事务管理相关的方法，通过TransactionTempalte手动管理事务(用的少)</span><br></pre></td></tr></table></figure>

<ul>
<li>声明式事务管理：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* 通过AOP实现，可配置文件方式或者注解方式实现事务的管理控制(用的多)</span><br></pre></td></tr></table></figure>

<p>你知道声明式事务管理本质吗：</p>
<p>本质是对方法前后进行拦截，底层是建立在 AOP 的基础之上</p>
<p>在目标方法开始之前创建或者加入一个事务，在执行完目标方法之后根据执行情况提交或者回滚事务</p>
<h1 id="Spring事务的传播属性和隔离级别"><a href="#Spring事务的传播属性和隔离级别" class="headerlink" title="Spring事务的传播属性和隔离级别"></a>Spring事务的传播属性和隔离级别</h1><p>事物传播行为介绍:</p>
<ul>
<li>如果在开始当前事务之前，一个事务上下文已经存在，此时有若干选项可以指定一个事务性方法的执行行为<ul>
<li>@Transactional(propagation=Propagation.REQUIRED) 如果有事务, 那么加入事务, 没有的话新建一个(默认情况下)</li>
<li>@Transactional(propagation=Propagation.NOT_SUPPORTED) 不为这个方法开启事务</li>
<li>@Transactional(propagation=Propagation.REQUIRES_NEW) 不管是否存在事务,都创建一个新的事务,原来的挂起,新的执行完毕,继续执行老的事务</li>
<li>@Transactional(propagation=Propagation.MANDATORY) 必须在一个已有的事务中执行,否则抛出异常</li>
<li>@Transactional(propagation=Propagation.NEVER) 必须在一个没有的事务中执行,否则抛出异常(与Propagation.MANDATORY相反)</li>
<li>@Transactional(propagation=Propagation.SUPPORTS) 如果其他bean调用这个方法,在其他bean中声明事务,那就用事务.如果其他bean没有声明事务,那就不用事务.</li>
<li>@Transactional(propagation=Propagation.NESTED) 如果当前存在事务，则创建一个事务作为当前事务的嵌套事务来运行； 如果当前没有事务，则该取值等价于Propagation.REQUIRED。</li>
</ul>
</li>
</ul>
<p>事务隔离级别: 是指若干个并发的事务之间的隔离程度</p>
<ul>
<li>@Transactional(isolation = Isolation.READ_UNCOMMITTED) 读取未提交数据(会出现脏读, 不可重复读) 基本不使用</li>
<li>@Transactional(isolation = Isolation.READ_COMMITTED) 读取已提交数据(会出现不可重复读和幻读)</li>
<li>@Transactional(isolation = Isolation.REPEATABLE_READ) 可重复读(会出现幻读)</li>
<li>@Transactional(isolation = Isolation.SERIALIZABLE) 串行化</li>
</ul>
<p>MYSQL: 默认为REPEATABLE_READ级别</p>
<h2 id="SpringBoot-Spring-Mybatsi事务控制"><a href="#SpringBoot-Spring-Mybatsi事务控制" class="headerlink" title="SpringBoot-Spring-Mybatsi事务控制"></a>SpringBoot-Spring-Mybatsi事务控制</h2><h2 id="Transactional-事务控制"><a href="#Transactional-事务控制" class="headerlink" title="@Transactional 事务控制"></a>@Transactional 事务控制</h2><ul>
<li>快速创建SpringBoot+Spring+Mybatsi项目<ul>
<li><a href="https://start.spring.io/" target="_blank" rel="noopener">https://start.spring.io/</a></li>
</ul>
</li>
<li>连接打通数据库</li>
</ul>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.datasource.driver-class-name</span> =<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="meta">spring.datasource.url</span>=<span class="string">jdbc:mysql://127.0.0.1:3306/online_xdclass?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false</span></span><br><span class="line"><span class="meta">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">spring.datasource.password</span>=<span class="string">xdclass.net</span></span><br><span class="line"><span class="comment">#使用阿里巴巴druid数据源，默认使用自带的</span></span><br><span class="line"><span class="comment">#spring.datasource.type =com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line"><span class="comment">#开启控制台打印sql</span></span><br><span class="line"><span class="meta">mybatis.configuration.log-impl</span>=<span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br></pre></td></tr></table></figure>

<ul>
<li>多表操作，通过@Transactional控制事务<ul>
<li>启动类加注解 @EnableTransactionManagement</li>
<li>业务类 加 @Transactional</li>
</ul>
</li>
</ul>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Kaluna</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://blog.kaluna.top/2021/04/21/%E5%B0%8F%E6%BB%B4%E8%AF%BE%E5%A0%82%E4%B8%89/">https://blog.kaluna.top/2021/04/21/%E5%B0%8F%E6%BB%B4%E8%AF%BE%E5%A0%82%E4%B8%89/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/spring-framework/">spring framework</a></div><div class="post-qr-code"><div class="post-qr-code-item"><img class="post-qr-code__img" src="https://i.loli.net/2021/04/20/FbPtxEHeSDgCXBy.jpg"><div class="post-qr-code__desc">添加我为好友</div></div></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2021/04/21/%E5%B0%8F%E6%BB%B4%E8%AF%BE%E5%A0%82%E4%B8%80/"><i class="fa fa-chevron-left">  </i><span>小滴课堂一</span></a></div><div class="next-post pull-right"><a href="/2021/04/21/%E5%B0%8F%E6%BB%B4%E8%AF%BE%E5%A0%82%E4%BA%8C/"><span>小滴课堂二</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="disqus_thread"></div><script>var unused = null;
var disqus_config = function () {
  this.page.url = 'https://blog.kaluna.top/2021/04/21/%E5%B0%8F%E6%BB%B4%E8%AF%BE%E5%A0%82%E4%B8%89/';
  this.page.identifier = '2021/04/21/小滴课堂三/';
  this.page.title = '小滴课堂三';
}
var d = document, s = d.createElement('script');
s.src = "https://" + 'shortname-pzy8cndfkq' +".disqus.com/embed.js";
s.setAttribute('data-timestamp', '' + +new Date());
(d.head || d.body).appendChild(s);</script><script id="dsq-count-scr" src="https://shortname-pzy8cndfkq.disqus.com/count.js" async></script></div></div><footer class="footer-bg" style="background-image: url(https://gitee.com/YuerryHUAHUA/figure/raw/master/img/20210521080208.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2021 By Kaluna</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="icp"><a><span></span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.7.0"></script><script src="/js/fancybox.js?version=1.7.0"></script><script src="/js/sidebar.js?version=1.7.0"></script><script src="/js/copy.js?version=1.7.0"></script><script src="/js/fireworks.js?version=1.7.0"></script><script src="/js/transition.js?version=1.7.0"></script><script src="/js/scroll.js?version=1.7.0"></script><script src="/js/head.js?version=1.7.0"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>